(function () {
  function a() {}
  function b() {}
  function e(d, m, r) {
    this.init(d, [m], [r || (d && 1 < d.length ? d.slice(1) : d)]);
  }
  function k() {}
  function l(d, m, r) {
    arguments.length &&
      ((this.parent = d),
      (this.prev = m || 0),
      (this.next = r || 0),
      this.jQinit(
        this.fold(K(), function (z, B) {
          return B.jQ.add(z);
        })
      ));
  }
  function n(d, m, r, z) {
    function B() {
      ea = O;
      var G = M.selection ? M.selection.latex() : "";
      W.val(G);
      G &&
        (W[0].select
          ? W[0].select()
          : document.selection &&
            ((G = W[0].createTextRange()), G.expand("textedit"), G.select()));
    }
    function F(G) {
      M.seek(K(G.target), G.pageX, G.pageY);
      if (M.prev !== fa.prev || M.parent !== fa.parent)
        (ba = 0), M.selectFrom(fa);
      return !1;
    }
    function H(G) {
      delete G.target;
      return F(G);
    }
    function E(G) {
      M.blink = Ka;
      M.selection || (z ? M.show() : ka.detach());
      d.unbind("mousemove", F);
      K(document).unbind("mousemove", H).unbind("mouseup", E);
    }
    function Q() {
      var G = W.val();
      "$" === G.slice(0, 1) && "$" === G.slice(-1) && (G = G.slice(1, -1));
      G = G.replace(/ /g, "#");
      M.writeLatex(G).show();
      W.val("");
    }
    function ha() {
      if (!oa) {
        var G = W.val();
        if (G) {
          W.val("");
          for (var sa = 0; sa < G.length; sa += 1)
            M.parent.textInput(G.charAt(sa));
        } else (M.selection || ea !== O) && B();
      }
    }
    var Z = d.contents().detach();
    r || d.addClass("mathquill-rendered-math");
    m.jQ = d.data("[[mathquill internal data]]", {
      block: m,
      revert: function () {
        d.empty()
          .unbind(".mathquill")
          .removeClass(
            "mathquill-rendered-math mathquill-editable mathquill-textbox"
          )
          .append(Z);
      },
    });
    var M = (m.cursor = new ta(m));
    m.renderLatex(Z.text());
    var ka = (m.textarea = K(
        '<span class="textarea"><textarea></textarea></span>'
      )),
      W = ka.children(),
      ea;
    m.selectionChanged = function () {
      ea === O && (ea = setTimeout(B));
      Aa(d[0]);
    };
    d.bind("selectstart.mathquill", function (G) {
      G.target !== W[0] && G.preventDefault();
      G.stopPropagation();
    });
    var fa = 0,
      Ka = M.blink,
      Ba,
      ba = 0;
    d.bind("mousedown.mathquill", function (G) {
      setTimeout(function () {
        W.focus();
      });
      M.blink = K.noop;
      M.seek(K(G.target), G.pageX, G.pageY);
      z || d.prepend(ka);
      ba = M.parent === fa.parent && M.prev === fa.prev ? ba + 1 : 1;
      clearTimeout(Ba);
      Ba = setTimeout(function () {
        ba = 0;
      }, 500);
      if (3 === ba)
        for (ba = 0, M.clearSelection().appendTo(m); M.prev; ) M.selectLeft();
      else
        2 === ba
          ? M.selectWord()
          : ((fa = new l(M.parent, M.prev, M.next)),
            d.mousemove(F),
            K(document).mousemove(H));
      K(document).mouseup(E);
      return !1;
    });
    if (z) {
      d.prepend(ka);
      d.addClass("mathquill-editable");
      r && d.addClass("mathquill-textbox");
      W.focus(function (G) {
        m.hidePlaceholder();
        M.parent || M.appendTo(m);
        M.parent.jQ.addClass("hasCursor");
        M.selection
          ? (M.selection.jQ.removeClass("blur"), setTimeout(m.selectionChanged))
          : M.show();
        G.stopPropagation();
        K(this).trigger("focus.mathquill");
      }).blur(function (G) {
        M.hide().parent.blur();
        M.selection && M.selection.jQ.addClass("blur");
        m.showPlaceholder();
        G.stopPropagation();
        K(this).trigger("blur.mathquill");
      });
      d.bind("focus.mathquill blur.mathquill", function (G) {
        W.trigger(G);
      }).blur();
      d.bind("cut", function (G) {
        B();
        M.selection &&
          setTimeout(function () {
            M.deleteSelection();
            M.redraw();
          });
        G.stopPropagation();
      })
        .bind("copy", function (G) {
          B();
          oa = !0;
          G.stopPropagation();
        })
        .bind("paste", function (G) {
          oa = !0;
          setTimeout(Q);
          G.stopPropagation();
        });
      var Ca,
        ua,
        Da,
        oa = !1;
      d.bind("keydown.mathquill", function (G) {
        Ca = G;
        ua = !0;
        !1 === M.parent.keydown(G) && G.preventDefault();
      }).bind("keypress.mathquill", function (G) {
        if (ua) ua = !1;
        else {
          if (Da !== G.which) return;
          M.parent.keydown(Ca);
        }
        Da = G.which;
        ea !== O && clearTimeout(ea);
        oa = !1;
        G = navigator.userAgent || navigator.vendor || window.opera;
        "iOS" ===
        (/android/i.test(G)
          ? "Android"
          : "1" === readCookie("sy.probablyIPad") ||
            (/iPad|iPhone|iPod/.test(G) && !window.MSStream)
          ? "iOS"
          : "unknown")
          ? setTimeout(ha, 100)
          : setTimeout(ha);
      });
    } else {
      d.bind("cut paste", !1)
        .bind("copy", B)
        .prepend('<span class="selectable"></span>');
      W.blur(function () {
        M.clearSelection();
        setTimeout(G);
      });
      function G() {
        ka.detach();
      }
    }
  }
  function q() {}
  function v(d) {
    this.init("$");
    this.firstChild.cursor = d;
    this.firstChild.textInput = function (m) {
      this.skipTextInput ||
        ("$" !== m || d.parent !== this
          ? d.write(m)
          : this.isEmpty()
          ? d
              .insertAfter(this.parent)
              .backspace()
              .insertNew(new u("\\$", "$"))
              .show()
          : d.next
          ? d.prev
            ? d.write(m)
            : d.insertBefore(this.parent)
          : d.insertAfter(this.parent));
    };
  }
  function f() {}
  function h(d, m) {
    m.prototype = d.prototype;
    return m;
  }
  function c(d) {
    var m = Array.prototype.slice.call(arguments, 1);
    return h(d, function () {
      d.apply(this, Array.prototype.concat.apply(m, arguments));
    });
  }
  function p(d, m, r) {
    this.init(d, [m], O, r);
  }
  function w(d, m, r) {
    this.init(
      d,
      [
        '<span class="diacritic"><span class="diacritic-char">' +
          m +
          "&nbsp;</span></span>",
        "<span></span>",
      ],
      O,
      r
    );
  }
  function y(d, m, r, z, B) {
    this.stretchFactor = z;
    this.init(
      d,
      [
        '<span class="diacritic"><span class="' +
          m +
          '">' +
          r +
          "&nbsp;</span></span>",
        "<span></span>",
      ],
      O,
      B
    );
  }
  function x(d, m, r, z) {
    this.init(d, [m], [r], z);
  }
  function C(d) {
    this.init("\\frac", O, O, d);
    this.jQ.append('<span style="display:inline-block;width:0">&nbsp;</span>');
  }
  function D() {
    C.apply(this, arguments);
  }
  function A(d) {
    this.init("\\sqrt", O, O, d);
  }
  function I(d) {
    this.init("\\longdivision", O, O, d);
  }
  function V(d) {
    A.call(this, d);
    this.jQ = this.firstChild.jQ.detach().add(this.jQ);
  }
  function L(d, m, r, z, B) {
    this.init(
      "\\left" + r,
      [
        '<span class="block"><span class="paren">' +
          d +
          '</span><span class="block"></span><span class="paren">' +
          m +
          "</span></span>",
      ],
      [d, m],
      B
    );
    this.end = "\\right" + z;
  }
  function N(d, m, r, z, B) {
    L.apply(this, arguments);
  }
  function R(d, m, r) {
    L.call(this, d, m, d, m, r);
  }
  function X(d, m, r) {
    N.call(this, d, m, d, m, r);
  }
  function S(d) {
    R.call(this, "|", "|", d);
  }
  function P(d) {
    d instanceof l
      ? (this.replacedText = d.remove().jQ.text())
      : "string" === typeof d && (this.replacedText = d);
    this.init();
  }
  function ca() {}
  function Y(d, m) {
    function r() {
      P.apply(this, arguments);
    }
    t = r.prototype = new P();
    t.cmd = d;
    t.html_template = [m];
    return r;
  }
  function pa(d) {
    this.init("\\");
    d &&
      ((this.replacedFragment = d.detach()),
      (this.isEmpty = function () {
        return !1;
      }));
  }
  function va(d) {
    this.init("\\twostack", O, O, d);
    this.jQ.wrapInner('<span class="array"></span>');
    this.blockjQ = this.jQ.children();
  }
  function qa(d) {
    this.init("\\binom", O, O, d);
    this.jQ.wrapInner('<span class="array"></span>');
    this.blockjQ = this.jQ.children();
    this.bracketjQs = K('<span class="paren">(</span>')
      .prependTo(this.jQ)
      .add(K('<span class="paren">)</span>').appendTo(this.jQ));
  }
  function Ea() {
    qa.apply(this, arguments);
  }
  function Fa(d) {
    this.init("\\vector", O, O, d);
  }
  function wa(d, m, r, z) {
    this.rows = r;
    this.cols = z;
    this.init("\\matrix", O, O, d);
    this.envName = "matrix";
  }
  function Ga() {}
  function ia(d, m, r) {
    function z(B, F, H, E) {
      this.rows = H;
      this.cols = E;
      this.init("\\" + d, O, O, B);
      this.envName = d;
      B = this.blockjQ = this.tablejQ;
      this.bracketjQs = B.prev().add(B.next());
    }
    t = z.prototype = new Ga();
    t.html_template = [
      '<span class="block"><span class="paren">' +
        m +
        '</span><table class="matrix"></table><span class="paren">' +
        r +
        "</span></span>",
    ];
    t.initBlocks = function (B) {
      this.tablejQ = this.jQ.find("table");
      this.initMatrix(B);
    };
    t.redraw = L.prototype.redraw;
    g[d] = z;
  }
  function T(d, m) {
    e.call(this, d, "<var>" + (m || d) + "</var>");
  }
  function u(d, m) {
    e.call(this, d, "<span>" + (m || d) + "</span>");
  }
  function xa(d, m) {
    e.call(this, d, "<span>" + (m || d) + "</span>");
  }
  function Ha() {
    u.call(this, "\\:", " ");
  }
  function ja(d, m) {
    e.call(this, d, '<span class="nonSymbola">' + (m || d) + "</span>");
  }
  function J(d, m, r) {
    e.call(this, d, '<span class="binary-operator">' + m + "</span>", r);
  }
  function la(d, m) {
    u.apply(this, arguments);
  }
  function aa(d, m) {
    e.call(this, d, "<big>" + m + "</big>");
  }
  function ra(d, m) {
    e.call(this, "\\" + m + " ", "<span>" + m + "</span>");
  }
  function ta(d) {
    this.parent = this.root = d;
    var m = (this.jQ = this._jQ = K('<span class="cursor">&#8203;</span>'));
    this.blink = function () {
      m.toggleClass("blink");
    };
  }
  function ma(d, m, r) {
    l.apply(this, arguments);
  }
  var K = jQuery,
    O,
    na = Math.min,
    ya = Math.max;
  var t = a.prototype;
  t.prev = 0;
  t.next = 0;
  t.parent = 0;
  t.firstChild = 0;
  t.lastChild = 0;
  t.eachChild = function (d) {
    for (var m = this.firstChild; m && !1 !== d.call(this, m); m = m.next);
    return this;
  };
  t.foldChildren = function (d, m) {
    this.eachChild(function (r) {
      d = m.call(this, d, r);
    });
    return d;
  };
  t.keydown = function (d) {
    return this.parent.keydown(d);
  };
  t.textInput = function (d) {
    return this.parent.textInput(d);
  };
  t = b.prototype = new a();
  t.init = function (d, m, r, z) {
    d && (this.cmd = d);
    m && (this.html_template = m);
    r && (this.text_template = r);
    this.jQ = K(this.html_template[0]).data("[[mathquill internal data]]", {
      cmd: this,
    });
    this.initBlocks(z);
  };
  t.initBlocks = function (d) {
    if (1 === this.html_template.length)
      (this.firstChild =
        this.lastChild =
        this.jQ.data("[[mathquill internal data]]").block =
          (d && d.blockify()) || new k()),
        (this.firstChild.parent = this),
        (this.firstChild.jQ = this.jQ.append(this.firstChild.jQ));
    else {
      var m,
        r = this.html_template.length;
      this.firstChild = d = m = (d && d.blockify()) || new k();
      d.parent = this;
      d.jQ = K(this.html_template[1])
        .data("[[mathquill internal data]]", { block: d })
        .append(d.jQ)
        .appendTo(this.jQ);
      d.blur();
      for (var z = 2; z < r; z += 1)
        (d = new k()),
          (d.parent = this),
          (d.prev = m),
          (m = m.next = d),
          (d.jQ = K(this.html_template[z])
            .data("[[mathquill internal data]]", { block: d })
            .appendTo(this.jQ)),
          d.blur();
      this.lastChild = d;
    }
  };
  t.latex = function () {
    return this.foldChildren(this.cmd, function (d, m) {
      return d + "{" + (m.latex() || " ") + "}";
    });
  };
  t.text_template = [""];
  t.text = function () {
    var d = 0;
    return this.foldChildren(this.text_template[d], function (m, r) {
      d += 1;
      var z = r.text();
      return m &&
        "(" === this.text_template[d] &&
        "(" === z[0] &&
        ")" === z.slice(-1)
        ? m + z.slice(1, -1) + this.text_template[d]
        : m + r.text() + (this.text_template[d] || "");
    });
  };
  t.insertAt = function (d) {
    this.parent = d.parent;
    this.next = d.next;
    (this.prev = d.prev) ? (d.prev.next = this) : (d.parent.firstChild = this);
    d.next ? (d.next.prev = this) : (d.parent.lastChild = this);
    d.prev = this;
    this.jQ.insertBefore(d.jQ);
    this.respace();
    this.next && this.next.respace();
    this.prev && this.prev.respace();
    this.placeCursor(d);
    d.redraw();
    if ("\\matrixmid " == this.cmd) {
      for (d = this.parent; d && "\\left(" != d.cmd; ) d = d.parent;
      d &&
        ((d =
          d.blockjQ.outerHeight() / +d.blockjQ.css("fontSize").slice(0, -2)),
        da(this.jQ, na(1 + 0.2 * (d - 1), 1.2), 0.98 * d),
        this.jQ.addClass("paren"));
    }
  };
  t.respace = K.noop;
  t.placeCursor = function (d) {
    d.appendTo(
      this.foldChildren(this.firstChild, function (m, r) {
        return m.isEmpty() ? m : r;
      })
    );
  };
  t.precedence = 0;
  t.isEmpty = function () {
    return this.foldChildren(!0, function (d, m) {
      return d && m.isEmpty();
    });
  };
  t.remove = function () {
    var d = this.prev,
      m = this.next,
      r = this.parent;
    d ? (d.next = m) : (r.firstChild = m);
    m ? (m.prev = d) : (r.lastChild = d);
    this.jQ.remove();
    return this;
  };
  t = e.prototype = new b();
  t.initBlocks = K.noop;
  t.latex = function () {
    return this.cmd;
  };
  t.text = function () {
    return this.text_template;
  };
  t.placeCursor = K.noop;
  t.isEmpty = function () {
    return !0;
  };
  t = k.prototype = new a();
  t.latex = function () {
    return this.foldChildren("", function (d, m) {
      return d + m.latex();
    });
  };
  t.text = function () {
    return this.firstChild === this.lastChild
      ? this.firstChild.text()
      : this.foldChildren("(", function (d, m) {
          return d + m.text();
        }) + ")";
  };
  t.isEmpty = function () {
    return 0 === this.firstChild && 0 === this.lastChild;
  };
  t.focus = function () {
    this.jQ.addClass("hasCursor");
    this.isEmpty() && this.jQ.removeClass("empty");
    return this;
  };
  t.blur = function () {
    this.jQ.removeClass("hasCursor");
    this.isEmpty() && this.jQ.addClass("empty");
    return this;
  };
  t = l.prototype;
  t.remove = b.prototype.remove;
  t.jQinit = function (d) {
    this.jQ = d;
  };
  t.each = function (d) {
    for (
      var m = this.prev.next || this.parent.firstChild;
      m !== this.next && !1 !== d.call(this, m);
      m = m.next
    );
    return this;
  };
  t.fold = function (d, m) {
    this.each(function (r) {
      d = m.call(this, d, r);
    });
    return d;
  };
  t.latex = function () {
    return this.fold("", function (d, m) {
      return d + m.latex();
    });
  };
  t.blockify = function () {
    var d = this.prev,
      m = this.next,
      r = this.parent,
      z = new k(),
      B = (z.firstChild = d.next || r.firstChild),
      F = (z.lastChild = m.prev || r.lastChild);
    d ? (d.next = m) : (r.firstChild = m);
    m ? (m.prev = d) : (r.lastChild = d);
    B.prev = this.prev = 0;
    F.next = this.next = 0;
    this.parent = z;
    this.each(function (H) {
      H.parent = z;
    });
    z.jQ = this.jQ;
    return z;
  };
  t = q.prototype = new k();
  t.latex = function () {
    return k.prototype.latex.call(this).replace(/(\\[a-z]+) (?![a-z])/gi, "$1");
  };
  t.text = function () {
    return this.foldChildren("", function (d, m) {
      return d + m.text();
    });
  };
  t.renderLatex = function (d) {
    this.jQ.children().slice(1).remove();
    this.firstChild = this.lastChild = 0;
    this.cursor.appendTo(this).writeLatex(d);
    this.blur();
  };
  t.setPlaceholder = function (d) {
    this.placeholder = d;
  };
  t.showPlaceholder = function () {
    this.placeholder &&
      this.isEmpty() &&
      (this.cursor.writeLatex(this.placeholder),
      this.blur(),
      (this.firstChild = this.lastChild = 0),
      this.jQ.addClass("placeholder"));
  };
  t.hidePlaceholder = function () {
    this.placeholder &&
      this.isEmpty() &&
      (this.jQ.removeClass("placeholder").children().slice(1).remove(),
      this.cursor.appendTo(this));
  };
  t.keydown = function (d) {
    d.ctrlKey = d.ctrlKey || d.metaKey;
    switch ((d.originalEvent && d.originalEvent.keyIdentifier) || d.which) {
      case 8:
      case "Backspace":
      case "U+0008":
        if (d.ctrlKey)
          for (; this.cursor.prev || this.cursor.selection; )
            this.cursor.backspace();
        else this.cursor.backspace();
        break;
      case 27:
      case "Esc":
      case "U+001B":
      case 9:
      case "Tab":
      case "U+0009":
        if (d.ctrlKey) break;
        var m = this.cursor.parent;
        if (d.shiftKey) {
          if (m === this.cursor.root) return (this.skipTextInput = !0);
          m.prev
            ? this.cursor.appendTo(m.prev)
            : this.cursor.insertBefore(m.parent);
        } else {
          if (m === this.cursor.root) return (this.skipTextInput = !0);
          m.next
            ? this.cursor.prependTo(m.next)
            : this.cursor.insertAfter(m.parent);
        }
        this.cursor.clearSelection();
        break;
      case 13:
      case "Enter":
        return (this.skipTextInput = !0);
      case 35:
      case "End":
        if (d.shiftKey)
          for (
            ;
            this.cursor.next || (d.ctrlKey && this.cursor.parent !== this);

          )
            this.cursor.selectRight();
        else
          this.cursor
            .clearSelection()
            .appendTo(d.ctrlKey ? this : this.cursor.parent);
        break;
      case 36:
      case "Home":
        if (d.shiftKey)
          for (
            ;
            this.cursor.prev || (d.ctrlKey && this.cursor.parent !== this);

          )
            this.cursor.selectLeft();
        else
          this.cursor
            .clearSelection()
            .prependTo(d.ctrlKey ? this : this.cursor.parent);
        break;
      case 37:
      case "Left":
        if (d.ctrlKey && this.cursor.prev) {
          for (
            m = d.shiftKey ? "selectLeft" : "hopLeft";
            this.cursor.prev && 0 !== this.cursor.prev.precedence;

          )
            this.cursor[m]();
          for (; this.cursor.prev && 0 === this.cursor.prev.precedence; )
            this.cursor[m]();
          d.shiftKey || this.cursor.show();
          break;
        }
        d.shiftKey ? this.cursor.selectLeft() : this.cursor.moveLeft();
        break;
      case 38:
      case "Up":
        if (d.ctrlKey) break;
        if (d.shiftKey)
          if (this.cursor.prev)
            for (; this.cursor.prev; ) this.cursor.selectLeft();
          else this.cursor.selectLeft();
        else
          this.cursor.parent.prev
            ? this.cursor.clearSelection().appendTo(this.cursor.parent.prev)
            : this.cursor.prev
            ? this.cursor.clearSelection().prependTo(this.cursor.parent)
            : this.cursor.parent !== this &&
              this.cursor
                .clearSelection()
                .insertBefore(this.cursor.parent.parent);
        break;
      case 39:
      case "Right":
        if (d.ctrlKey && this.cursor.next) {
          for (
            m = d.shiftKey ? "selectRight" : "hopRight";
            this.cursor.next && 0 === this.cursor.next.precedence;

          )
            this.cursor[m]();
          for (; this.cursor.next && 0 !== this.cursor.next.precedence; )
            this.cursor[m]();
          d.shiftKey || this.cursor.show();
          break;
        }
        d.shiftKey ? this.cursor.selectRight() : this.cursor.moveRight();
        break;
      case 40:
      case "Down":
        if (d.ctrlKey) break;
        if (d.shiftKey)
          if (this.cursor.next)
            for (; this.cursor.next; ) this.cursor.selectRight();
          else this.cursor.selectRight();
        else
          this.cursor.parent.next
            ? this.cursor.clearSelection().prependTo(this.cursor.parent.next)
            : this.cursor.next
            ? this.cursor.clearSelection().appendTo(this.cursor.parent)
            : this.cursor.parent !== this &&
              this.cursor
                .clearSelection()
                .insertAfter(this.cursor.parent.parent);
        break;
      case 46:
      case "Del":
      case "U+007F":
        if (d.ctrlKey)
          for (; this.cursor.next || this.cursor.selection; )
            this.cursor.deleteForward();
        else this.cursor.deleteForward();
        break;
      case 65:
      case "A":
      case "U+0041":
        if (d.ctrlKey && !d.shiftKey && !d.altKey) {
          if (this !== this.cursor.root) return this.parent.keydown(d);
          for (this.cursor.clearSelection().appendTo(this); this.cursor.prev; )
            this.cursor.selectLeft();
          break;
        }
      default:
        return (this.skipTextInput = !1), !0;
    }
    this.skipTextInput = !0;
    return !1;
  };
  t.textInput = function (d) {
    this.skipTextInput || this.cursor.write(d);
  };
  t = v.prototype = new b();
  t.html_template = ['<span class="mathquill-rendered-math"></span>'];
  t.initBlocks = function () {
    this.firstChild =
      this.lastChild =
      this.jQ.data("[[mathquill internal data]]").block =
        new q();
    this.firstChild.parent = this;
    this.firstChild.jQ = this.jQ;
  };
  t.latex = function () {
    return "$" + this.firstChild.latex() + "$";
  };
  t = f.prototype = new k();
  t.renderLatex = function (d) {
    var m = this.cursor;
    this.jQ.children().slice(1).remove();
    this.firstChild = this.lastChild = 0;
    m.show().appendTo(this);
    d = d.match(/(?:\\\$|[^$])+|\$(?:\\\$|[^$])*\$|\$(?:\\\$|[^$])*$/g) || "";
    for (var r = 0; r < d.length; r += 1) {
      var z = d[r];
      if ("$" === z[0]) {
        z =
          "$" === z[-1 + z.length] && "\\" !== z[-2 + z.length]
            ? z.slice(1, -1)
            : z.slice(1);
        var B = new v(m);
        m.insertNew(B);
        B.firstChild.renderLatex(z);
        m.show().insertAfter(B);
      } else
        for (B = 0; B < z.length; B += 1) this.cursor.insertNew(new u(z[B]));
    }
  };
  t.keydown = q.prototype.keydown;
  t.textInput = function (d) {
    this.skipTextInput ||
      (this.cursor.deleteSelection(),
      "$" === d
        ? this.cursor.insertNew(new v(this.cursor))
        : this.cursor.insertNew(new u(d)));
  };
  var U = {},
    g = {},
    Aa = K.noop,
    Ia = document.createElement("div").style,
    La = {
      transform: 1,
      WebkitTransform: 1,
      MozTransform: 1,
      OTransform: 1,
      msTransform: 1,
    },
    za;
  for (za in La)
    if (za in Ia) {
      var Ja = za;
      break;
    }
  if (Ja)
    var da = function (d, m, r) {
      d.css(Ja, "scale(" + m + "," + r + ")");
    };
  else
    "filter" in Ia
      ? ((Aa = function (d) {
          d.className = d.className;
        }),
        (da = function (d, m, r) {
          function z() {
            d.css("marginRight", (1 + E.width() * (H - 1)) / H + "px");
          }
          var B = r > m ? "M11=" : "M22=",
            F = ya(m, r),
            H = na(m, r);
          H /= 1 + (F - 1) / 2;
          0 === d.children().length && d.wrapInner("<span></span>");
          d.addClass("matrixed").css({
            fontSize: F + "em",
            marginTop: "-.175em",
          });
          var E = d
            .children()
            .css({
              filter:
                "progid:DXImageTransform.Microsoft.Matrix(" +
                B +
                H +
                ",SizingMethod='auto expand')",
            });
          z();
          var Q = setInterval(z);
          K(window).load(function () {
            clearTimeout(Q);
            z();
          });
        }))
      : (da = function (d, m, r) {
          d.css("fontSize", ya(m, r) + "em");
        });
  h(b, p);
  g.mathrm = c(p, "\\mathrm", '<span class="roman font"></span>');
  g.mathit = c(p, "\\mathit", '<i class="font"></i>');
  g.mathbf = c(p, "\\mathbf", '<b class="font"></b>');
  g.mathsf = c(p, "\\mathsf", '<span class="sans-serif font"></span>');
  g.mathtt = c(p, "\\mathtt", '<span class="monospace font"></span>');
  g.underline = c(p, "\\underline", '<span class="underline"></span>');
  t = w.prototype = new b();
  t.redraw = t._redraw = function () {
    var d = !this.firstChild.isEmpty();
    this.firstChild.eachChild(function (z) {
      return (d =
        d &&
        z.cmd in
          {
            a: 1,
            c: 1,
            e: 1,
            g: 1,
            m: 1,
            n: 1,
            o: 1,
            p: 1,
            q: 1,
            r: 1,
            s: 1,
            u: 1,
            v: 1,
            w: 1,
            x: 1,
            y: 1,
            z: 1,
          });
    });
    this.jQ.children(":first").toggleClass("lowercase", d);
    var m =
      !d &&
      this.firstChild.firstChild === this.lastChild.lastChild &&
      "t" === this.firstChild.firstChild.cmd;
    this.jQ.children(":first").toggleClass("only-lowercase-t", m);
    if (d) r = !0;
    else {
      var r = !0;
      this.firstChild.eachChild(function (z) {
        return (r = r && z instanceof e && !(z instanceof aa));
      });
    }
    this.jQ.toggleClass("block", !r);
  };
  K.browser.webkit &&
    (t.redraw = function () {
      this._redraw();
      this.webkitForceRedrawToggle = !this.webkitForceRedrawToggle;
      this.jQ
        .children(":first")
        .css("display", this.webkitForceRedrawToggle ? "inline-block" : "");
    });
  g.grave = c(w, "\\grave", "&#768;");
  g.acute = c(w, "\\acute", "&#769;");
  g.hat = g.circumflex = c(w, "\\hat", "&#770;");
  g.tilde = c(w, "\\tilde", "&#771;");
  g.bar = c(w, "\\bar", "&#773;");
  g.breve = c(w, "\\breve", "&#774;");
  g.dot = c(w, "\\dot", "&#775;");
  g.ddot = c(w, "\\ddot", "&#776;");
  g.check = g.caron = c(w, "\\ddot", "&#780;");
  g.dddot = c(w, "\\dddot", "&#8411;");
  g.ddddot = c(w, "\\ddddot", "&#8412;");
  g.vec = c(w, "\\vec", "&#8407;");
  g.overline = h(w, function (d) {
    this.init(
      "\\overline",
      ['<span class="diacritic"><span class="overline"></span></span>'],
      O,
      d
    );
  });
  t = y.prototype = new w();
  t.redraw = function () {
    this._redraw();
    var d = ya(
      1,
      (this.stretchFactor * this.jQ.innerWidth()) /
        +this.jQ.css("fontSize").slice(0, -2)
    );
    da(this.jQ.children(":first"), d, 1.2);
  };
  g.widehat = c(y, "\\widehat", "widehat", "&#770;", 2.95);
  g.overleftarrow = c(y, "\\overleftarrow", "overarrow", "&#8406;", 2);
  g.overrightarrow = c(y, "\\overrightarrow", "overarrow", "&#8407;", 2);
  g.overarc = c(y, "\\overarc", "overarc", "&#x25E0;", 1.5);
  t = x.prototype = new b();
  t.latex = function () {
    var d = this.firstChild.latex();
    return 1 === d.length ? this.cmd + d : this.cmd + "{" + (d || " ") + "}";
  };
  t.redraw = function () {
    this.prev && this.prev.respace();
    this.prev instanceof x ||
      (this.respace(),
      !this.next || this.next instanceof x || this.next.respace());
  };
  t.respace = function () {
    "\\int " === this.prev.cmd ||
    (this.prev instanceof x &&
      this.prev.cmd != this.cmd &&
      this.prev.prev &&
      "\\int " === this.prev.prev.cmd)
      ? this.limit || ((this.limit = !0), this.jQ.addClass("limit"))
      : this.limit && ((this.limit = !1), this.jQ.removeClass("limit"));
    if (
      (this.respaced =
        this.prev instanceof x &&
        this.prev.cmd != this.cmd &&
        !this.prev.respaced)
    ) {
      var d = +this.jQ.css("fontSize").slice(0, -2),
        m = this.prev.jQ.outerWidth();
      thisWidth = this.jQ.outerWidth();
      "_" === this.cmd &&
      "^" === this.prev.cmd &&
      "\\left[" === this.prev.prev.cmd
        ? this.jQ.css({
            left: (this.limit && "_" === this.cmd ? -0.25 : 0) - m / d + "em",
            marginRight: "",
            verticalAlign: "-0.8em",
          })
        : this.jQ.css({
            left: (this.limit && "_" === this.cmd ? -0.25 : 0) - m / d + "em",
            marginRight: 0.1 - na(thisWidth, m) / d + "em",
          });
    } else
      "\\left[" === this.prev.cmd && "_" === this.cmd
        ? this.jQ.css({ marginRight: "", verticalAlign: "-0.8em" })
        : this.limit && "_" === this.cmd
        ? this.jQ.css({ left: "-.25em", marginRight: "" })
        : this.jQ.css({ left: "", marginRight: "" });
    this.prev instanceof aa && (this.precedence = this.prev.precedence);
    this.respaced && this.prev.prev instanceof aa
      ? (this.precedence = this.prev.prev.precedence)
      : delete this.precedence;
    this.next instanceof x && this.next.respace();
    return this;
  };
  g.subscript = g._ = h(x, function (d) {
    this.init("_", ["<sub></sub>"], ["_"], d);
  });
  g.superscript =
    g.supscript =
    g["^"] =
      h(x, function (d) {
        this.init("^", ["<sup></sup>"], ["**"], d);
      });
  t = C.prototype = new b();
  t.html_template = [
    '<span class="fraction"></span>',
    '<span class="numerator"></span>',
    '<span class="denominator"></span>',
  ];
  t.text_template = ["(", "/", ")"];
  g.frac = g.dfrac = g.cfrac = g.fraction = C;
  t = D.prototype = new C();
  t.placeCursor = function (d) {
    if (this.firstChild.isEmpty()) {
      for (
        var m = this.prev;
        m &&
        0 === m.precedence &&
        "\\int " != m.cmd &&
        "\\lim " != m.cmd &&
        "\\sum " != m.cmd &&
        "," != m.cmd &&
        "^" != m.cmd &&
        "_" != m.cmd;

      )
        m = m.prev;
      m !== this.prev
        ? ((m = new l(this.parent, m, this).blockify()),
          (m.jQ = this.firstChild.jQ
            .empty()
            .removeClass("empty")
            .append(m.jQ)
            .data("[[mathquill internal data]]", { block: m })),
          (m.next = this.lastChild),
          (m.parent = this),
          (this.firstChild = this.lastChild.prev = m),
          d.appendTo(this.lastChild))
        : d.appendTo(this.firstChild);
    } else d.appendTo(this.lastChild);
  };
  g.over = U["/"] = D;
  t = A.prototype = new b();
  t.html_template = [
    '<span class="block"><span class="sqrt-prefix">&radic;</span></span>',
    '<span class="sqrt-stem"></span>',
  ];
  t.text_template = ["sqrt(", ")"];
  t.redraw = function () {
    var d = this.lastChild.jQ;
    da(d.prev(), 1, d.innerHeight() / +d.css("fontSize").slice(0, -2) - 0.1);
  };
  g.sqrt = g["\u221a"] = A;
  t = I.prototype = new b();
  t.html_template = [
    '<span class="block"><span class="sqrt-prefix longdivision">|</span></span>',
    '<span class="sqrt-stem"></span>',
  ];
  t.text_template = ["longdivision(", ")"];
  g.longdivision = I;
  t = V.prototype = new A();
  t.html_template = [
    '<span class="block"><span class="sqrt-prefix">&radic;</span></span>',
    '<sup class="nthroot"></sup>',
    '<span class="sqrt-stem"></span>',
  ];
  t.text_template = ["sqrt[", "](", ")"];
  t.latex = function () {
    return (
      "\\sqrt[" + this.firstChild.latex() + "]{" + this.lastChild.latex() + "}"
    );
  };
  g.nthroot = V;
  t = L.prototype = new b();
  t.initBlocks = function (d) {
    this.firstChild = this.lastChild = (d && d.blockify()) || new k();
    this.firstChild.parent = this;
    this.firstChild.jQ = this.jQ
      .children(":eq(1)")
      .data("[[mathquill internal data]]", { block: this.firstChild })
      .append(this.firstChild.jQ);
    d = this.blockjQ = this.firstChild.jQ;
    this.bracketjQs = d.prev().add(d.next());
  };
  t.latex = function () {
    return this.cmd + this.firstChild.latex() + this.end;
  };
  t.redraw = function () {
    var d =
      this.blockjQ.outerHeight() / +this.blockjQ.css("fontSize").slice(0, -2);
    da(this.bracketjQs, na(1 + 0.2 * (d - 1), 1.2), 1.05 * d);
  };
  g.lbrace = U["{"] = h(L, function (d) {
    L.call(this, "{", "}", "\\{", "\\}", d);
  });
  g.langle = g.lang = h(L, function (d) {
    L.call(this, "&lang;", "&rang;", "\\langle ", "\\rangle ", d);
  });
  t = N.prototype = new L();
  t.placeCursor = function (d) {
    !this.next &&
    this.parent.parent &&
    this.parent.parent.end === this.end &&
    this.firstChild.isEmpty()
      ? d.backspace().insertAfter(this.parent.parent)
      : (this.firstChild.blur(), this.redraw());
  };
  g.rbrace = U["}"] = h(N, function (d) {
    N.call(this, "{", "}", "\\{", "\\}", d);
  });
  g.rangle = g.rang = h(N, function (d) {
    N.call(this, "&lang;", "&rang;", "\\langle ", "\\rangle ", d);
  });
  R.prototype = L.prototype;
  g.lparen = U["("] = h(R, function (d) {
    R.call(this, "(", ")", d);
  });
  g.lbrack =
    g.lbracket =
    U["["] =
      h(R, function (d) {
        R.call(this, "[", "]", d);
      });
  X.prototype = N.prototype;
  g.rparen = U[")"] = h(X, function (d) {
    X.call(this, "(", ")", d);
  });
  g.rbrack =
    g.rbracket =
    U["]"] =
      h(X, function (d) {
        X.call(this, "[", "]", d);
      });
  t = S.prototype = new R();
  t.placeCursor = function (d) {
    !this.next &&
    this.parent.parent &&
    this.parent.parent.end === this.end &&
    this.firstChild.isEmpty()
      ? d.backspace().insertAfter(this.parent.parent)
      : d.appendTo(this.firstChild);
  };
  g.lpipe = g.rpipe = U["|"] = S;
  t = P.prototype = new b();
  t.cmd = "\\text";
  t.html_template = ['<span class="text"></span>'];
  t.text_template = ['"', '"'];
  t.precedence = 0.25;
  t.initBlocks = function () {
    this.firstChild =
      this.lastChild =
      this.jQ.data("[[mathquill internal data]]").block =
        new ca();
    this.firstChild.parent = this;
    this.firstChild.jQ = this.jQ.append(this.firstChild.jQ);
  };
  t.placeCursor = function (d) {
    (this.cursor = d).appendTo(this.firstChild);
    if (this.replacedText)
      for (d = 0; d < this.replacedText.length; d += 1)
        this.write(this.replacedText.charAt(d));
  };
  t.write = function (d) {
    this.cursor.insertNew(new u(d));
  };
  t.keydown = function (d) {
    return this.cursor.selection ||
      ((8 !== d.which || this.cursor.prev) &&
        (46 !== d.which || this.cursor.next))
      ? this.parent.keydown(d)
      : (this.isEmpty() && this.cursor.insertAfter(this), !1);
  };
  t.textInput = function (d) {
    this.cursor.deleteSelection();
    "$" !== d
      ? this.write(d)
      : this.isEmpty()
      ? this.cursor.insertAfter(this).backspace().insertNew(new u("\\$", "$"))
      : this.cursor.next
      ? this.cursor.prev
        ? ((d = new P(new l(this.firstChild, this.cursor.prev))),
          (d.placeCursor = function (m) {
            this.prev = 0;
            delete this.placeCursor;
            this.placeCursor(m);
          }),
          (d.firstChild.focus = function () {
            return this;
          }),
          this.cursor.insertAfter(this).insertNew(d),
          (d.prev = this),
          this.cursor.insertBefore(d),
          delete d.firstChild.focus)
        : this.cursor.insertBefore(this)
      : this.cursor.insertAfter(this);
  };
  t = ca.prototype = new k();
  t.blur = function () {
    this.jQ.removeClass("hasCursor");
    if (this.isEmpty()) {
      var d = this.parent,
        m = d.cursor;
      m.parent === this
        ? this.jQ.addClass("empty")
        : (m.hide(),
          d.remove(),
          m.next === d ? (m.next = d.next) : m.prev === d && (m.prev = d.prev),
          m.show().redraw());
    }
    return this;
  };
  t.focus = function () {
    k.prototype.focus.call(this);
    var d = this.parent;
    if (d.next.cmd === d.cmd) {
      var m = this,
        r = d.cursor;
      d = d.next.firstChild;
      d.eachChild(function (z) {
        z.parent = m;
        z.jQ.appendTo(m.jQ);
      });
      this.lastChild
        ? (this.lastChild.next = d.firstChild)
        : (this.firstChild = d.firstChild);
      d.firstChild.prev = this.lastChild;
      this.lastChild = d.lastChild;
      d.parent.remove();
      r.prev ? r.insertAfter(r.prev) : r.prependTo(this);
      r.redraw();
    } else
      d.prev.cmd === d.cmd &&
        ((r = d.cursor),
        r.prev ? d.prev.firstChild.focus() : r.appendTo(d.prev.firstChild));
    return this;
  };
  U.$ = g.text = g.textnormal = g.textrm = g.textup = g.textmd = P;
  g.em =
    g.italic =
    g.italics =
    g.emph =
    g.textit =
    g.textsl =
      Y("\\textit", '<i class="text"></i>');
  g.strong = g.bold = g.textbf = Y("\\textbf", '<b class="text"></b>');
  g.sf = g.textsf = Y("\\textsf", '<span class="sans-serif text"></span>');
  g.tt = g.texttt = Y("\\texttt", '<span class="monospace text"></span>');
  g.textsc = Y(
    "\\textsc",
    '<span style="font-variant:small-caps" class="text"></span>'
  );
  g.uppercase = Y(
    "\\uppercase",
    '<span style="text-transform:uppercase" class="text"></span>'
  );
  g.lowercase = Y(
    "\\lowercase",
    '<span style="text-transform:lowercase" class="text"></span>'
  );
  g.linethrough = Y(
    "\\linethrough",
    '<span style="text-decoration:line-through red" class="text"></span>'
  );
  t = pa.prototype = new b();
  t.html_template = ['<span class="latex-command-input">\\</span>'];
  t.text_template = ["\\"];
  t.placeCursor = function (d) {
    this.cursor = d.appendTo(this.firstChild);
    this.replacedFragment &&
      (this.jQ = this.jQ.add(
        this.replacedFragment.jQ
          .addClass("blur")
          .bind("mousedown mousemove", function (m) {
            K((m.target = this.nextSibling)).trigger(m);
            return !1;
          })
          .insertBefore(this.jQ)
      ));
  };
  t.latex = function () {
    return "\\" + this.firstChild.latex() + " ";
  };
  t.keydown = function (d) {
    return 9 === d.which || 13 === d.which
      ? (this.renderCommand(), !1)
      : this.parent.keydown(d);
  };
  t.textInput = function (d) {
    d.match(/[a-z]/i)
      ? (this.cursor.deleteSelection(), this.cursor.insertNew(new u(d)))
      : (this.renderCommand(),
        " " === d ||
          ("\\" === d && this.firstChild.isEmpty()) ||
          this.cursor.parent.textInput(d));
  };
  t.renderCommand = function () {
    this.jQ = this.jQ.last();
    this.remove();
    this.next
      ? this.cursor.insertBefore(this.next)
      : this.cursor.appendTo(this.parent);
    var d = this.firstChild.latex();
    d
      ? this.cursor.insertCmd(d, this.replacedFragment)
      : ((d = new u("\\backslash ", "\\")),
        this.cursor.insertNew(d),
        this.replacedFragment && this.replacedFragment.remove());
  };
  U["\\"] = pa;
  t = va.prototype = new b();
  t.html_template = [
    '<span class="block"></span>',
    "<span></span>",
    "<span></span>",
  ];
  t.text_template = ["twostack(", ",", ")"];
  t.redraw = va.prototype.redraw;
  g.twostack = va;
  t = qa.prototype = new b();
  t.html_template = [
    '<span class="block"></span>',
    "<span></span>",
    "<span></span>",
  ];
  t.text_template = ["choose(", ",", ")"];
  t.redraw = L.prototype.redraw;
  g.binom = g.binomial = qa;
  t = Ea.prototype = new qa();
  t.placeCursor = D.prototype.placeCursor;
  g.choose = Ea;
  t = Fa.prototype = new b();
  t.html_template = ['<span class="array"></span>', "<span></span>"];
  t.latex = function () {
    return (
      "\\begin{matrix}" +
      this.foldChildren([], function (d, m) {
        d.push(m.latex());
        return d;
      }).join("\\\\ ") +
      "\\end{matrix}"
    );
  };
  t.text = function () {
    return (
      "[" +
      this.foldChildren([], function (d, m) {
        d.push(m.text());
        return d;
      }).join() +
      "]"
    );
  };
  t.placeCursor = function (d) {
    this.cursor = d.appendTo(this.firstChild);
  };
  t.keydown = function (d) {
    var m = this.cursor.parent;
    if (m.parent === this) {
      if (13 === d.which)
        return (
          (d = new k()),
          (d.parent = this),
          (d.jQ = K("<span></span>")
            .data("[[mathquill internal data]]", { block: d })
            .insertAfter(m.jQ)),
          m.next ? (m.next.prev = d) : (this.lastChild = d),
          (d.next = m.next),
          (m.next = d),
          (d.prev = m),
          this.cursor.appendTo(d).redraw(),
          !1
        );
      if (9 === d.which && !d.shiftKey && !m.next) {
        if (m.isEmpty())
          return m.prev
            ? (this.cursor.insertAfter(this),
              delete m.prev.next,
              (this.lastChild = m.prev),
              m.jQ.remove(),
              this.cursor.redraw(),
              !1)
            : this.parent.keydown(d);
        d = new k();
        d.parent = this;
        d.jQ = K("<span></span>")
          .data("[[mathquill internal data]]", { block: d })
          .appendTo(this.jQ);
        this.lastChild = d;
        m.next = d;
        d.prev = m;
        this.cursor.appendTo(d).redraw();
        return !1;
      }
      if (8 === d.which) {
        if (m.isEmpty())
          return (
            m.prev
              ? (this.cursor.appendTo(m.prev), (m.prev.next = m.next))
              : (this.cursor.insertBefore(this), (this.firstChild = m.next)),
            m.next ? (m.next.prev = m.prev) : (this.lastChild = m.prev),
            m.jQ.remove(),
            this.isEmpty() ? this.cursor.deleteForward() : this.cursor.redraw(),
            !1
          );
        if (!this.cursor.prev) return !1;
      }
    }
    return this.parent.keydown(d);
  };
  g.vector = Fa;
  t = wa.prototype = new b();
  t.html_template = ['<table class="matrix"/>'];
  t.initBlocks = function (d) {
    this.tablejQ = this.jQ;
    this.initMatrix(d);
  };
  t.initMatrix = function (d) {
    if (this.rows === O) {
      do {
        var m = prompt(
          'Please enter the number of rows and columns in the NxM format.\nFor example, for a 2x3 matrix, please enter "2x3" (without quotes):'
        ).split(/[x ,]/);
        if (2 === m.length)
          var r = parseInt(m[0]),
            z = parseInt(m[1]);
      } while (!(0 < r && 0 < z));
    } else (r = this.rows), (z = this.cols);
    var B;
    m = 0;
    this.matrix = [];
    for (var F = 0; F < r; F += 1) {
      var H = [];
      this.matrix.push(H);
      for (
        var E = (H.jQ = K("<tr/>").appendTo(this.tablejQ)), Q = 0;
        Q < z;
        Q += 1
      )
        0 === F && 0 === Q
          ? (this.firstChild = B = (d && d.blockify()) || new k())
          : (B = new k()),
          (B.parent = this),
          (B.prev = m),
          (m = m.next = B),
          (B.row = F),
          (B.col = Q),
          (B.jQ = K("<td/>")
            .data("[[mathquill internal data]]", { block: B })
            .append(B.jQ)
            .appendTo(E)),
          H.push(B),
          B.blur();
    }
    this.lastChild = m;
  };
  t.latex = function () {
    for (var d = [], m = 0; m < this.matrix.length; m += 1) {
      for (var r = [], z = this.matrix[m], B = 0; B < z.length; B += 1)
        r.push(z[B].latex());
      d.push(r.join("&"));
    }
    return [
      "\\begin{" + this.envName + "}",
      d.join("\\\\ "),
      "\\end{" + this.envName + "}",
    ].join("");
  };
  t.text = function () {
    for (var d = [], m = 0; m < this.matrix.length; m += 1) {
      for (var r = [], z = this.matrix[m], B = 0; B < z.length; B += 1)
        r.push(z[B].text());
      d.push(r.join(", "));
    }
    return "[\n [" + d.join("],\n [") + "]\n]";
  };
  t.placeCursor = function (d) {
    this.cursor = d.appendTo(this.firstChild);
  };
  t.keydown = function (d) {
    var m = this.cursor.parent;
    if (m.parent === this)
      if (8 === d.which) {
        if (!this.cursor.prev && !this.cursor.selection) return !1;
      } else if (46 === d.which) {
        if (!this.cursor.prev && !this.cursor.selection) return !1;
      } else if (/^13|38|40$/.test(d.which)) {
        var r = m.row;
        m = m.col;
        (13 === d.which ? d.shiftKey : 38 === d.which)
          ? 0 < r && this.cursor.appendTo(this.matrix[r - 1][m])
          : r < this.matrix.length - 1 &&
            this.cursor.prependTo(this.matrix[r + 1][m]);
      }
    return this.parent.keydown(d);
  };
  t.textInput = function (d) {
    if ("\t" !== d && "\n" !== d) return this.parent.textInput(d);
  };
  g.smallmatrix = g.matrix = wa;
  Ga.prototype = wa.prototype;
  ia("pmatrix", "(", ")");
  ia("bmatrix", "[", "]");
  ia("Bmatrix", "{", "}");
  ia("vmatrix", "|", "|");
  ia("Vmatrix", "&#8214;", "&#8214;");
  ia("cases", "{", "&nbsp;");
  g.editable = h(v, function () {
    this.init("\\editable");
    n(this.jQ, this.firstChild, !1, !0);
    var d;
    this.placeCursor = function (m) {
      d = m.appendTo(this.firstChild);
    };
    this.firstChild.blur = function () {
      d.prev === this.parent &&
        (delete this.blur,
        this.cursor.appendTo(this),
        k.prototype.blur.call(this));
    };
    this.latex = function () {
      return this.firstChild.latex();
    };
    this.text = function () {
      return this.firstChild.text();
    };
  });
  t = T.prototype = new e();
  t.text = function () {
    var d = this.cmd;
    !this.prev ||
      this.prev instanceof T ||
      this.prev instanceof J ||
      (d = "*" + d);
    !this.next || this.next instanceof J || "^" === this.next.cmd || (d += "*");
    return d;
  };
  u.prototype = e.prototype;
  xa.prototype = e.prototype;
  xa.redraw = function () {
    var d =
      this.blockjQ.outerHeight() / +this.blockjQ.css("fontSize").slice(0, -2);
    da(this.bracketjQs, na(1 + 0.3 * (d - 1), 1.3), 1.05 * d);
  };
  t = Ha.prototype = new u();
  t.precedence = 0.5;
  U[" "] = U["#"] = Ha;
  g.prime = g["'"] = U["'"] = c(u, "'", "<big>\u2032</big>");
  ja.prototype = e.prototype;
  g["@"] = ja;
  g["&"] = c(ja, "\\&", "&");
  g["%"] = c(ja, "\\%", "%");
  g.alpha =
    g.beta =
    g.gamma =
    g.delta =
    g.zeta =
    g.eta =
    g.theta =
    g.iota =
    g.kappa =
    g.mu =
    g.nu =
    g.xi =
    g.rho =
    g.sigma =
    g.tau =
    g.chi =
    g.psi =
    g.omega =
      h(e, function (d, m) {
        T.call(this, "\\" + m + " ", "&" + m + ";");
      });
  g.phi = c(T, "\\phi ", "&#981;");
  g.phiv = g.varphi = c(T, "\\varphi ", "&phi;");
  g.epsilon = c(T, "\\epsilon ", "&#1013;");
  g.epsiv = g.varepsilon = c(T, "\\varepsilon ", "&epsilon;");
  g.piv = g.varpi = c(T, "\\varpi ", "&piv;");
  g.sigmaf = g.sigmav = g.varsigma = c(T, "\\varsigma ", "&sigmaf;");
  g.thetav = g.vartheta = g.thetasym = c(T, "\\vartheta ", "&thetasym;");
  g.upsilon = g.upsi = c(T, "\\upsilon ", "&upsilon;");
  g.gammad = g.Gammad = g.digamma = c(T, "\\digamma ", "&#989;");
  g.kappav = g.varkappa = c(T, "\\varkappa ", "&#1008;");
  g.rhov = g.varrho = c(T, "\\varrho ", "&#1009;");
  g.pi = g["\u03c0"] = c(ja, "\\pi ", "&pi;");
  g.lambda = c(ja, "\\lambda ", "&lambda;");
  g.Upsilon =
    g.Upsi =
    g.upsih =
    g.Upsih =
      c(e, "\\Upsilon ", '<var style="font-family: serif">&upsih;</var>');
  g.Gamma =
    g.Delta =
    g.Theta =
    g.Lambda =
    g.Xi =
    g.Pi =
    g.Sigma =
    g.Phi =
    g.Psi =
    g.Omega =
    g.forall =
      h(e, function (d, m) {
        u.call(this, "\\" + m + " ", "&" + m + ";");
      });
  t = J.prototype = new e();
  t.precedence = 1;
  t = la.prototype = new J();
  t.respace = function () {
    this.jQ[0].className = this.prev
      ? this.prev instanceof J && this.next && !(this.next instanceof J)
        ? "unary-operator"
        : "binary-operator"
      : "";
    return this;
  };
  g["+"] = c(la, "+", "+");
  g["\u2013"] = g["-"] = c(la, "-", "&minus;");
  g["\u00b1"] = g.pm = g.plusmn = g.plusminus = c(la, "\\pm ", "&plusmn;");
  g.mp = g.mnplus = g.minusplus = c(la, "\\mp ", "&#8723;");
  U["*"] = g.sdot = g.cdot = c(J, "\\cdot ", "&middot;");
  g["="] = c(J, "=", "=");
  g["<"] = c(J, "<", "&lt;");
  g[">"] = c(J, ">", "&gt;");
  g.notin =
    g.sim =
    g.cong =
    g.equiv =
    g.oplus =
    g.otimes =
      h(J, function (d, m) {
        J.call(this, "\\" + m + " ", "&" + m + ";");
      });
  g.times = h(J, function (d, m) {
    J.call(this, "\\times ", "&times;", "[x]");
  });
  g["\u00f7"] =
    g.div =
    g.divide =
    g.divides =
      c(J, "\\div ", "&divide;", "[/]");
  g["\u2260"] = g.ne = g.neq = c(J, "\\ne ", "&ne;");
  g.ast = g.star = g.loast = g.lowast = c(J, "\\ast ", "&lowast;");
  g.therefor = g.therefore = c(J, "\\therefore ", "&there4;");
  g.cuz = g.because = c(J, "\\because ", "&#8757;");
  g.prop = g.propto = c(J, "\\propto ", "&prop;");
  g["\u2248"] = g.asymp = g.approx = c(J, "\\approx ", "&asymp;");
  g.lt = c(J, "<", "&lt;");
  g.gt = c(J, ">", "&gt;");
  g["\u2264"] = g.le = g.leq = c(J, "\\le ", "&le;");
  g["\u2265"] = g.ge = g.geq = c(J, "\\ge ", "&ge;");
  g.isin = g["in"] = c(J, "\\in ", "&isin;");
  g.ni = g.contains = c(J, "\\ni ", "&ni;");
  g.notni =
    g.niton =
    g.notcontains =
    g.doesnotcontain =
      c(J, "\\not\\ni ", "&#8716;");
  g.sub = g.subset = c(J, "\\subset ", "&sub;");
  g.supset = g.superset = c(J, "\\supset ", "&sup;");
  g.sup = ra;
  g.nsub =
    g.notsub =
    g.nsubset =
    g.notsubset =
      c(J, "\\not\\subset ", "&#8836;");
  g.nsup =
    g.notsup =
    g.nsupset =
    g.notsupset =
    g.nsuperset =
    g.notsuperset =
      c(J, "\\not\\supset ", "&#8837;");
  g.sube = g.subeq = g.subsete = g.subseteq = c(J, "\\subseteq ", "&sube;");
  g.supe =
    g.supeq =
    g.supsete =
    g.supseteq =
    g.supersete =
    g.superseteq =
      c(J, "\\supseteq ", "&supe;");
  g.nsube =
    g.nsubeq =
    g.notsube =
    g.notsubeq =
    g.nsubsete =
    g.nsubseteq =
    g.notsubsete =
    g.notsubseteq =
      c(J, "\\not\\subseteq ", "&#8840;");
  g.nsupe =
    g.nsupeq =
    g.notsupe =
    g.notsupeq =
    g.nsupsete =
    g.nsupseteq =
    g.notsupsete =
    g.notsupseteq =
    g.nsupersete =
    g.nsuperseteq =
    g.notsupersete =
    g.notsuperseteq =
      c(J, "\\not\\supseteq ", "&#8841;");
  aa.prototype = new e();
  g["\u2211"] = g.sum = g.summation = c(aa, "\\sum ", "&sum;");
  g["\u220f"] = g.prod = g.product = c(aa, "\\prod ", "&prod;");
  g.coprod = g.coproduct = c(aa, "\\coprod ", "&#8720;");
  g["\u222b"] = g["int"] = g.integral = c(aa, "\\int ", "&int;");
  g.N = g.naturals = g.Naturals = c(u, "\\mathbb{N}", "&#8469;");
  g.P =
    g.primes =
    g.Primes =
    g.projective =
    g.Projective =
    g.probability =
    g.Probability =
      c(u, "\\mathbb{P}", "&#8473;");
  g.Z = g.integers = g.Integers = c(u, "\\mathbb{Z}", "&#8484;");
  g.Q = g.rationals = g.Rationals = c(u, "\\mathbb{Q}", "&#8474;");
  g.R = g.reals = g.Reals = c(u, "\\mathbb{R}", "&#8477;");
  g.C =
    g.complex =
    g.Complex =
    g.complexes =
    g.Complexes =
    g.complexplane =
    g.Complexplane =
    g.ComplexPlane =
      c(u, "\\mathbb{C}", "&#8450;");
  g.quad = g.emsp = c(u, "\\quad ", "&nbsp;&nbsp;&nbsp;&nbsp;");
  g.qquad = c(
    u,
    "\\qquad ",
    "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
  );
  g.diamond = c(u, "\\diamond ", "&#9671;");
  g.bigtriangleup = c(u, "\\bigtriangleup ", "&#9651;");
  g.ominus = c(u, "\\ominus ", "&#8854;");
  g.uplus = c(u, "\\uplus ", "&#8846;");
  g.bigtriangledown = c(u, "\\bigtriangledown ", "&#9661;");
  g.sqcap = c(u, "\\sqcap ", "&#8851;");
  g.triangleleft = c(u, "\\triangleleft ", "&#8882;");
  g.sqcup = c(u, "\\sqcup ", "&#8852;");
  g.triangleright = c(u, "\\triangleright ", "&#8883;");
  g.odot = c(u, "\\odot ", "&#8857;");
  g.bigcirc = c(u, "\\bigcirc ", "&#9711;");
  g.dagger = c(u, "\\dagger ", "&#0134;");
  g.ddagger = c(u, "\\ddagger ", "&#135;");
  g.wr = c(u, "\\wr ", "&#8768;");
  g.amalg = c(u, "\\amalg ", "&#8720;");
  g.models = c(u, "\\models ", "&#8872;");
  g.prec = c(u, "\\prec ", "&#8826;");
  g.succ = c(u, "\\succ ", "&#8827;");
  g.preceq = c(u, "\\preceq ", "&#8828;");
  g.succeq = c(u, "\\succeq ", "&#8829;");
  g.simeq = c(u, "\\simeq ", "&#8771;");
  g.mid = c(u, "\\mid ", "&#8739;");
  g.matrixmid = c(xa, "\\matrixmid ", "&#8739;");
  g.ll = c(u, "\\ll ", "&#8810;");
  g.gg = c(u, "\\gg ", "&#8811;");
  g.parallel = c(u, "\\parallel ", "&#8741;");
  g.bowtie = c(u, "\\bowtie ", "&#8904;");
  g.sqsubset = c(u, "\\sqsubset ", "&#8847;");
  g.sqsupset = c(u, "\\sqsupset ", "&#8848;");
  g.smile = c(u, "\\smile ", "&#8995;");
  g.sqsubseteq = c(u, "\\sqsubseteq ", "&#8849;");
  g.sqsupseteq = c(u, "\\sqsupseteq ", "&#8850;");
  g.doteq = c(u, "\\doteq ", "&#8784;");
  g.frown = c(u, "\\frown ", "&#8994;");
  g.vdash = c(u, "\\vdash ", "&#8870;");
  g.dashv = c(u, "\\dashv ", "&#8867;");
  g.longleftarrow = c(u, "\\longleftarrow ", "&#8592;");
  g.longrightarrow = c(u, "\\longrightarrow ", "&#8594;");
  g.Longleftarrow = c(u, "\\Longleftarrow ", "&#8656;");
  g.Longrightarrow = c(u, "\\Longrightarrow ", "&#8658;");
  g.longleftrightarrow = c(u, "\\longleftrightarrow ", "&#8596;");
  g.updownarrow = c(u, "\\updownarrow ", "&#8597;");
  g.Longleftrightarrow = c(u, "\\Longleftrightarrow ", "&#8660;");
  g.Updownarrow = c(u, "\\Updownarrow ", "&#8661;");
  g.mapsto = c(u, "\\mapsto ", "&#8614;");
  g.nearrow = c(u, "\\nearrow ", "&#8599;");
  g.hookleftarrow = c(u, "\\hookleftarrow ", "&#8617;");
  g.hookrightarrow = c(u, "\\hookrightarrow ", "&#8618;");
  g.searrow = c(u, "\\searrow ", "&#8600;");
  g.leftharpoonup = c(u, "\\leftharpoonup ", "&#8636;");
  g.rightharpoonup = c(u, "\\rightharpoonup ", "&#8640;");
  g.swarrow = c(u, "\\swarrow ", "&#8601;");
  g.leftharpoondown = c(u, "\\leftharpoondown ", "&#8637;");
  g.rightharpoondown = c(u, "\\rightharpoondown ", "&#8641;");
  g.nwarrow = c(u, "\\nwarrow ", "&#8598;");
  g.ldots = c(u, "\\ldots ", "&#8230;");
  g.cdots = c(u, "\\cdots ", "&#8943;");
  g.vdots = c(u, "\\vdots ", "&#8942;");
  g.ddots = c(u, "\\ddots ", "&#8945;");
  g.surd = c(u, "\\surd ", "&#8730;");
  g.triangle = c(u, "\\triangle ", "&#9653;");
  g.ell = c(u, "\\ell ", "&#8467;");
  g.top = c(u, "\\top ", "&#8868;");
  g.flat = c(u, "\\flat ", "&#9837;");
  g.natural = c(u, "\\natural ", "&#9838;");
  g.sharp = c(u, "\\sharp ", "&#9839;");
  g.wp = c(u, "\\wp ", "&#8472;");
  g.bot = c(u, "\\bot ", "&#8869;");
  g.clubsuit = c(u, "\\clubsuit ", "&#9827;");
  g.diamondsuit = c(u, "\\diamondsuit ", "&#9826;");
  g.heartsuit = c(u, "\\heartsuit ", "&#9825;");
  g.spadesuit = c(u, "\\spadesuit ", "&#9824;");
  g.oint = c(u, "\\oint ", "&#8750;");
  g.bigcap = c(u, "\\bigcap ", "&#8745;");
  g.bigcup = c(u, "\\bigcup ", "&#8746;");
  g.bigsqcup = c(u, "\\bigsqcup ", "&#8852;");
  g.bigvee = c(u, "\\bigvee ", "&#8744;");
  g.bigwedge = c(u, "\\bigwedge ", "&#8743;");
  g.bigodot = c(u, "\\bigodot ", "&#8857;");
  g.bigotimes = c(u, "\\bigotimes ", "&#8855;");
  g.bigoplus = c(u, "\\bigoplus ", "&#8853;");
  g.biguplus = c(u, "\\biguplus ", "&#8846;");
  g.lfloor = c(u, "\\lfloor ", "&#8970;");
  g.rfloor = c(u, "\\rfloor ", "&#8971;");
  g.lceil = c(u, "\\lceil ", "&#8968;");
  g.rceil = c(u, "\\rceil ", "&#8969;");
  g.slash = c(u, "\\slash ", "&#47;");
  g.opencurlybrace = c(u, "\\opencurlybrace ", "&#123;");
  g.closecurlybrace = c(u, "\\closecurlybrace ", "&#125;");
  g.caret = c(u, "\\caret ", "^");
  g.underscore = c(u, "\\underscore ", "_");
  g.backslash = c(u, "\\backslash ", "\\");
  g.vert = c(u, "|");
  g.perp = g.perpendicular = c(u, "\\perp ", "&perp;");
  g.nabla = g.del = c(u, "\\nabla ", "&nabla;");
  g.hbar = c(u, "\\hbar ", "&#8463;");
  g.textdiv = c(u, "\\textdiv ", "&#247;");
  g.marker = c(u, "\\marker ", "&#9646;");
  g.msquare = c(u, "\\msquare ", "&#9633;");
  g.square = c(u, "\\square ", "&#9744;");
  g.bsquare = c(u, "\\bsquare ", "&#9724;");
  g.hspace = c(u, "\\hspace ", "&#8201;");
  g.notequal = c(u, "\\not= ", "&#8800;");
  g.blacksquare = c(u, "\\blacksquare= ", "&#9642;");
  g.hybull = c(u, "\\hybull", "&#8259;");
  g.ding = c(u, "\\ding", "&#9830;");
  g.whiteVerticalRectangle = c(u, "\\whiteVerticalRectangle", "&#9647;");
  g.leftFiveEigthsBlock = c(u, "\\leftFiveEigthsBlock", "&#9611;");
  g.rightHalfBlock = c(u, "\\rightHalfBlock", "&#9616;");
  g.space = c(u, "\\space", "&#8197;");
  g.smallspace = c(u, "\\smallspace", "&#8201;");
  g.hairspace = c(u, "\\smallspace", "&#8202;");
  g.emptyspace = c(u, "\\emptyspace", "&#8203;");
  g.dollar = c(u, "\\dollar", "$");
  g.AA = g.Angstrom = g.angstrom = c(u, "\\text\\AA ", "&#8491;");
  g.ring = g.circ = g.circle = c(u, "\\circ ", "&#9702;");
  g.bull = g.bullet = c(u, "\\bullet ", "&bull;");
  g.setminus = g.smallsetminus = c(u, "\\setminus ", "&#8726;");
  g.not = g["\u00ac"] = g.neg = c(u, "\\neg ", "&not;");
  g["\u2026"] =
    g.dots =
    g.ellip =
    g.hellip =
    g.ellipsis =
    g.hellipsis =
      c(u, "\\dots ", "&hellip;");
  g.converges =
    g.darr =
    g.dnarr =
    g.dnarrow =
    g.downarrow =
      c(u, "\\downarrow ", "&darr;");
  g.dArr = g.dnArr = g.dnArrow = g.Downarrow = c(u, "\\Downarrow ", "&dArr;");
  g.diverges = g.uarr = g.uparrow = c(u, "\\uparrow ", "&uarr;");
  g.uArr = g.Uparrow = c(u, "\\Uparrow ", "&uArr;");
  g.to = c(J, "\\to ", "&rarr;");
  g.rarr = g.rightarrow = c(u, "\\rightarrow ", "&rarr;");
  g.implies = c(J, "\\Rightarrow ", "&rArr;");
  g.rArr = g.Rightarrow = c(u, "\\Rightarrow ", "&rArr;");
  g.gets = c(J, "\\gets ", "&larr;");
  g.larr = g.leftarrow = c(u, "\\leftarrow ", "&larr;");
  g.impliedby = c(J, "\\Leftarrow ", "&lArr;");
  g.lArr = g.Leftarrow = c(u, "\\Leftarrow ", "&lArr;");
  g.harr = g.lrarr = g.leftrightarrow = c(u, "\\leftrightarrow ", "&harr;");
  g.iff = c(J, "\\Leftrightarrow ", "&hArr;");
  g.hArr = g.lrArr = g.Leftrightarrow = c(u, "\\Leftrightarrow ", "&hArr;");
  g.Re = g.Real = g.real = c(u, "\\Re ", "&real;");
  g.Im =
    g.imag =
    g.image =
    g.imagin =
    g.imaginary =
    g.Imaginary =
      c(u, "\\Im ", "&image;");
  g.part = g.partial = c(u, "\\partial ", "&part;");
  g.inf = g.infin = g.infty = g.infinity = c(u, "\\infty ", "&infin;");
  g.alef = g.alefsym = g.aleph = g.alephsym = c(u, "\\aleph ", "&alefsym;");
  g.xist = g.xists = g.exist = g.exists = c(u, "\\exists ", "&exist;");
  g.and = g.land = g.wedge = c(u, "\\wedge ", "&and;");
  g.or = g.lor = g.vee = c(u, "\\vee ", "&or;");
  g.o =
    g.O =
    g.empty =
    g.emptyset =
    g.oslash =
    g.Oslash =
    g.nothing =
    g.varnothing =
      c(J, "\\varnothing ", "&empty;");
  g.cup = g.union = c(J, "\\cup ", "&cup;");
  g.cap = g.intersect = g.intersection = c(J, "\\cap ", "&cap;");
  g.deg = g.degree = c(u, "^{\\circ} ", "&deg;");
  g.ang = g.angle = c(u, "\\angle ", "&ang;");
  t = ra.prototype = new e();
  t.respace = function () {
    this.jQ[0].className =
      this.next instanceof x || this.next instanceof L
        ? ""
        : "non-italicized-function";
  };
  g.exp =
    g.at =
    g.tr =
    g.det =
    g.rk =
    g.adj =
    g.ln =
    g.lg =
    g.log =
    g.span =
    g.proj =
    g.det =
    g.dim =
    g.min =
    g.max =
    g.mod =
    g.lcm =
    g.gcd =
    g.gcf =
    g.hcf =
    g.lim =
      ra;
  (function () {
    var d = "sin cos tan sec cosec csc cotan cot".split(" "),
      m;
    for (m in d)
      g[d[m]] =
        g[d[m] + "h"] =
        g["a" + d[m]] =
        g["arc" + d[m]] =
        g["a" + d[m] + "h"] =
        g["arc" + d[m] + "h"] =
          ra;
  })();
  t = ta.prototype;
  t.prev = 0;
  t.next = 0;
  t.parent = 0;
  t.show = function () {
    this.jQ = this._jQ.removeClass("blink");
    "intervalId" in this
      ? clearInterval(this.intervalId)
      : (this.next
          ? this.selection && this.selection.prev === this.prev
            ? this.jQ.insertBefore(this.selection.jQ)
            : this.jQ.insertBefore(this.next.jQ.first())
          : this.jQ.appendTo(this.parent.jQ),
        this.parent.focus());
    this.intervalId = setInterval(this.blink, 500);
    return this;
  };
  t.hide = function () {
    "intervalId" in this && clearInterval(this.intervalId);
    delete this.intervalId;
    this.jQ.detach();
    this.jQ = K();
    return this;
  };
  t.redraw = function () {
    for (var d = this.parent; d; d = d.parent) d.redraw && d.redraw();
  };
  t.insertAt = function (d, m, r) {
    var z = this.parent;
    this.parent = d;
    this.prev = m;
    this.next = r;
    z.blur();
  };
  t.insertBefore = function (d) {
    this.insertAt(d.parent, d.prev, d);
    this.parent.jQ.addClass("hasCursor");
    this.jQ.insertBefore(d.jQ.first());
    return this;
  };
  t.insertAfter = function (d) {
    this.insertAt(d.parent, d, d.next);
    this.parent.jQ.addClass("hasCursor");
    this.jQ.insertAfter(d.jQ.last());
    return this;
  };
  t.prependTo = function (d) {
    this.insertAt(d, 0, d.firstChild);
    d.textarea ? this.jQ.insertAfter(d.textarea) : this.jQ.prependTo(d.jQ);
    d.focus();
    return this;
  };
  t.appendTo = function (d) {
    this.insertAt(d, d.lastChild, 0);
    this.jQ.appendTo(d.jQ);
    d.focus();
    return this;
  };
  t.hopLeft = function () {
    this.jQ.insertBefore(this.prev.jQ.first());
    this.next = this.prev;
    this.prev = this.prev.prev;
    return this;
  };
  t.hopRight = function () {
    this.jQ.insertAfter(this.next.jQ.last());
    this.prev = this.next;
    this.next = this.next.next;
    return this;
  };
  t.moveLeft = function () {
    this.selection
      ? this.insertBefore(
          this.selection.prev.next || this.parent.firstChild
        ).clearSelection()
      : this.prev
      ? this.prev.lastChild
        ? this.appendTo(this.prev.lastChild)
        : this.hopLeft()
      : this.parent.prev
      ? this.appendTo(this.parent.prev)
      : this.parent !== this.root && this.insertBefore(this.parent.parent);
    return this.show();
  };
  t.moveRight = function () {
    this.selection
      ? this.insertAfter(
          this.selection.next.prev || this.parent.lastChild
        ).clearSelection()
      : this.next
      ? this.next.firstChild
        ? this.prependTo(this.next.firstChild)
        : this.hopRight()
      : this.parent.next
      ? this.prependTo(this.parent.next)
      : this.parent !== this.root && this.insertAfter(this.parent.parent);
    return this.show();
  };
  t.seek = function (d, m, r) {
    r = this.clearSelection();
    if (d.hasClass("empty"))
      return r.prependTo(d.data("[[mathquill internal data]]").block), r;
    var z = d.data("[[mathquill internal data]]");
    if (z) {
      if (z.cmd && !z.block)
        return (
          d.outerWidth() > 2 * (m - d.offset().left)
            ? r.insertBefore(z.cmd)
            : r.insertAfter(z.cmd),
          r
        );
    } else
      (d = d.parent()),
        (z = d.data("[[mathquill internal data]]")) || (z = { block: r.root });
    z.cmd ? r.insertAfter(z.cmd) : r.appendTo(z.block);
    d = r.jQ.offset().left - m;
    do r.moveLeft(), (z = d), (d = r.jQ.offset().left - m);
    while (0 < d && (r.prev || r.parent !== r.root));
    -d > z && r.moveRight();
    return r;
  };
  t.replaceIntervalParentheses = function (d) {
    for (var m = [], r = [], z = 0; z < d.length; z++) {
      var B = d[z];
      "(" === B || "[" === B
        ? r.push({ ind: z, type: B })
        : ")" === B
        ? (B = r.pop()) &&
          "[" === B.type &&
          (m.push({ index: B.ind, value: "LEFTCLOSED" }),
          m.push({ index: z, value: "RIGHTOPEN" }))
        : "]" === B &&
          (B = r.pop()) &&
          "(" === B.type &&
          (m.push({ index: B.ind, value: "LEFTOPEN" }),
          m.push({ index: z, value: "RIGHTCLOSED" }));
    }
    for (r = m.length - 1; 0 <= r; r--) d = d.replaceAt(m[r].index, m[r].value);
    return d;
  };
  t.writeLatex = function (d) {
    this.root.hidePlaceholder();
    this.deleteSelection();
    if (0 > d.indexOf("matrix") && 1e3 < d.length) return this.hide();
    d = d.replace(/\\sqrt\[(.+?)\]/g, "\\nthroot-$1-");
    d = d.replace(/\\nthroot\[(.+?)\]/g, "\\nthroot-$1-");
    d = this.replaceIntervalParentheses(d);
    d = d.replace(/(\\left\s*\(|\()/g, "\\left(");
    d = d.replace(/(\\right\s*\)|\))/g, "\\right)");
    d = d.replace(/(\\left\s*\[|\[)/g, "\\left[");
    d = d.replace(/(\\right\s*\]|\])/g, "\\right]");
    d = d.replace(/\\nthroot-(.+?)-/g, "\\nthroot[$1]");
    d = d.replace(/^\\left([\(\[])$/, "$1");
    d = d.replace(/^\\right([\)\]])$/, "$1");
    d = d.replace(/\\int(#| )(_|^)/g, "\\int$2");
    d = d.replace(/"/g, "");
    d = d.replace(/\*/g, "\\cdot ");
    d = d.replace(/\$/g, "");
    d = d.replace(/\\%/g, "%");
    d = d.replace(/([a-z])\\circ/g, "$1\\:\\circ");
    d = d.replace(/LEFTOPEN/g, "(");
    d = d.replace(/LEFTCLOSED/g, "[");
    d = d.replace(/RIGHTOPEN/g, ")");
    d = d.replace(/RIGHTCLOSED/g, "]");
    d = d.replace(/\\land/g, "\\quad\\mathrm{and}\\quad ");
    d = d.replace(/\\lor/g, "\\quad\\mathrm{or}\\quad ");
    d = d.replace(/f'/g, "f\\:'");
    d =
      ((d = d.replace(/f\\prime/g, "f\\:\\prime")) &&
        d.match(
          /\\(?:begin|end){cases}|\\(?:begin|end){([pbv]|small)?matrix}|\\\\|\\mathbb{[CNPQRZ]}|\\text{([^}]|\\})*}|\\:|\\[a-z]*|[^\s]/gi
        )) ||
      0;
    this.adjustParenScripts(d);
    this.parent.textarea || this.adjustVariables(d);
    this.adjustVariablesHE(d);
    (function B(r, z) {
      if ("]" == d) r.insertNew(new u(d));
      else
        for (; d.length; ) {
          var F = d.shift();
          if (!F || F === z || "\\end{" === F.slice(0, 5)) break;
          if ("&" === F || "\\\\" === F) {
            d.unshift("{");
            break;
          }
          var H;
          if ("\\begin{" === F.slice(0, 7)) {
            F = F.slice(7, -1);
            for (var E = (H = 1), Q = 0; ; Q += 1) {
              var ha = d[Q];
              if ("\\end{" === ha.slice(0, 5)) break;
              else "\\\\" === ha ? (H += 1) : "&" === ha && 1 === H && (E += 1);
            }
            r.insertNew((H = new g[F](O, O, H, E)));
            d.unshift("{");
          } else if ("\\text{" === F.slice(0, 6)) {
            H = new P(F.slice(6, -1));
            r.insertNew(H).insertAfter(H);
            continue;
          } else if ("{" == F) {
            B(r, "}");
            continue;
          } else if (/\\mathbb\{[CNPQRZ]\}/.test(F)) {
            H = new g[F.slice(-2, -1)]();
            r.insertNew(H).insertAfter(H);
            continue;
          } else if ("\\left" === F || "\\right" === F)
            if (
              ((F = d.shift()),
              "\\" === F && (F = d.shift()),
              r.insertCh(F),
              (H = r.prev || r.parent.parent),
              r.prev)
            )
              break;
            else d.unshift("{");
          else if (/^\\[a-z]+$/i.test(F))
            if (((F = F.slice(1)), (H = g[F]))) r.insertNew((H = new H(O, F)));
            else {
              H = new P(F);
              r.insertNew(H).insertAfter(H);
              continue;
            }
          else
            (H = F.match(/[a-zA-Z\u00E1-\u00F3]/)
              ? new T(F)
              : (H = g[F])
              ? new H()
              : "#" == F || "\\:" == F
              ? new U[" "]()
              : new u(F)),
              r.insertNew(H);
          H.eachChild(function (Z) {
            r.appendTo(Z);
            Z = d.shift();
            if (!Z) return !1;
            "{" === Z || "[" === Z
              ? B(r, "{" === Z ? "}" : "]")
              : r.insertCh(Z);
          });
          r.insertAfter(H);
        }
    })(this);
    return this.hide();
  };
  t.write = function (d) {
    return this.show().insertCh(d);
  };
  t.insertCh = function (d) {
    this.selection &&
      ((this.prev = this.selection.prev), (this.next = this.selection.next));
    var m = d.match(/^[a-zA-Z]$/)
      ? new T(d)
      : (m = U[d] || g[d])
      ? new m(this.selection, d)
      : new u(d);
    this.selection &&
      (m instanceof e && this.selection.remove(), delete this.selection);
    return this.insertNew(m);
  };
  t.insertNew = function (d) {
    d.insertAt(this);
    return this;
  };
  t.insertCmd = function (d, m) {
    var r = g[d];
    r
      ? ((r = new r(m, d)),
        this.insertNew(r),
        r instanceof e && m && m.remove())
      : ((r = new P(d)),
        (r.firstChild.focus = function () {
          delete this.focus;
          return this;
        }),
        this.insertNew(r).insertAfter(r),
        m && m.remove());
    return this;
  };
  t.unwrapGramp = function () {
    var d = this.parent.parent,
      m = d.parent,
      r = d.prev;
    d.eachChild(function (z) {
      z.isEmpty() ||
        (z.eachChild(function (B) {
          B.parent = m;
          B.jQ.insertBefore(d.jQ.first());
        }),
        (z.firstChild.prev = r)
          ? (r.next = z.firstChild)
          : (m.firstChild = z.firstChild),
        (r = z.lastChild));
    });
    (r.next = d.next) ? (d.next.prev = r) : (m.lastChild = r);
    if (!this.next)
      if (this.prev) this.next = this.prev.next;
      else
        for (; !this.next; )
          if ((this.parent = this.parent.next))
            this.next = this.parent.firstChild;
          else {
            this.next = d.next;
            this.parent = m;
            break;
          }
    this.next ? this.insertBefore(this.next) : this.appendTo(m);
    d.jQ.remove();
    d.prev && d.prev.respace();
    d.next && d.next.respace();
  };
  t.backspace = function () {
    if (!this.deleteSelection())
      if (this.prev)
        this.prev.isEmpty()
          ? (this.prev = this.prev.remove().prev)
          : this.selectLeft();
      else if (this.parent !== this.root) {
        if (this.parent.parent.isEmpty())
          return this.insertAfter(this.parent.parent).backspace();
        this.unwrapGramp();
      }
    this.prev && this.prev.respace();
    this.next && this.next.respace();
    this.redraw();
    return this;
  };
  t.deleteForward = function () {
    if (!this.deleteSelection())
      if (this.next)
        this.next.isEmpty()
          ? (this.next = this.next.remove().next)
          : this.selectRight();
      else if (this.parent !== this.root) {
        if (this.parent.parent.isEmpty())
          return this.insertBefore(this.parent.parent).deleteForward();
        this.unwrapGramp();
      }
    this.prev && this.prev.respace();
    this.next && this.next.respace();
    this.redraw();
    return this;
  };
  t.selectWord = function () {
    if (this.parent.isEmpty()) return this.selectLeft();
    for (
      var d = this.next, m = this.prev, r = d ? d.precedence : m.precedence;
      d.precedence === r;

    )
      d = d.next;
    for (; m.precedence === r; ) m = m.prev;
    d ? this.insertBefore(d) : this.appendTo(this.parent);
    this.hide().selection = new ma(this.parent, m, d);
  };
  t.selectFrom = function (d) {
    var m = this,
      r = d,
      z = 0;
    a: for (;;) {
      for (var B = this; B !== m.parent.parent; B = B.parent.parent)
        if (B.parent === r.parent) {
          var F = B;
          var H = r;
          break a;
        }
      for (B = d; B !== r.parent.parent; B = B.parent.parent)
        if (m.parent === B.parent) {
          F = m;
          H = B;
          break a;
        }
      m.parent.parent && (m = m.parent.parent);
      r.parent.parent && (r = r.parent.parent);
      if (1e3 < z++) break a;
    }
    if (F.next !== H) {
      for (d = F; d; d = d.next)
        if (d === H.prev) {
          var E = !0;
          break;
        }
      E || ((E = H), (H = F), (F = E));
    }
    this.hide().selection = new ma(F.parent, F.prev, H.next);
    this.insertAfter(H.next.prev || H.parent.lastChild);
    this.root.selectionChanged();
  };
  t.selectLeft = function () {
    if (this.selection)
      if (this.selection.prev === this.prev)
        this.prev
          ? (this.hopLeft().next.jQ.prependTo(this.selection.jQ),
            (this.selection.prev = this.prev))
          : this.parent !== this.root &&
            this.insertBefore(this.parent.parent).selection.levelUp();
      else {
        if (
          (this.prev.jQ.insertAfter(this.selection.jQ),
          (this.hopLeft().selection.next = this.next),
          this.selection.prev === this.prev)
        ) {
          this.deleteSelection();
          return;
        }
      }
    else {
      if (this.prev) this.hopLeft();
      else if (this.parent !== this.root) this.insertBefore(this.parent.parent);
      else return;
      this.hide().selection = new ma(this.parent, this.prev, this.next.next);
    }
    this.root.selectionChanged();
  };
  t.selectRight = function () {
    if (this.selection)
      if (this.selection.next === this.next)
        this.next
          ? (this.hopRight().prev.jQ.appendTo(this.selection.jQ),
            (this.selection.next = this.next))
          : this.parent !== this.root &&
            this.insertAfter(this.parent.parent).selection.levelUp();
      else {
        if (
          (this.next.jQ.insertBefore(this.selection.jQ),
          (this.hopRight().selection.prev = this.prev),
          this.selection.next === this.next)
        ) {
          this.deleteSelection();
          return;
        }
      }
    else {
      if (this.next) this.hopRight();
      else if (this.parent !== this.root) this.insertAfter(this.parent.parent);
      else return;
      this.hide().selection = new ma(this.parent, this.prev.prev, this.next);
    }
    this.root.selectionChanged();
  };
  t.clearSelection = function () {
    this.show().selection &&
      (this.selection.clear(),
      delete this.selection,
      this.root.selectionChanged());
    return this;
  };
  t.deleteSelection = function () {
    if (!this.show().selection) return !1;
    this.prev = this.selection.prev;
    this.next = this.selection.next;
    this.selection.remove();
    delete this.selection;
    this.root.selectionChanged();
    return !0;
  };
  t.adjustVariables = function (d) {
    for (var m = !1, r = 0; r < d.length; r++) {
      var z = d[r];
      ("a" <= z && "z" >= z) ||
      ("A" <= z && "Z" >= z) ||
      ("\u00e1" <= z && "\u00f3" >= z)
        ? (m && ((d[r - 1] += d[r]), d.splice(r, 1), r--), (m = !0))
        : (m = !1);
    }
  };
  t.adjustVariablesHE = function (d) {
    for (var m = !1, r = 0; r < d.length; r++) {
      var z = d[r];
      ("\u05d0" <= z && "\u05ea" >= z) || ("\u0600" <= z && "\u06ff" >= z)
        ? (m && ((d[r - 1] += d[r]), d.splice(r, 1), r--), (m = !0))
        : (m = !1);
    }
  };
  t.adjustParenScripts = function (d) {
    for (var m = 0; m < d.length - 2; m++) {
      var r = d[m];
      if ("^" === r || "_" === r)
        if (((r = d[m + 2]), "\\left" === d[m + 1] && "(" === r)) {
          r = m + 1;
          for (var z = 1, B = m + 3; 0 < z && B < d.length - 1; B++) {
            var F = d[B],
              H = d[B + 1];
            "\\right" === F && ")" === H
              ? z--
              : "\\left" === F && "(" === H && z++;
          }
          0 == z && (d.splice(r, 0, "{"), d.splice(B + 2, 0, "}"));
        }
    }
  };
  t = ma.prototype = new l();
  t.jQinit = function (d) {
    this.jQ = d.wrapAll('<span class="selection"></span>').parent();
  };
  t.levelUp = function () {
    this.clear().jQinit(this.parent.parent.jQ);
    this.prev = this.parent.parent.prev;
    this.next = this.parent.parent.next;
    this.parent = this.parent.parent.parent;
    return this;
  };
  t.clear = function () {
    this.jQ.replaceWith(this.jQ.children());
    return this;
  };
  t.blockify = function () {
    this.jQ.replaceWith((this.jQ = this.jQ.children()));
    return l.prototype.blockify.call(this);
  };
  t.detach = function () {
    var d = l.prototype.blockify.call(this);
    this.blockify = function () {
      this.jQ.replaceWith((d.jQ = this.jQ = this.jQ.children()));
      return d;
    };
    return this;
  };
  K.fn.mathquill = function (d, m, r) {
    switch (d) {
      case "placeholder":
        return this.each(function () {
          var E = K(this).data("[[mathquill internal data]]");
          (E = E && E.block) &&
            E.setPlaceholder &&
            (E.setPlaceholder(m),
            this !== document.activeElement && E.showPlaceholder());
        });
      case "redraw":
        return (
          this.find(":not(:has(:first))").each(function () {
            var E = K(this).data("[[mathquill internal data]]");
            E &&
              (E.cmd || E.block) &&
              ta.prototype.redraw.call(E.cmd || E.block);
          }),
          this
        );
      case "revert":
        return this.each(function () {
          var E = K(this).data("[[mathquill internal data]]");
          E && E.revert && E.revert();
        });
      case "latex":
        if (1 < arguments.length)
          return this.each(function () {
            var E = K(this).data("[[mathquill internal data]]");
            E && E.block && E.block.renderLatex && E.block.renderLatex(m);
          });
        var z = this.data("[[mathquill internal data]]");
        return z && z.block && z.block.latex();
      case "text":
        return (
          (z = this.data("[[mathquill internal data]]")) &&
          z.block &&
          z.block.text()
        );
      case "html":
        return this.html()
          .replace(/ ?hasCursor|hasCursor /, "")
          .replace(/ class=(""|(?= |>))/g, "")
          .replace(/<span class="?cursor( blink)?"?><\/span>/i, "")
          .replace(
            /<span class="?textarea"?><textarea><\/textarea><\/span>/i,
            ""
          );
      case "write":
        if (1 < arguments.length)
          return this.each(function () {
            var E = K(this).data("[[mathquill internal data]]"),
              Q = (E = E && E.block) && E.cursor;
            if (Q) {
              Q.writeLatex(m);
              if (r != O) for (i = 0; i < r; i++) Q.moveLeft();
              E.blur();
            }
          });
      case "cmd":
        if (1 < arguments.length)
          return this.each(function () {
            var E = K(this).data("[[mathquill internal data]]"),
              Q = (E = E && E.block) && E.cursor;
            if (Q) {
              Q.writeLatex(m);
              if (r != O) for (i = 0; i < r; i += 1) Q.moveLeft();
              E.blur();
            }
          });
      case "backspace":
        return this.each(function () {
          var E = K(this).data("[[mathquill internal data]]");
          E = E && E.block;
          (E && E.cursor).backspace();
        });
      case "moveleft":
        return this.each(function () {
          var E = K(this).data("[[mathquill internal data]]"),
            Q = (E = E && E.block) && E.cursor;
          E.focus();
          Q.moveLeft();
        });
      case "moveright":
        return this.each(function () {
          var E = K(this).data("[[mathquill internal data]]"),
            Q = (E = E && E.block) && E.cursor;
          E.focus();
          Q.moveRight();
        });
      default:
        var B = "textbox" === d,
          F = B || "editable" === d,
          H = B ? f : q;
        return this.each(function () {
          n(K(this), new H(), B, F);
        });
    }
  };
  K(function () {
    K(".mathquill-editable:not(.mathquill-rendered-math)").mathquill(
      "editable"
    );
    K(".mathquill-textbox:not(.mathquill-rendered-math)").mathquill("textbox");
    K(".mathquill-embedded-latex:not(.mathquill-rendered-math)").mathquill();
  });
})();
(function (a, b) {
  "function" === typeof define && define.amd
    ? define(["jquery"], function (e) {
        return b(e);
      })
    : "object" === typeof exports
    ? (module.exports = b(require("jquery")))
    : b(jQuery);
})(this, function (a) {
  function b(f) {
    this.$container;
    this.constraints = null;
    this.__$tooltip;
    this.__init(f);
  }
  function e(f, h) {
    var c = !0;
    a.each(f, function (p, w) {
      if (void 0 === h[p] || f[p] !== h[p]) return (c = !1);
    });
    return c;
  }
  function k(f) {
    var h = f.attr("id");
    return (h = h ? q.window.document.getElementById(h) : null)
      ? h === f[0]
      : a.contains(q.window.document.body, f[0]);
  }
  var l = {
      animation: "fade",
      animationDuration: 350,
      content: null,
      contentAsHTML: !1,
      contentCloning: !1,
      debug: !0,
      delay: 300,
      delayTouch: [300, 500],
      functionInit: null,
      functionBefore: null,
      functionReady: null,
      functionAfter: null,
      functionFormat: null,
      IEmin: 6,
      interactive: !1,
      multiple: !1,
      parent: "body",
      plugins: ["sideTip"],
      repositionOnScroll: !1,
      restoration: "none",
      selfDestruction: !0,
      theme: [],
      timer: 0,
      trackerInterval: 500,
      trackOrigin: !1,
      trackTooltip: !1,
      trigger: "hover",
      triggerClose: {
        click: !1,
        mouseleave: !1,
        originClick: !1,
        scroll: !1,
        tap: !1,
        touchleave: !1,
      },
      triggerOpen: { click: !1, mouseenter: !1, tap: !1, touchstart: !1 },
      updateAnimation: "rotate",
      zIndex: 9999999,
    },
    n = "undefined" != typeof window ? window : null,
    q = {
      hasTouchCapability: !(
        !n ||
        !(
          "ontouchstart" in n ||
          (n.DocumentTouch && n.document instanceof n.DocumentTouch) ||
          n.navigator.maxTouchPoints
        )
      ),
      hasTransitions: (function () {
        if (!n) return !1;
        var f = (n.document.body || n.document.documentElement).style,
          h = "transition",
          c = ["Moz", "Webkit", "Khtml", "O", "ms"];
        if ("string" == typeof f[h]) return !0;
        h = h.charAt(0).toUpperCase() + h.substr(1);
        for (var p = 0; p < c.length; p++)
          if ("string" == typeof f[c[p] + h]) return !0;
        return !1;
      })(),
      IE: !1,
      semVer: "4.1.6",
      window: n,
    },
    v = function () {
      this.__$emitterPrivate = a({});
      this.__$emitterPublic = a({});
      this.__instancesLatestArr = [];
      this.__plugins = {};
      this._env = q;
    };
  v.prototype = {
    __bridge: function (f, h, c) {
      if (!h[c]) {
        var p = function () {};
        p.prototype = f;
        var w = new p();
        w.__init && w.__init(h);
        a.each(f, function (y, x) {
          0 != y.indexOf("__") &&
            (h[y]
              ? l.debug &&
                console.log(
                  "The " +
                    y +
                    " method of the " +
                    c +
                    " plugin conflicts with another plugin or native methods"
                )
              : ((h[y] = function () {
                  return w[y].apply(w, Array.prototype.slice.apply(arguments));
                }),
                (h[y].bridged = w)));
        });
        h[c] = w;
      }
      return this;
    },
    __setWindow: function (f) {
      q.window = f;
      return this;
    },
    _getRuler: function (f) {
      return new b(f);
    },
    _off: function () {
      this.__$emitterPrivate.off.apply(
        this.__$emitterPrivate,
        Array.prototype.slice.apply(arguments)
      );
      return this;
    },
    _on: function () {
      this.__$emitterPrivate.on.apply(
        this.__$emitterPrivate,
        Array.prototype.slice.apply(arguments)
      );
      return this;
    },
    _one: function () {
      this.__$emitterPrivate.one.apply(
        this.__$emitterPrivate,
        Array.prototype.slice.apply(arguments)
      );
      return this;
    },
    _plugin: function (f) {
      if ("string" == typeof f) {
        var h = null;
        0 < f.indexOf(".")
          ? (h = this.__plugins[f])
          : a.each(this.__plugins, function (c, p) {
              if (p.name.substring(p.name.length - f.length - 1) == "." + f)
                return (h = p), !1;
            });
        return h;
      }
      if (0 > f.name.indexOf(".")) throw Error("Plugins must be namespaced");
      this.__plugins[f.name] = f;
      f.core && this.__bridge(f.core, this, f.name);
      return this;
    },
    _trigger: function () {
      var f = Array.prototype.slice.apply(arguments);
      "string" == typeof f[0] && (f[0] = { type: f[0] });
      this.__$emitterPrivate.trigger.apply(this.__$emitterPrivate, f);
      this.__$emitterPublic.trigger.apply(this.__$emitterPublic, f);
      return this;
    },
    instances: function (f) {
      var h = [];
      a(f || ".tooltipstered").each(function () {
        var c = a(this),
          p = c.data("tooltipster-ns");
        p &&
          a.each(p, function (w, y) {
            h.push(c.data(y));
          });
      });
      return h;
    },
    instancesLatest: function () {
      return this.__instancesLatestArr;
    },
    off: function () {
      this.__$emitterPublic.off.apply(
        this.__$emitterPublic,
        Array.prototype.slice.apply(arguments)
      );
      return this;
    },
    on: function () {
      this.__$emitterPublic.on.apply(
        this.__$emitterPublic,
        Array.prototype.slice.apply(arguments)
      );
      return this;
    },
    one: function () {
      this.__$emitterPublic.one.apply(
        this.__$emitterPublic,
        Array.prototype.slice.apply(arguments)
      );
      return this;
    },
    origins: function (f) {
      return a((f ? f + " " : "") + ".tooltipstered").toArray();
    },
    setDefaults: function (f) {
      a.extend(l, f);
      return this;
    },
    triggerHandler: function () {
      this.__$emitterPublic.triggerHandler.apply(
        this.__$emitterPublic,
        Array.prototype.slice.apply(arguments)
      );
      return this;
    },
  };
  a.tooltipster = new v();
  a.Tooltipster = function (f, h) {
    this.__callbacks = { close: [], open: [] };
    this.__closingTime;
    this.__Content;
    this.__contentBcr;
    this.__destroying = this.__destroyed = !1;
    this.__$emitterPrivate = a({});
    this.__$emitterPublic = a({});
    this.__enabled = !0;
    this.__garbageCollector;
    this.__Geometry;
    this.__lastPosition;
    this.__namespace = "tooltipster-" + Math.round(1e6 * Math.random());
    this.__options;
    this.__$originParents;
    this.__pointerIsOverOrigin = !1;
    this.__previousThemes = [];
    this.__state = "closed";
    this.__timeouts = { close: [], open: null };
    this.__touchEvents = [];
    this.__tracker = null;
    this._$origin;
    this._$tooltip;
    this.__init(f, h);
  };
  a.Tooltipster.prototype = {
    __init: function (f, h) {
      var c = this;
      c._$origin = a(f);
      c.__options = a.extend(!0, {}, l, h);
      c.__optionsFormat();
      if (!q.IE || q.IE >= c.__options.IEmin) {
        f = null;
        void 0 === c._$origin.data("tooltipster-initialTitle") &&
          ((f = c._$origin.attr("title")),
          void 0 === f && (f = null),
          c._$origin.data("tooltipster-initialTitle", f));
        if (null !== c.__options.content) c.__contentSet(c.__options.content);
        else {
          h = c._$origin.attr("data-tooltip-content");
          var p;
          h && (p = a(h));
          p && p[0] ? c.__contentSet(p.first()) : c.__contentSet(f);
        }
        c._$origin.removeAttr("title").addClass("tooltipstered");
        c.__prepareOrigin();
        c.__prepareGC();
        a.each(c.__options.plugins, function (w, y) {
          c._plug(y);
        });
        if (q.hasTouchCapability)
          a("body").on(
            "touchmove." + c.__namespace + "-triggerOpen",
            function (w) {
              c._touchRecordEvent(w);
            }
          );
        c._on("created", function () {
          c.__prepareTooltip();
        })._on("repositioned", function (w) {
          c.__lastPosition = w.position;
        });
      } else c.__options.disabled = !0;
    },
    __contentInsert: function () {
      var f = this._$tooltip.find(".tooltipster-content"),
        h = this.__Content;
      this._trigger({
        type: "format",
        content: this.__Content,
        format: function (c) {
          h = c;
        },
      });
      this.__options.functionFormat &&
        (h = this.__options.functionFormat.call(
          this,
          this,
          { origin: this._$origin[0] },
          this.__Content
        ));
      "string" !== typeof h || this.__options.contentAsHTML
        ? f.empty().append(h)
        : f.text(h);
      return this;
    },
    __contentSet: function (f) {
      f instanceof a && this.__options.contentCloning && (f = f.clone(!0));
      this.__Content = f;
      this._trigger({ type: "updated", content: f });
      return this;
    },
    __destroyError: function () {
      throw Error(
        "This tooltip has been destroyed and cannot execute your method call."
      );
    },
    __geometry: function () {
      var f = this._$origin,
        h = this._$origin.is("area");
      if (h) {
        var c = this._$origin.parent().attr("name");
        f = a('img[usemap="#' + c + '"]');
      }
      var p = f[0].getBoundingClientRect(),
        w = a(q.window.document),
        y = a(q.window);
      c = f;
      var x = {
        available: { document: null, window: null },
        document: { size: { height: w.height(), width: w.width() } },
        window: {
          scroll: {
            left:
              q.window.scrollX || q.window.document.documentElement.scrollLeft,
            top:
              q.window.scrollY || q.window.document.documentElement.scrollTop,
          },
          size: { height: y.height(), width: y.width() },
        },
        origin: {
          fixedLineage: !1,
          offset: {},
          size: { height: p.bottom - p.top, width: p.right - p.left },
          usemapImage: h ? f[0] : null,
          windowOffset: {
            bottom: p.bottom,
            left: p.left,
            right: p.right,
            top: p.top,
          },
        },
      };
      if (h) {
        h = this._$origin.attr("shape");
        var C = this._$origin.attr("coords");
        C &&
          ((C = C.split(",")),
          a.map(C, function (I, V) {
            C[V] = parseInt(I);
          }));
        if ("default" != h)
          switch (h) {
            case "circle":
              h = C[0];
              f = C[1];
              p = C[2];
              x.origin.size.height = 2 * p;
              x.origin.size.width = x.origin.size.height;
              x.origin.windowOffset.left += h - p;
              x.origin.windowOffset.top += f - p;
              break;
            case "rect":
              h = C[0];
              f = C[1];
              p = C[2];
              x.origin.size.height = C[3] - f;
              x.origin.size.width = p - h;
              x.origin.windowOffset.left += h;
              x.origin.windowOffset.top += f;
              break;
            case "poly":
              w = p = f = h = 0;
              y = "even";
              for (var D = 0; D < C.length; D++) {
                var A = C[D];
                "even" == y
                  ? (A > p && ((p = A), 0 === D && (h = p)),
                    A < h && (h = A),
                    (y = "odd"))
                  : (A > w && ((w = A), 1 == D && (f = w)),
                    A < f && (f = A),
                    (y = "even"));
              }
              x.origin.size.height = w - f;
              x.origin.size.width = p - h;
              x.origin.windowOffset.left += h;
              x.origin.windowOffset.top += f;
          }
      }
      this._trigger({
        type: "geometry",
        edit: function (I) {
          x.origin.size.height = I.height;
          x.origin.windowOffset.left = I.left;
          x.origin.windowOffset.top = I.top;
          x.origin.size.width = I.width;
        },
        geometry: {
          height: x.origin.size.height,
          left: x.origin.windowOffset.left,
          top: x.origin.windowOffset.top,
          width: x.origin.size.width,
        },
      });
      x.origin.windowOffset.right =
        x.origin.windowOffset.left + x.origin.size.width;
      x.origin.windowOffset.bottom =
        x.origin.windowOffset.top + x.origin.size.height;
      x.origin.offset.left = x.origin.windowOffset.left + x.window.scroll.left;
      x.origin.offset.top = x.origin.windowOffset.top + x.window.scroll.top;
      x.origin.offset.bottom = x.origin.offset.top + x.origin.size.height;
      x.origin.offset.right = x.origin.offset.left + x.origin.size.width;
      x.available.document = {
        bottom: {
          height: x.document.size.height - x.origin.offset.bottom,
          width: x.document.size.width,
        },
        left: { height: x.document.size.height, width: x.origin.offset.left },
        right: {
          height: x.document.size.height,
          width: x.document.size.width - x.origin.offset.right,
        },
        top: { height: x.origin.offset.top, width: x.document.size.width },
      };
      for (
        x.available.window = {
          bottom: {
            height: Math.max(
              x.window.size.height - Math.max(x.origin.windowOffset.bottom, 0),
              0
            ),
            width: x.window.size.width,
          },
          left: {
            height: x.window.size.height,
            width: Math.max(x.origin.windowOffset.left, 0),
          },
          right: {
            height: x.window.size.height,
            width: Math.max(
              x.window.size.width - Math.max(x.origin.windowOffset.right, 0),
              0
            ),
          },
          top: {
            height: Math.max(x.origin.windowOffset.top, 0),
            width: x.window.size.width,
          },
        };
        "html" != c[0].tagName.toLowerCase();

      ) {
        if ("fixed" == c.css("position")) {
          x.origin.fixedLineage = !0;
          break;
        }
        c = c.parent();
      }
      return x;
    },
    __optionsFormat: function () {
      "number" == typeof this.__options.animationDuration &&
        (this.__options.animationDuration = [
          this.__options.animationDuration,
          this.__options.animationDuration,
        ]);
      "number" == typeof this.__options.delay &&
        (this.__options.delay = [this.__options.delay, this.__options.delay]);
      "number" == typeof this.__options.delayTouch &&
        (this.__options.delayTouch = [
          this.__options.delayTouch,
          this.__options.delayTouch,
        ]);
      "string" == typeof this.__options.theme &&
        (this.__options.theme = [this.__options.theme]);
      "string" == typeof this.__options.parent &&
        (this.__options.parent = a(this.__options.parent));
      "hover" == this.__options.trigger
        ? ((this.__options.triggerOpen = { mouseenter: !0, touchstart: !0 }),
          (this.__options.triggerClose = {
            mouseleave: !0,
            originClick: !0,
            touchleave: !0,
          }))
        : "click" == this.__options.trigger &&
          ((this.__options.triggerOpen = { click: !0, tap: !0 }),
          (this.__options.triggerClose = { click: !0, tap: !0 }));
      this._trigger("options");
      return this;
    },
    __prepareGC: function () {
      var f = this;
      f.__options.selfDestruction
        ? (f.__garbageCollector = setInterval(function () {
            var h = new Date().getTime();
            f.__touchEvents = a.grep(f.__touchEvents, function (c, p) {
              return 6e4 < h - c.time;
            });
            k(f._$origin) || f.destroy();
          }, 2e4))
        : clearInterval(f.__garbageCollector);
      return f;
    },
    __prepareOrigin: function () {
      var f = this;
      f._$origin.off("." + f.__namespace + "-triggerOpen");
      if (q.hasTouchCapability)
        f._$origin.on(
          "touchstart." +
            f.__namespace +
            "-triggerOpen touchend." +
            f.__namespace +
            "-triggerOpen touchcancel." +
            f.__namespace +
            "-triggerOpen",
          function (c) {
            f._touchRecordEvent(c);
          }
        );
      if (
        f.__options.triggerOpen.click ||
        (f.__options.triggerOpen.tap && q.hasTouchCapability)
      ) {
        var h = "";
        f.__options.triggerOpen.click &&
          (h += "click." + f.__namespace + "-triggerOpen ");
        f.__options.triggerOpen.tap &&
          q.hasTouchCapability &&
          (h += "touchend." + f.__namespace + "-triggerOpen");
        f._$origin.on(h, function (c) {
          f._touchIsMeaningfulEvent(c) && f._open(c);
        });
      }
      if (
        f.__options.triggerOpen.mouseenter ||
        (f.__options.triggerOpen.touchstart && q.hasTouchCapability)
      )
        (h = ""),
          f.__options.triggerOpen.mouseenter &&
            (h += "mouseenter." + f.__namespace + "-triggerOpen "),
          f.__options.triggerOpen.touchstart &&
            q.hasTouchCapability &&
            (h += "touchstart." + f.__namespace + "-triggerOpen"),
          f._$origin.on(h, function (c) {
            if (f._touchIsTouchEvent(c) || !f._touchIsEmulatedEvent(c))
              (f.__pointerIsOverOrigin = !0), f._openShortly(c);
          });
      if (
        f.__options.triggerClose.mouseleave ||
        (f.__options.triggerClose.touchleave && q.hasTouchCapability)
      )
        (h = ""),
          f.__options.triggerClose.mouseleave &&
            (h += "mouseleave." + f.__namespace + "-triggerOpen "),
          f.__options.triggerClose.touchleave &&
            q.hasTouchCapability &&
            (h +=
              "touchend." +
              f.__namespace +
              "-triggerOpen touchcancel." +
              f.__namespace +
              "-triggerOpen"),
          f._$origin.on(h, function (c) {
            f._touchIsMeaningfulEvent(c) && (f.__pointerIsOverOrigin = !1);
          });
      return f;
    },
    __prepareTooltip: function () {
      var f = this,
        h = f.__options.interactive ? "auto" : "";
      f._$tooltip
        .attr("id", f.__namespace)
        .css({ "pointer-events": h, zIndex: f.__options.zIndex });
      a.each(f.__previousThemes, function (c, p) {
        f._$tooltip.removeClass(p);
      });
      a.each(f.__options.theme, function (c, p) {
        f._$tooltip.addClass(p);
      });
      f.__previousThemes = a.merge([], f.__options.theme);
      return f;
    },
    __scrollHandler: function (f) {
      if (this.__options.triggerClose.scroll) this._close(f);
      else {
        if (f.target === q.window.document)
          this.__Geometry.origin.fixedLineage ||
            (this.__options.repositionOnScroll && this.reposition(f));
        else {
          var h = this.__geometry(),
            c = !1;
          "fixed" != this._$origin.css("position") &&
            this.__$originParents.each(function (p, w) {
              p = a(w);
              var y = p.css("overflow-x"),
                x = p.css("overflow-y");
              if ("visible" != y || "visible" != x)
                if (
                  ((w = w.getBoundingClientRect()),
                  ("visible" != y &&
                    (h.origin.windowOffset.left < w.left ||
                      h.origin.windowOffset.right > w.right)) ||
                    ("visible" != x &&
                      (h.origin.windowOffset.top < w.top ||
                        h.origin.windowOffset.bottom > w.bottom)))
                )
                  return (c = !0), !1;
              if ("fixed" == p.css("position")) return !1;
            });
          c
            ? this._$tooltip.css("visibility", "hidden")
            : (this._$tooltip.css("visibility", "visible"),
              this.__options.repositionOnScroll
                ? this.reposition(f)
                : this._$tooltip.css({
                    left:
                      this.__lastPosition.coord.left +
                      (h.origin.offset.left -
                        this.__Geometry.origin.offset.left),
                    top:
                      this.__lastPosition.coord.top +
                      (h.origin.offset.top - this.__Geometry.origin.offset.top),
                  }));
        }
        this._trigger({ type: "scroll", event: f });
      }
      return this;
    },
    __stateSet: function (f) {
      this.__state = f;
      this._trigger({ type: "state", state: f });
      return this;
    },
    __timeoutsClear: function () {
      clearTimeout(this.__timeouts.open);
      this.__timeouts.open = null;
      a.each(this.__timeouts.close, function (f, h) {
        clearTimeout(h);
      });
      this.__timeouts.close = [];
      return this;
    },
    __trackerStart: function () {
      var f = this,
        h = f._$tooltip.find(".tooltipster-content");
      f.__options.trackTooltip &&
        (f.__contentBcr = h[0].getBoundingClientRect());
      f.__tracker = setInterval(function () {
        if (k(f._$origin) && k(f._$tooltip)) {
          if (f.__options.trackOrigin) {
            var c = f.__geometry(),
              p = !1;
            e(c.origin.size, f.__Geometry.origin.size) &&
              (f.__Geometry.origin.fixedLineage
                ? e(c.origin.windowOffset, f.__Geometry.origin.windowOffset) &&
                  (p = !0)
                : e(c.origin.offset, f.__Geometry.origin.offset) && (p = !0));
            p ||
              (f.__options.triggerClose.mouseleave
                ? f._close()
                : f.reposition());
          }
          f.__options.trackTooltip &&
            ((c = h[0].getBoundingClientRect()),
            c.height !== f.__contentBcr.height ||
              c.width !== f.__contentBcr.width) &&
            (f.reposition(), (f.__contentBcr = c));
        } else f._close();
      }, f.__options.trackerInterval);
      return f;
    },
    _close: function (f, h) {
      var c = this,
        p = !0;
      c._trigger({
        type: "close",
        event: f,
        stop: function () {
          p = !1;
        },
      });
      if (p || c.__destroying) {
        h && c.__callbacks.close.push(h);
        c.__callbacks.open = [];
        c.__timeoutsClear();
        var w = function () {
          a.each(c.__callbacks.close, function (x, C) {
            C.call(c, c, { event: f, origin: c._$origin[0] });
          });
          c.__callbacks.close = [];
        };
        if ("closed" != c.__state) {
          h = !0;
          var y = new Date().getTime() + c.__options.animationDuration[1];
          "disappearing" == c.__state && y > c.__closingTime && (h = !1);
          h &&
            ((c.__closingTime = y),
            "disappearing" != c.__state && c.__stateSet("disappearing"),
            (h = function () {
              clearInterval(c.__tracker);
              c._trigger({ type: "closing", event: f });
              c._$tooltip
                .off("." + c.__namespace + "-triggerClose")
                .removeClass("tooltipster-dying");
              a(q.window).off("." + c.__namespace + "-triggerClose");
              c.__$originParents.each(function (x, C) {
                a(C).off("scroll." + c.__namespace + "-triggerClose");
              });
              c.__$originParents = null;
              a("body").off("." + c.__namespace + "-triggerClose");
              c._$origin.off("." + c.__namespace + "-triggerClose");
              c._off("dismissable");
              c.__stateSet("closed");
              c._trigger({ type: "after", event: f });
              c.__options.functionAfter &&
                c.__options.functionAfter.call(c, c, {
                  event: f,
                  origin: c._$origin[0],
                });
              w();
            }),
            q.hasTransitions
              ? (c._$tooltip.css({
                  "-moz-animation-duration":
                    c.__options.animationDuration[1] + "ms",
                  "-ms-animation-duration":
                    c.__options.animationDuration[1] + "ms",
                  "-o-animation-duration":
                    c.__options.animationDuration[1] + "ms",
                  "-webkit-animation-duration":
                    c.__options.animationDuration[1] + "ms",
                  "animation-duration": c.__options.animationDuration[1] + "ms",
                  "transition-duration":
                    c.__options.animationDuration[1] + "ms",
                }),
                c._$tooltip
                  .clearQueue()
                  .removeClass("tooltipster-show")
                  .addClass("tooltipster-dying"),
                0 < c.__options.animationDuration[1] &&
                  c._$tooltip.delay(c.__options.animationDuration[1]),
                c._$tooltip.queue(h))
              : c._$tooltip
                  .stop()
                  .fadeOut(c.__options.animationDuration[1], h));
        } else w();
      }
      return c;
    },
    _off: function () {
      this.__$emitterPrivate.off.apply(
        this.__$emitterPrivate,
        Array.prototype.slice.apply(arguments)
      );
      return this;
    },
    _on: function () {
      this.__$emitterPrivate.on.apply(
        this.__$emitterPrivate,
        Array.prototype.slice.apply(arguments)
      );
      return this;
    },
    _one: function () {
      this.__$emitterPrivate.one.apply(
        this.__$emitterPrivate,
        Array.prototype.slice.apply(arguments)
      );
      return this;
    },
    _open: function (f, h) {
      var c = this;
      if (!c.__destroying && k(c._$origin) && c.__enabled) {
        var p = !0;
        "closed" == c.__state &&
          (c._trigger({
            type: "before",
            event: f,
            stop: function () {
              p = !1;
            },
          }),
          p &&
            c.__options.functionBefore &&
            (p = c.__options.functionBefore.call(c, c, {
              event: f,
              origin: c._$origin[0],
            })));
        if (!1 !== p && null !== c.__Content) {
          h && c.__callbacks.open.push(h);
          c.__callbacks.close = [];
          c.__timeoutsClear();
          var w = function () {
            "stable" != c.__state && c.__stateSet("stable");
            a.each(c.__callbacks.open, function (D, A) {
              A.call(c, c, { origin: c._$origin[0], tooltip: c._$tooltip[0] });
            });
            c.__callbacks.open = [];
          };
          if ("closed" !== c.__state)
            (h = 0),
              "disappearing" === c.__state
                ? (c.__stateSet("appearing"),
                  q.hasTransitions
                    ? (c._$tooltip
                        .clearQueue()
                        .removeClass("tooltipster-dying")
                        .addClass("tooltipster-show"),
                      0 < c.__options.animationDuration[0] &&
                        c._$tooltip.delay(c.__options.animationDuration[0]),
                      c._$tooltip.queue(w))
                    : c._$tooltip.stop().fadeIn(w))
                : "stable" == c.__state && w();
          else {
            c.__stateSet("appearing");
            h = c.__options.animationDuration[0];
            c.__contentInsert();
            c.reposition(f, !0);
            q.hasTransitions
              ? (c._$tooltip
                  .addClass("tooltipster-" + c.__options.animation)
                  .addClass("tooltipster-initial")
                  .css({
                    "-moz-animation-duration":
                      c.__options.animationDuration[0] + "ms",
                    "-ms-animation-duration":
                      c.__options.animationDuration[0] + "ms",
                    "-o-animation-duration":
                      c.__options.animationDuration[0] + "ms",
                    "-webkit-animation-duration":
                      c.__options.animationDuration[0] + "ms",
                    "animation-duration":
                      c.__options.animationDuration[0] + "ms",
                    "transition-duration":
                      c.__options.animationDuration[0] + "ms",
                  }),
                setTimeout(function () {
                  "closed" != c.__state &&
                    (c._$tooltip
                      .addClass("tooltipster-show")
                      .removeClass("tooltipster-initial"),
                    0 < c.__options.animationDuration[0] &&
                      c._$tooltip.delay(c.__options.animationDuration[0]),
                    c._$tooltip.queue(w));
                }, 0))
              : c._$tooltip
                  .css("display", "none")
                  .fadeIn(c.__options.animationDuration[0], w);
            c.__trackerStart();
            a(q.window)
              .on("resize." + c.__namespace + "-triggerClose", function (D) {
                var A = a(document.activeElement);
                ((A.is("input") || A.is("textarea")) &&
                  a.contains(c._$tooltip[0], A[0])) ||
                  c.reposition(D);
              })
              .on("scroll." + c.__namespace + "-triggerClose", function (D) {
                c.__scrollHandler(D);
              });
            c.__$originParents = c._$origin.parents();
            c.__$originParents.each(function (D, A) {
              a(A).on(
                "scroll." + c.__namespace + "-triggerClose",
                function (I) {
                  c.__scrollHandler(I);
                }
              );
            });
            if (
              c.__options.triggerClose.mouseleave ||
              (c.__options.triggerClose.touchleave && q.hasTouchCapability)
            ) {
              c._on("dismissable", function (D) {
                D.dismissable
                  ? D.delay
                    ? ((C = setTimeout(function () {
                        c._close(D.event);
                      }, D.delay)),
                      c.__timeouts.close.push(C))
                    : c._close(D)
                  : clearTimeout(C);
              });
              f = c._$origin;
              var y = "",
                x = "",
                C = null;
              c.__options.interactive && (f = f.add(c._$tooltip));
              c.__options.triggerClose.mouseleave &&
                ((y += "mouseenter." + c.__namespace + "-triggerClose "),
                (x += "mouseleave." + c.__namespace + "-triggerClose "));
              c.__options.triggerClose.touchleave &&
                q.hasTouchCapability &&
                ((y += "touchstart." + c.__namespace + "-triggerClose"),
                (x +=
                  "touchend." +
                  c.__namespace +
                  "-triggerClose touchcancel." +
                  c.__namespace +
                  "-triggerClose"));
              f.on(x, function (D) {
                (!c._touchIsTouchEvent(D) && c._touchIsEmulatedEvent(D)) ||
                  c._trigger({
                    delay: ("mouseleave" == D.type
                      ? c.__options.delay
                      : c.__options.delayTouch)[1],
                    dismissable: !0,
                    event: D,
                    type: "dismissable",
                  });
              }).on(y, function (D) {
                (!c._touchIsTouchEvent(D) && c._touchIsEmulatedEvent(D)) ||
                  c._trigger({
                    dismissable: !1,
                    event: D,
                    type: "dismissable",
                  });
              });
            }
            if (c.__options.triggerClose.originClick)
              c._$origin.on(
                "click." + c.__namespace + "-triggerClose",
                function (D) {
                  c._touchIsTouchEvent(D) ||
                    c._touchIsEmulatedEvent(D) ||
                    c._close(D);
                }
              );
            (c.__options.triggerClose.click ||
              (c.__options.triggerClose.tap && q.hasTouchCapability)) &&
              setTimeout(function () {
                if ("closed" != c.__state) {
                  var D = "";
                  c.__options.triggerClose.click &&
                    (D += "click." + c.__namespace + "-triggerClose ");
                  c.__options.triggerClose.tap &&
                    q.hasTouchCapability &&
                    (D += "touchend." + c.__namespace + "-triggerClose");
                  a("body").on(D, function (A) {
                    c._touchIsMeaningfulEvent(A) &&
                      (c._touchRecordEvent(A),
                      (c.__options.interactive &&
                        a.contains(c._$tooltip[0], A.target)) ||
                        c._close(A));
                  });
                  if (c.__options.triggerClose.tap && q.hasTouchCapability)
                    a("body").on(
                      "touchstart." + c.__namespace + "-triggerClose",
                      function (A) {
                        c._touchRecordEvent(A);
                      }
                    );
                }
              }, 0);
            c._trigger("ready");
            c.__options.functionReady &&
              c.__options.functionReady.call(c, c, {
                origin: c._$origin[0],
                tooltip: c._$tooltip[0],
              });
          }
          0 < c.__options.timer &&
            ((C = setTimeout(function () {
              c._close();
            }, c.__options.timer + h)),
            c.__timeouts.close.push(C));
        }
      }
      return c;
    },
    _openShortly: function (f) {
      var h = this,
        c = !0;
      if (
        "stable" != h.__state &&
        "appearing" != h.__state &&
        !h.__timeouts.open &&
        (h._trigger({
          type: "start",
          event: f,
          stop: function () {
            c = !1;
          },
        }),
        c)
      ) {
        var p =
          0 == f.type.indexOf("touch")
            ? h.__options.delayTouch
            : h.__options.delay;
        p[0]
          ? (h.__timeouts.open = setTimeout(function () {
              h.__timeouts.open = null;
              h.__pointerIsOverOrigin && h._touchIsMeaningfulEvent(f)
                ? (h._trigger("startend"), h._open(f))
                : h._trigger("startcancel");
            }, p[0]))
          : (h._trigger("startend"), h._open(f));
      }
      return h;
    },
    _optionsExtract: function (f, h) {
      var c = this,
        p = a.extend(!0, {}, h),
        w = c.__options[f];
      w ||
        ((w = {}),
        a.each(h, function (y, x) {
          x = c.__options[y];
          void 0 !== x && (w[y] = x);
        }));
      a.each(p, function (y, x) {
        void 0 !== w[y] &&
          ("object" != typeof x ||
          x instanceof Array ||
          null == x ||
          "object" != typeof w[y] ||
          w[y] instanceof Array ||
          null == w[y]
            ? (p[y] = w[y])
            : a.extend(p[y], w[y]));
      });
      return p;
    },
    _plug: function (f) {
      var h = a.tooltipster._plugin(f);
      if (h) h.instance && a.tooltipster.__bridge(h.instance, this, h.name);
      else throw Error('The "' + f + '" plugin is not defined');
      return this;
    },
    _touchIsEmulatedEvent: function (f) {
      for (
        var h = !1, c = new Date().getTime(), p = this.__touchEvents.length - 1;
        0 <= p;
        p--
      ) {
        var w = this.__touchEvents[p];
        if (500 > c - w.time) w.target === f.target && (h = !0);
        else break;
      }
      return h;
    },
    _touchIsMeaningfulEvent: function (f) {
      return (
        (this._touchIsTouchEvent(f) && !this._touchSwiped(f.target)) ||
        (!this._touchIsTouchEvent(f) && !this._touchIsEmulatedEvent(f))
      );
    },
    _touchIsTouchEvent: function (f) {
      return 0 == f.type.indexOf("touch");
    },
    _touchRecordEvent: function (f) {
      this._touchIsTouchEvent(f) &&
        ((f.time = new Date().getTime()), this.__touchEvents.push(f));
      return this;
    },
    _touchSwiped: function (f) {
      for (var h = !1, c = this.__touchEvents.length - 1; 0 <= c; c--) {
        var p = this.__touchEvents[c];
        if ("touchmove" == p.type) {
          h = !0;
          break;
        } else if ("touchstart" == p.type && f === p.target) break;
      }
      return h;
    },
    _trigger: function () {
      var f = Array.prototype.slice.apply(arguments);
      "string" == typeof f[0] && (f[0] = { type: f[0] });
      f[0].instance = this;
      f[0].origin = this._$origin ? this._$origin[0] : null;
      f[0].tooltip = this._$tooltip ? this._$tooltip[0] : null;
      this.__$emitterPrivate.trigger.apply(this.__$emitterPrivate, f);
      a.tooltipster._trigger.apply(a.tooltipster, f);
      this.__$emitterPublic.trigger.apply(this.__$emitterPublic, f);
      return this;
    },
    _unplug: function (f) {
      var h = this;
      if (h[f]) {
        var c = a.tooltipster._plugin(f);
        c.instance &&
          a.each(c.instance, function (p, w) {
            h[p] && h[p].bridged === h[f] && delete h[p];
          });
        h[f].__destroy && h[f].__destroy();
        delete h[f];
      }
      return h;
    },
    close: function (f) {
      this.__destroyed ? this.__destroyError() : this._close(null, f);
      return this;
    },
    content: function (f) {
      var h = this;
      if (void 0 === f) return h.__Content;
      if (h.__destroyed) h.__destroyError();
      else if ((h.__contentSet(f), null !== h.__Content)) {
        if (
          "closed" !== h.__state &&
          (h.__contentInsert(), h.reposition(), h.__options.updateAnimation)
        )
          if (q.hasTransitions) {
            var c = h.__options.updateAnimation;
            h._$tooltip.addClass("tooltipster-update-" + c);
            setTimeout(function () {
              "closed" != h.__state &&
                h._$tooltip.removeClass("tooltipster-update-" + c);
            }, 1e3);
          } else
            h._$tooltip.fadeTo(200, 0.5, function () {
              "closed" != h.__state && h._$tooltip.fadeTo(200, 1);
            });
      } else h._close();
      return h;
    },
    destroy: function () {
      var f = this;
      f.__destroyed
        ? f.__destroyError()
        : f.__destroying ||
          ((f.__destroying = !0),
          f._close(null, function () {
            f._trigger("destroy");
            f.__destroying = !1;
            f.__destroyed = !0;
            f._$origin
              .removeData(f.__namespace)
              .off("." + f.__namespace + "-triggerOpen");
            a("body").off("." + f.__namespace + "-triggerOpen");
            var h = f._$origin.data("tooltipster-ns");
            h &&
              (1 === h.length
                ? ((h = null),
                  "previous" == f.__options.restoration
                    ? (h = f._$origin.data("tooltipster-initialTitle"))
                    : "current" == f.__options.restoration &&
                      (h =
                        "string" == typeof f.__Content
                          ? f.__Content
                          : a("<div></div>").append(f.__Content).html()),
                  h && f._$origin.attr("title", h),
                  f._$origin.removeClass("tooltipstered"),
                  f._$origin
                    .removeData("tooltipster-ns")
                    .removeData("tooltipster-initialTitle"))
                : ((h = a.grep(h, function (c, p) {
                    return c !== f.__namespace;
                  })),
                  f._$origin.data("tooltipster-ns", h)));
            f._trigger("destroyed");
            f._off();
            f.off();
            f.__Content = null;
            f.__$emitterPrivate = null;
            f.__$emitterPublic = null;
            f.__options.parent = null;
            f._$origin = null;
            f._$tooltip = null;
            a.tooltipster.__instancesLatestArr = a.grep(
              a.tooltipster.__instancesLatestArr,
              function (c, p) {
                return f !== c;
              }
            );
            clearInterval(f.__garbageCollector);
          }));
      return f;
    },
    disable: function () {
      this.__destroyed
        ? this.__destroyError()
        : (this._close(), (this.__enabled = !1));
      return this;
    },
    elementOrigin: function () {
      if (this.__destroyed) this.__destroyError();
      else return this._$origin[0];
    },
    elementTooltip: function () {
      return this._$tooltip ? this._$tooltip[0] : null;
    },
    enable: function () {
      this.__enabled = !0;
      return this;
    },
    hide: function (f) {
      return this.close(f);
    },
    instance: function () {
      return this;
    },
    off: function () {
      this.__destroyed ||
        this.__$emitterPublic.off.apply(
          this.__$emitterPublic,
          Array.prototype.slice.apply(arguments)
        );
      return this;
    },
    on: function () {
      this.__destroyed
        ? this.__destroyError()
        : this.__$emitterPublic.on.apply(
            this.__$emitterPublic,
            Array.prototype.slice.apply(arguments)
          );
      return this;
    },
    one: function () {
      this.__destroyed
        ? this.__destroyError()
        : this.__$emitterPublic.one.apply(
            this.__$emitterPublic,
            Array.prototype.slice.apply(arguments)
          );
      return this;
    },
    open: function (f) {
      this.__destroyed || this.__destroying
        ? this.__destroyError()
        : this._open(null, f);
      return this;
    },
    option: function (f, h) {
      if (void 0 === h) return this.__options[f];
      this.__destroyed
        ? this.__destroyError()
        : ((this.__options[f] = h),
          this.__optionsFormat(),
          0 <= a.inArray(f, ["trigger", "triggerClose", "triggerOpen"]) &&
            this.__prepareOrigin(),
          "selfDestruction" === f && this.__prepareGC());
      return this;
    },
    reposition: function (f, h) {
      this.__destroyed
        ? this.__destroyError()
        : "closed" != this.__state &&
          k(this._$origin) &&
          (h || k(this._$tooltip)) &&
          (h || this._$tooltip.detach(),
          (this.__Geometry = this.__geometry()),
          this._trigger({
            type: "reposition",
            event: f,
            helper: { geo: this.__Geometry },
          }));
      return this;
    },
    show: function (f) {
      return this.open(f);
    },
    status: function () {
      return {
        destroyed: this.__destroyed,
        destroying: this.__destroying,
        enabled: this.__enabled,
        open: "closed" !== this.__state,
        state: this.__state,
      };
    },
    triggerHandler: function () {
      this.__destroyed
        ? this.__destroyError()
        : this.__$emitterPublic.triggerHandler.apply(
            this.__$emitterPublic,
            Array.prototype.slice.apply(arguments)
          );
      return this;
    },
  };
  a.fn.tooltipster = function () {
    var f = Array.prototype.slice.apply(arguments);
    if (0 === this.length) return this;
    if ("string" === typeof f[0]) {
      var h = "#*$~&";
      this.each(function () {
        var C = a(this).data("tooltipster-ns");
        if ((C = C ? a(this).data(C[0]) : null)) {
          if ("function" === typeof C[f[0]]) {
            1 < this.length &&
              "content" == f[0] &&
              (f[1] instanceof a ||
                ("object" == typeof f[1] && null != f[1] && f[1].tagName)) &&
              !C.__options.contentCloning &&
              C.__options.debug &&
              console.log(
                "You are using a single HTML element as content for several tooltips. You probably want to set the contentCloning option to TRUE."
              );
            var D = C[f[0]](f[1], f[2]);
          } else throw Error('Unknown method "' + f[0] + '"');
          if (D !== C || "instance" === f[0]) return (h = D), !1;
        } else throw Error("You called Tooltipster's \"" + f[0] + '" method on an uninitialized element');
      });
      return "#*$~&" !== h ? h : this;
    }
    a.tooltipster.__instancesLatestArr = [];
    var c = f[0] && void 0 !== f[0].multiple,
      p = (c && f[0].multiple) || (!c && l.multiple);
    c =
      ((c = f[0] && void 0 !== f[0].content) && f[0].content) ||
      (!c && l.content);
    var w = f[0] && void 0 !== f[0].contentCloning;
    w = (w && f[0].contentCloning) || (!w && l.contentCloning);
    var y = f[0] && void 0 !== f[0].debug,
      x = (y && f[0].debug) || (!y && l.debug);
    1 < this.length &&
      (c instanceof a || ("object" == typeof c && null != c && c.tagName)) &&
      !w &&
      x &&
      console.log(
        "You are using a single HTML element as content for several tooltips. You probably want to set the contentCloning option to TRUE."
      );
    this.each(function () {
      var C = !1,
        D = a(this),
        A = D.data("tooltipster-ns"),
        I = null;
      A
        ? p
          ? (C = !0)
          : x &&
            (console.log(
              "Tooltipster: one or more tooltips are already attached to the element below. Ignoring."
            ),
            console.log(this))
        : (C = !0);
      C &&
        ((I = new a.Tooltipster(this, f[0])),
        (A ||= []),
        A.push(I.__namespace),
        D.data("tooltipster-ns", A),
        D.data(I.__namespace, I),
        I.__options.functionInit &&
          I.__options.functionInit.call(I, I, { origin: this }),
        I._trigger("init"));
      a.tooltipster.__instancesLatestArr.push(I);
    });
    return this;
  };
  b.prototype = {
    __init: function (f) {
      this.__$tooltip = f;
      this.__$tooltip
        .css({ left: 0, overflow: "hidden", position: "absolute", top: 0 })
        .find(".tooltipster-content")
        .css("overflow", "auto");
      this.$container = a('<div class="tooltipster-ruler"></div>')
        .append(this.__$tooltip)
        .appendTo("body");
    },
    __forceRedraw: function () {
      var f = this.__$tooltip.parent();
      this.__$tooltip.detach();
      this.__$tooltip.appendTo(f);
    },
    constrain: function (f, h) {
      this.constraints = { width: f, height: h };
      this.__$tooltip.css({
        display: "block",
        height: "",
        overflow: "auto",
        width: f,
      });
      return this;
    },
    destroy: function () {
      this.__$tooltip
        .detach()
        .find(".tooltipster-content")
        .css({ display: "", overflow: "" });
      this.$container.remove();
    },
    free: function () {
      this.constraints = null;
      this.__$tooltip.css({
        display: "",
        height: "",
        overflow: "visible",
        width: "",
      });
      return this;
    },
    measure: function () {
      this.__forceRedraw();
      var f = this.__$tooltip[0].getBoundingClientRect(),
        h = {
          size: { height: f.height || f.bottom, width: f.width || f.right },
        };
      if (this.constraints) {
        var c = this.__$tooltip.find(".tooltipster-content"),
          p = this.__$tooltip.outerHeight(),
          w = c[0].getBoundingClientRect();
        f =
          f.width <= this.constraints.width && w.width >= c[0].scrollWidth - 1;
        h.fits = p <= this.constraints.height && f;
      }
      q.IE &&
        11 >= q.IE &&
        h.size.width !== q.window.document.documentElement.clientWidth &&
        (h.size.width = Math.ceil(h.size.width) + 1);
      return h;
    },
  };
  v = navigator.userAgent.toLowerCase();
  -1 != v.indexOf("msie")
    ? (q.IE = parseInt(v.split("msie")[1]))
    : -1 !== v.toLowerCase().indexOf("trident") && -1 !== v.indexOf(" rv:11")
    ? (q.IE = 11)
    : -1 != v.toLowerCase().indexOf("edge/") &&
      (q.IE = parseInt(v.toLowerCase().split("edge/")[1]));
  a.tooltipster._plugin({
    name: "tooltipster.sideTip",
    instance: {
      __defaults: function () {
        return {
          arrow: !0,
          distance: 6,
          functionPosition: null,
          maxWidth: null,
          minIntersection: 16,
          minWidth: 0,
          position: null,
          side: "top",
          viewportAware: !0,
        };
      },
      __init: function (f) {
        var h = this;
        h.__instance = f;
        h.__namespace =
          "tooltipster-sideTip-" + Math.round(1e6 * Math.random());
        h.__previousState = "closed";
        h.__options;
        h.__optionsFormat();
        h.__instance._on("state." + h.__namespace, function (c) {
          "closed" == c.state
            ? h.__close()
            : "appearing" == c.state &&
              "closed" == h.__previousState &&
              h.__create();
          h.__previousState = c.state;
        });
        h.__instance._on("options." + h.__namespace, function () {
          h.__optionsFormat();
        });
        h.__instance._on("reposition." + h.__namespace, function (c) {
          h.__reposition(c.event, c.helper);
        });
      },
      __close: function () {
        this.__instance.content() instanceof a &&
          this.__instance.content().detach();
        this.__instance._$tooltip.remove();
        this.__instance._$tooltip = null;
      },
      __create: function () {
        var f = a(
          '<div class="tooltipster-base tooltipster-sidetip"><div class="tooltipster-box"><div class="tooltipster-content"></div></div><div class="tooltipster-arrow"><div class="tooltipster-arrow-uncropped"><div class="tooltipster-arrow-border"></div><div class="tooltipster-arrow-background"></div></div></div></div>'
        );
        this.__options.arrow ||
          f
            .find(".tooltipster-box")
            .css("margin", 0)
            .end()
            .find(".tooltipster-arrow")
            .hide();
        this.__options.minWidth &&
          f.css("min-width", this.__options.minWidth + "px");
        this.__options.maxWidth &&
          f.css("max-width", this.__options.maxWidth + "px");
        this.__instance._$tooltip = f;
        this.__instance._trigger("created");
      },
      __destroy: function () {
        this.__instance._off("." + self.__namespace);
      },
      __optionsFormat: function () {
        this.__options = this.__instance._optionsExtract(
          "tooltipster.sideTip",
          this.__defaults()
        );
        this.__options.position &&
          (this.__options.side = this.__options.position);
        "object" != typeof this.__options.distance &&
          (this.__options.distance = [this.__options.distance]);
        4 > this.__options.distance.length &&
          (void 0 === this.__options.distance[1] &&
            (this.__options.distance[1] = this.__options.distance[0]),
          void 0 === this.__options.distance[2] &&
            (this.__options.distance[2] = this.__options.distance[0]),
          void 0 === this.__options.distance[3] &&
            (this.__options.distance[3] = this.__options.distance[1]),
          (this.__options.distance = {
            top: this.__options.distance[0],
            right: this.__options.distance[1],
            bottom: this.__options.distance[2],
            left: this.__options.distance[3],
          }));
        "string" == typeof this.__options.side &&
          ((this.__options.side = [
            this.__options.side,
            { top: "bottom", right: "left", bottom: "top", left: "right" }[
              this.__options.side
            ],
          ]),
          "left" == this.__options.side[0] || "right" == this.__options.side[0]
            ? this.__options.side.push("top", "bottom")
            : this.__options.side.push("right", "left"));
        6 === a.tooltipster._env.IE &&
          !0 !== this.__options.arrow &&
          (this.__options.arrow = !1);
      },
      __reposition: function (f, h) {
        var c,
          p = this,
          w = p.__targetFind(h),
          y = [];
        p.__instance._$tooltip.detach();
        var x = p.__instance._$tooltip.clone(),
          C = a.tooltipster._getRuler(x),
          D = !1;
        (c = p.__instance.option("animation")) &&
          x.removeClass("tooltipster-" + c);
        a.each(["window", "document"], function (L, N) {
          var R = null;
          p.__instance._trigger({
            container: N,
            helper: h,
            satisfied: D,
            takeTest: function (P) {
              R = P;
            },
            results: y,
            type: "positionTest",
          });
          if (
            1 == R ||
            (0 != R && 0 == D && ("window" != N || p.__options.viewportAware))
          )
            for (L = 0; L < p.__options.side.length; L++) {
              var X = { horizontal: 0, vertical: 0 },
                S = p.__options.side[L];
              "top" == S || "bottom" == S
                ? (X.vertical = p.__options.distance[S])
                : (X.horizontal = p.__options.distance[S]);
              p.__sideChange(x, S);
              a.each(["natural", "constrained"], function (P, ca) {
                R = null;
                p.__instance._trigger({
                  container: N,
                  event: f,
                  helper: h,
                  mode: ca,
                  results: y,
                  satisfied: D,
                  side: S,
                  takeTest: function (pa) {
                    R = pa;
                  },
                  type: "positionTest",
                });
                if (1 == R || (0 != R && 0 == D)) {
                  P = {
                    container: N,
                    distance: X,
                    fits: null,
                    mode: ca,
                    outerSize: null,
                    side: S,
                    size: null,
                    target: w[S],
                    whole: null,
                  };
                  var Y = (
                    "natural" == ca
                      ? C.free()
                      : C.constrain(
                          h.geo.available[N][S].width - X.horizontal,
                          h.geo.available[N][S].height - X.vertical
                        )
                  ).measure();
                  P.size = Y.size;
                  P.outerSize = {
                    height: Y.size.height + X.vertical,
                    width: Y.size.width + X.horizontal,
                  };
                  P.fits =
                    "natural" == ca
                      ? h.geo.available[N][S].width >= P.outerSize.width &&
                        h.geo.available[N][S].height >= P.outerSize.height
                        ? !0
                        : !1
                      : Y.fits;
                  "window" == N &&
                    (P.whole = P.fits
                      ? "top" == S || "bottom" == S
                        ? h.geo.origin.windowOffset.right >=
                            p.__options.minIntersection &&
                          h.geo.window.size.width -
                            h.geo.origin.windowOffset.left >=
                            p.__options.minIntersection
                        : h.geo.origin.windowOffset.bottom >=
                            p.__options.minIntersection &&
                          h.geo.window.size.height -
                            h.geo.origin.windowOffset.top >=
                            p.__options.minIntersection
                      : !1);
                  y.push(P);
                  if (P.whole) D = !0;
                  else if (
                    "natural" == P.mode &&
                    (P.fits || P.size.width <= h.geo.available[N][S].width)
                  )
                    return !1;
                }
              });
            }
        });
        p.__instance._trigger({
          edit: function (L) {
            y = L;
          },
          event: f,
          helper: h,
          results: y,
          type: "positionTested",
        });
        y.sort(function (L, N) {
          if (L.whole && !N.whole) return -1;
          if (!L.whole && N.whole) return 1;
          if (L.whole && N.whole) {
            var R = p.__options.side.indexOf(L.side);
            N = p.__options.side.indexOf(N.side);
            return R < N ? -1 : R > N ? 1 : "natural" == L.mode ? -1 : 1;
          }
          return L.fits && !N.fits
            ? -1
            : !L.fits && N.fits
            ? 1
            : L.fits && N.fits
            ? ((R = p.__options.side.indexOf(L.side)),
              (N = p.__options.side.indexOf(N.side)),
              R < N ? -1 : R > N ? 1 : "natural" == L.mode ? -1 : 1)
            : "document" == L.container &&
              "bottom" == L.side &&
              "natural" == L.mode
            ? -1
            : 1;
        });
        var A = y[0];
        A.coord = {};
        switch (A.side) {
          case "left":
          case "right":
            A.coord.top = Math.floor(A.target - A.size.height / 2);
            break;
          case "bottom":
          case "top":
            A.coord.left = Math.floor(A.target - A.size.width / 2);
        }
        switch (A.side) {
          case "left":
            A.coord.left = h.geo.origin.windowOffset.left - A.outerSize.width;
            break;
          case "right":
            A.coord.left =
              h.geo.origin.windowOffset.right + A.distance.horizontal;
            break;
          case "top":
            A.coord.top = h.geo.origin.windowOffset.top - A.outerSize.height;
            break;
          case "bottom":
            A.coord.top =
              h.geo.origin.windowOffset.bottom + A.distance.vertical;
        }
        "window" == A.container
          ? "top" == A.side || "bottom" == A.side
            ? 0 > A.coord.left
              ? (A.coord.left =
                  0 <=
                  h.geo.origin.windowOffset.right -
                    this.__options.minIntersection
                    ? 0
                    : h.geo.origin.windowOffset.right -
                      this.__options.minIntersection -
                      1)
              : A.coord.left > h.geo.window.size.width - A.size.width &&
                (A.coord.left =
                  h.geo.origin.windowOffset.left +
                    this.__options.minIntersection <=
                  h.geo.window.size.width
                    ? h.geo.window.size.width - A.size.width
                    : h.geo.origin.windowOffset.left +
                      this.__options.minIntersection +
                      1 -
                      A.size.width)
            : 0 > A.coord.top
            ? (A.coord.top =
                0 <=
                h.geo.origin.windowOffset.bottom -
                  this.__options.minIntersection
                  ? 0
                  : h.geo.origin.windowOffset.bottom -
                    this.__options.minIntersection -
                    1)
            : A.coord.top > h.geo.window.size.height - A.size.height &&
              (A.coord.top =
                h.geo.origin.windowOffset.top +
                  this.__options.minIntersection <=
                h.geo.window.size.height
                  ? h.geo.window.size.height - A.size.height
                  : h.geo.origin.windowOffset.top +
                    this.__options.minIntersection +
                    1 -
                    A.size.height)
          : (A.coord.left > h.geo.window.size.width - A.size.width &&
              (A.coord.left = h.geo.window.size.width - A.size.width),
            0 > A.coord.left && (A.coord.left = 0));
        p.__sideChange(x, A.side);
        h.tooltipClone = x[0];
        h.tooltipParent = p.__instance.option("parent").parent[0];
        h.mode = A.mode;
        h.whole = A.whole;
        h.origin = p.__instance._$origin[0];
        h.tooltip = p.__instance._$tooltip[0];
        delete A.container;
        delete A.fits;
        delete A.mode;
        delete A.outerSize;
        delete A.whole;
        A.distance = A.distance.horizontal || A.distance.vertical;
        c = a.extend(!0, {}, A);
        p.__instance._trigger({
          edit: function (L) {
            A = L;
          },
          event: f,
          helper: h,
          position: c,
          type: "position",
        });
        p.__options.functionPosition &&
          (c = p.__options.functionPosition.call(p, p.__instance, h, c)) &&
          (A = c);
        C.destroy();
        if ("top" == A.side || "bottom" == A.side) {
          c = "left";
          var I = A.target - A.coord.left;
          var V = A.size.width - this.__options.minIntersection;
        } else
          (c = "top"),
            (I = A.target - A.coord.top),
            (V = A.size.height - this.__options.minIntersection);
        I < this.__options.minIntersection
          ? (I = this.__options.minIntersection)
          : I > V && (I = V);
        V = h.geo.origin.fixedLineage
          ? h.geo.origin.windowOffset
          : {
              left: h.geo.origin.windowOffset.left + h.geo.window.scroll.left,
              top: h.geo.origin.windowOffset.top + h.geo.window.scroll.top,
            };
        A.coord = {
          left: V.left + (A.coord.left - h.geo.origin.windowOffset.left),
          top: V.top + (A.coord.top - h.geo.origin.windowOffset.top),
        };
        p.__sideChange(p.__instance._$tooltip, A.side);
        h.geo.origin.fixedLineage
          ? p.__instance._$tooltip.css("position", "fixed")
          : p.__instance._$tooltip.css("position", "");
        p.__instance._$tooltip
          .css({
            left: A.coord.left,
            top: A.coord.top,
            height: A.size.height,
            width: A.size.width,
          })
          .find(".tooltipster-arrow")
          .css({ left: "", top: "" })
          .css(c, I);
        p.__instance._$tooltip.appendTo(p.__instance.option("parent"));
        p.__instance._trigger({ type: "repositioned", event: f, position: A });
      },
      __sideChange: function (f, h) {
        f.removeClass("tooltipster-bottom")
          .removeClass("tooltipster-left")
          .removeClass("tooltipster-right")
          .removeClass("tooltipster-top")
          .addClass("tooltipster-" + h);
      },
      __targetFind: function (f) {
        var h = {},
          c = this.__instance._$origin[0].getClientRects();
        1 < c.length &&
          1 == this.__instance._$origin.css("opacity") &&
          (this.__instance._$origin.css("opacity", 0.99),
          (c = this.__instance._$origin[0].getClientRects()),
          this.__instance._$origin.css("opacity", 1));
        2 > c.length
          ? ((h.top = Math.floor(
              f.geo.origin.windowOffset.left + f.geo.origin.size.width / 2
            )),
            (h.bottom = h.top),
            (h.left = Math.floor(
              f.geo.origin.windowOffset.top + f.geo.origin.size.height / 2
            )),
            (h.right = h.left))
          : ((f = c[0]),
            (h.top = Math.floor(f.left + (f.right - f.left) / 2)),
            (f = 2 < c.length ? c[Math.ceil(c.length / 2) - 1] : c[0]),
            (h.right = Math.floor(f.top + (f.bottom - f.top) / 2)),
            (f = c[c.length - 1]),
            (h.bottom = Math.floor(f.left + (f.right - f.left) / 2)),
            (f =
              2 < c.length
                ? c[Math.ceil((c.length + 1) / 2) - 1]
                : c[c.length - 1]),
            (h.left = Math.floor(f.top + (f.bottom - f.top) / 2)));
        return h;
      },
    },
  });
  return a;
});
function isTourRunning() {
  return "undefined" != typeof hopscotch && hopscotch.getCurrTour() ? !0 : !1;
}
function showPointOfInterest(a, b, e) {
  if (isTourRunning()) return !0;
  try {
    if (
      ((e = $.extend(
        {
          side: "top",
          openTooltipOn: null,
          isDismissed: function () {
            return isTooltipInLocalStorage(a);
          },
          onDismiss: function () {
            setTooltipInLocalStorage(a);
          },
          actionable: !1,
        },
        e
      )),
      !e.isDismissed())
    ) {
      try {
        $(a).tooltipster("destroy");
      } catch (k) {}
      $(a).tooltipster({
        content: createPOIContent(a, b, e.onDismiss),
        theme: "tooltipster-light",
        interactive: !0,
        trigger: "custom",
        triggerClose: { click: e.actionable ? !1 : !0 },
        restoration: "none",
        side: e.side,
      });
      closeOpenTooltips();
      e.openTooltipOn
        ? e.openTooltipOn.tooltipster("show")
        : $(a).tooltipster("show");
      return !0;
    }
  } catch (k) {}
  return !1;
}
function showTooltip(a, b, e) {
  try {
    e = $.extend(
      {
        side: "top",
        openTooltipOn: null,
        actionable: !1,
        onDismiss: function () {},
      },
      e
    );
    try {
      $(a).tooltipster("destroy");
    } catch (k) {}
    $(a).tooltipster({
      content: createPOIContent(a, b, e.onDismiss),
      theme: "tooltipster-light",
      interactive: !0,
      trigger: "custom",
      triggerClose: { click: e.actionable ? !1 : !0 },
      restoration: "none",
      side: e.side,
    });
    closeOpenTooltips();
    e.openTooltipOn
      ? e.openTooltipOn.tooltipster("show")
      : $(a).tooltipster("show");
    return !0;
  } catch (k) {}
  return !1;
}
function createGotIt(a) {
  return $("<a />", {
    class: "nl-smallGrayButton",
    click: a,
    text: i18n("Got it"),
  });
}
function createPOIContent(a, b, e) {
  b = $("<div />", { html: b, css: { display: "inline-block" } });
  b = $("<div />", { class: "sy-tooltip-content" }).append(b);
  var k = createGotIt(function () {
    e();
    $(a).tooltipster("hide");
  });
  b.append(k);
  return b;
}
function createUpgradeContent(a, b, e, k) {
  var l = $("<div />", { html: e, css: { display: "inline-block" } });
  e = $("<div />", { class: "sy-tooltip-content" }).append(l);
  var n = $("<a />", {
    class: "upgradeLink",
    click: function () {
      showSignUpSubscribe(k);
      setTooltipUpgradeInLocalStorage(a);
      b.tooltipster("destroy");
    },
    text: i18n("Upgrade"),
  });
  l.prepend("&nbsp;");
  l.prepend(n);
  l = createGotIt(function () {
    setTooltipUpgradeInLocalStorage(a);
    b.tooltipster("hide");
  });
  e.append(l);
  return e;
}
function createSigninContent(a, b, e, k) {
  var l = $("<div />", { html: e, css: { display: "inline-block" } });
  e = $("<div />", { class: "sy-tooltip-content" }).append(l);
  var n = $("<a />", {
    class: "upgradeLink",
    click: function () {
      showSignUp(k);
      setTooltipSignupInLocalStorage(a);
      b.tooltipster("destroy");
    },
    text: i18n("Sign up"),
  });
  l.prepend("&nbsp;");
  l.prepend(n);
  l = createGotIt(function () {
    setTooltipSignupInLocalStorage(a);
    b.tooltipster("hide");
  });
  e.append(l);
  return e;
}
function createUpgradeTooltipOnly(a, b, e, k, l, n) {
  if (!n || !isTooltipUpgradeInLocalStorage(b)) {
    b = createUpgradeContent(b, a, k, e);
    try {
      a.tooltipster("destroy");
    } catch (q) {}
    a.tooltipster({
      content: b,
      theme: "tooltipster-light",
      interactive: !0,
      trigger: "custom",
      restoration: "none",
      side: null != l ? l : "left",
    });
    closeOpenTooltips();
    try {
      a.tooltipster("show");
    } catch (q) {}
    return !0;
  }
  return !1;
}
function createSignupTooltipOnly(a, b, e, k) {
  b = createSigninContent(a, $(a), e, b);
  try {
    $(a).tooltipster("destroy");
  } catch (l) {}
  $(a).tooltipster({
    content: b,
    theme: "tooltipster-light",
    trigger: "custom",
    interactive: !0,
    restoration: "none",
    side: null != k ? k : "left",
  });
  closeOpenTooltips();
  $(a).tooltipster("show");
  return !0;
}
function createUpgradeTooltip(a, b, e, k) {
  isTourRunning() ||
    (!1 === createUpgradeTooltipOnly($(a), a, b, e, k) &&
      showSignUpSubscribe(b));
}
function createUpgradeTooltip2(a, b, e, k, l) {
  isTourRunning() ||
    (!1 === createUpgradeTooltipOnly(a, b, e, k, l) && showSignUpSubscribe(e));
}
function createSignupTooltip(a, b, e, k) {
  isTourRunning() ||
    (0 == createSignupTooltipOnly(a, b, e, k) && showSignUp(b));
}
function isInLocalStorage(a, b) {
  return getLocalStorage().getItem(a + b);
}
function setInLocalStorage(a, b) {
  getLocalStorage().setItem(a + b, !0);
}
function isTooltipInLocalStorage(a) {
  return isInLocalStorage("tooltip", a);
}
function setTooltipInLocalStorage(a) {
  setInLocalStorage("tooltip", a);
}
function isTooltipUpgradeInLocalStorage(a) {
  return isInLocalStorage("tooltipUpgrade", a);
}
function setTooltipUpgradeInLocalStorage(a) {
  setInLocalStorage("tooltipUpgrade", a);
}
function isTooltipSignupInLocalStorage(a) {
  return isInLocalStorage("tooltipSignup", a);
}
function setTooltipSignupInLocalStorage(a) {
  setInLocalStorage("tooltipSignup", a);
}
function closeOpenTooltips() {
  var a = $.tooltipster.instances();
  $.each(a, function (b, e) {
    e.close();
  });
}
$.browser.chrome = /chrome/.test(navigator.userAgent.toLowerCase());
!(function (a) {
  function b(f, h) {
    if (!(this instanceof b)) return (f = new b(f, h)), f.open(), f;
    this.id = b.id++;
    this.setup(f, h);
    this.chainCallbacks(b._callbackChain);
  }
  if ("undefined" == typeof a)
    return void (
      "console" in window &&
      window.console.info("Too much lightness, Featherlight needs jQuery.")
    );
  var e = [],
    k = function (f) {
      return (e = a.grep(e, function (h) {
        return h !== f && 0 < h.$instance.closest("body").length;
      }));
    },
    l = function (f, h) {
      var c = {};
      h = new RegExp("^" + h + "([A-Z])(.*)");
      for (var p in f) {
        var w = p.match(h);
        w &&
          ((w = (w[1] + w[2].replace(/([A-Z])/g, "-$1")).toLowerCase()),
          (c[w] = f[p]));
      }
      return c;
    },
    n = { keyup: "onKeyUp", resize: "onResize" },
    q = function (f) {
      a.each(b.opened().reverse(), function () {
        return f.isDefaultPrevented() || !1 !== this[n[f.type]](f)
          ? void 0
          : (f.preventDefault(), f.stopPropagation(), !1);
      });
    },
    v = function (f) {
      if (f !== b._globalHandlerInstalled) {
        b._globalHandlerInstalled = f;
        var h = a
          .map(n, function (c, p) {
            return p + "." + b.prototype.namespace;
          })
          .join(" ");
        a(window)[f ? "on" : "off"](h, q);
      }
    };
  b.prototype = {
    constructor: b,
    namespace: "featherlight",
    targetAttr: "data-featherlight",
    variant: null,
    resetCss: !1,
    background: null,
    openTrigger: "click",
    closeTrigger: "click",
    filter: null,
    root: "body",
    openSpeed: 250,
    closeSpeed: 250,
    closeOnClick: "background",
    closeOnEsc: !0,
    closeIcon: "&#10005;",
    loading: "",
    persist: !1,
    otherClose: null,
    beforeOpen: a.noop,
    beforeContent: a.noop,
    beforeClose: a.noop,
    afterOpen: a.noop,
    afterContent: a.noop,
    afterClose: a.noop,
    onKeyUp: a.noop,
    onResize: a.noop,
    type: null,
    contentFilters: "jquery image html ajax iframe text".split(" "),
    setup: function (f, h) {
      "object" != typeof f ||
        0 != f instanceof a ||
        h ||
        ((h = f), (f = void 0));
      var c = a.extend(this, h, { target: f });
      f = c.resetCss ? c.namespace + "-reset" : c.namespace;
      f = a(
        c.background ||
          [
            '<div class="' + f + "-loading " + f + '">',
            '<div class="' + f + '-content">',
            '<span class="' + f + "-close-icon " + c.namespace + '-close">',
            c.closeIcon,
            "</span>",
            '<div class="' + c.namespace + '-inner">' + c.loading + "</div>",
            "</div></div>",
          ].join("")
      );
      var p =
        "." + c.namespace + "-close" + (c.otherClose ? "," + c.otherClose : "");
      return (
        (c.$instance = f.clone().addClass(c.variant)),
        c.$instance.on(c.closeTrigger + "." + c.namespace, function (w) {
          var y = a(w.target);
          (("background" === c.closeOnClick && y.is("." + c.namespace)) ||
            "anywhere" === c.closeOnClick ||
            y.closest(p).length) &&
            (c.close(w), w.preventDefault());
        }),
        this
      );
    },
    getContent: function () {
      if (!1 !== this.persist && this.$content) return this.$content;
      var f = this.constructor.contentFilters,
        h = this.$currentTarget && this.$currentTarget.attr(this.targetAttr),
        c = this.target || h || "",
        p = f[this.type];
      if (
        (!p && c in f && ((p = f[c]), (c = this.target && h)),
        (c =
          c || (this.$currentTarget && this.$currentTarget.attr("href")) || ""),
        !p)
      )
        for (var w in f) this[w] && ((p = f[w]), (c = this[w]));
      if (!p) {
        var y = c;
        if (
          ((c = null),
          a.each(this.contentFilters, function () {
            return (
              (p = f[this]),
              p.test && (c = p.test(y)),
              !c && p.regex && y.match && y.match(p.regex) && (c = y),
              !c
            );
          }),
          !c)
        )
          return (
            "console" in window &&
              window.console.error(
                "Featherlight: no content filter found " +
                  (y ? ' for "' + y + '"' : " (no target specified)")
              ),
            !1
          );
      }
      return p.process.call(this, c);
    },
    setContent: function (f) {
      return (
        (f.is("iframe") || 0 < a("iframe", f).length) &&
          this.$instance.addClass(this.namespace + "-iframe"),
        this.$instance.removeClass(this.namespace + "-loading"),
        this.$instance
          .find("." + this.namespace + "-inner")
          .not(f)
          .slice(1)
          .remove()
          .end()
          .replaceWith(a.contains(this.$instance[0], f[0]) ? "" : f),
        (this.$content = f.addClass(this.namespace + "-inner")),
        this
      );
    },
    open: function (f) {
      var h = this;
      if (
        (h.$instance.hide().appendTo(h.root),
        !((f && f.isDefaultPrevented()) || !1 === h.beforeOpen(f)))
      ) {
        f && f.preventDefault();
        var c = h.getContent();
        if (c)
          return (
            e.push(h),
            v(!0),
            h.$instance.fadeIn(h.openSpeed),
            h.beforeContent(f),
            a
              .when(c)
              .always(function (p) {
                h.setContent(p);
                h.afterContent(f);
              })
              .then(h.$instance.promise())
              .done(function () {
                h.afterOpen(f);
              })
          );
      }
      return h.$instance.detach(), a.Deferred().reject().promise();
    },
    close: function (f) {
      var h = this,
        c = a.Deferred();
      return (
        !1 === h.beforeClose(f)
          ? c.reject()
          : (0 === k(h).length && v(!1),
            h.$instance.fadeOut(h.closeSpeed, function () {
              h.$instance.detach();
              h.afterClose(f);
              c.resolve();
            })),
        c.promise()
      );
    },
    chainCallbacks: function (f) {
      for (var h in f) this[h] = a.proxy(f[h], this, a.proxy(this[h], this));
    },
  };
  a.extend(b, {
    id: 0,
    autoBind: "[data-featherlight]",
    defaults: b.prototype,
    contentFilters: {
      jquery: {
        regex: /^[#.]\w/,
        test: function (f) {
          return f instanceof a && f;
        },
        process: function (f) {
          return !1 !== this.persist ? a(f) : a(f).clone(!0);
        },
      },
      image: {
        regex: /\.(png|jpg|jpeg|gif|tiff|bmp|svg)(\?\S*)?$/i,
        process: function (f) {
          var h = a.Deferred(),
            c = new Image(),
            p = a(
              '<img src="' +
                f +
                '" alt="" class="' +
                this.namespace +
                '-image" />'
            );
          return (
            (c.onload = function () {
              p.naturalWidth = c.width;
              p.naturalHeight = c.height;
              h.resolve(p);
            }),
            (c.onerror = function () {
              h.reject(p);
            }),
            (c.src = f),
            h.promise()
          );
        },
      },
      html: {
        regex: /^\s*<[\w!][^<]*>/,
        process: function (f) {
          return a(f);
        },
      },
      ajax: {
        regex: /./,
        process: function (f) {
          var h = a.Deferred(),
            c = a("<div></div>").load(f, function (p, w) {
              "error" !== w && h.resolve(c.contents());
              h.fail();
            });
          return h.promise();
        },
      },
      iframe: {
        process: function (f) {
          var h = new a.Deferred(),
            c = a("<iframe/>")
              .hide()
              .attr("src", f)
              .css(l(this, "iframe"))
              .on("load", function () {
                h.resolve(c.show());
              })
              .appendTo(this.$instance.find("." + this.namespace + "-content"));
          return h.promise();
        },
      },
      text: {
        process: function (f) {
          return a("<div>", { text: f });
        },
      },
    },
    functionAttributes:
      "beforeOpen afterOpen beforeContent afterContent beforeClose afterClose".split(
        " "
      ),
    readElementConfig: function (f, h) {
      var c = this,
        p = new RegExp("^data-" + h + "-(.*)"),
        w = {};
      return (
        f &&
          f.attributes &&
          a.each(f.attributes, function () {
            var y = this.name.match(p);
            if (y) {
              var x = this.value;
              y = a.camelCase(y[1]);
              if (0 <= a.inArray(y, c.functionAttributes)) x = new Function(x);
              else
                try {
                  x = a.parseJSON(x);
                } catch (C) {}
              w[y] = x;
            }
          }),
        w
      );
    },
    extend: function (f, h) {
      var c = function () {
        this.constructor = f;
      };
      return (
        (c.prototype = this.prototype),
        (f.prototype = new c()),
        (f.__super__ = this.prototype),
        a.extend(f, this, h),
        (f.defaults = f.prototype),
        f
      );
    },
    attach: function (f, h, c) {
      var p = this;
      "object" != typeof h ||
        0 != h instanceof a ||
        c ||
        ((c = h), (h = void 0));
      c = a.extend({}, c);
      var w,
        y = a.extend(
          {},
          p.defaults,
          p.readElementConfig(f[0], c.namespace || p.defaults.namespace),
          c
        );
      return (
        f.on(y.openTrigger + "." + y.namespace, y.filter, function (x) {
          var C = a.extend(
              { $source: f, $currentTarget: a(this) },
              p.readElementConfig(f[0], y.namespace),
              p.readElementConfig(this, y.namespace),
              c
            ),
            D = w || a(this).data("featherlight-persisted") || new p(h, C);
          "shared" === D.persist
            ? (w = D)
            : !1 !== D.persist && a(this).data("featherlight-persisted", D);
          C.$currentTarget.blur();
          D.open(x);
        }),
        f
      );
    },
    current: function () {
      var f = this.opened();
      return f[f.length - 1] || null;
    },
    opened: function () {
      var f = this;
      return (
        k(),
        a.grep(e, function (h) {
          return h instanceof f;
        })
      );
    },
    close: function (f) {
      var h = this.current();
      return h ? h.close(f) : void 0;
    },
    _onReady: function () {
      var f = this;
      f.autoBind &&
        (a(f.autoBind).each(function () {
          f.attach(a(this));
        }),
        a(document).on("click", f.autoBind, function (h) {
          h.isDefaultPrevented() ||
            "featherlight" === h.namespace ||
            (h.preventDefault(),
            f.attach(a(h.currentTarget)),
            a(h.target).trigger("click.featherlight"));
        }));
    },
    _callbackChain: {
      onKeyUp: function (f, h) {
        return 27 === h.keyCode
          ? (this.closeOnEsc && a.featherlight.close(h), !1)
          : f(h);
      },
      onResize: function (f, h) {
        if (this.$content.naturalWidth) {
          var c = this.$content.naturalWidth,
            p = this.$content.naturalHeight;
          this.$content.css("width", "").css("height", "");
          var w = Math.max(
            c / parseInt(this.$content.parent().css("width"), 10),
            p / parseInt(this.$content.parent().css("height"), 10)
          );
          1 < w &&
            this.$content
              .css("width", "" + c / w + "px")
              .css("height", "" + p / w + "px");
        }
        return f(h);
      },
      afterContent: function (f, h) {
        f = f(h);
        return this.onResize(h), f;
      },
    },
  });
  a.featherlight = b;
  a.fn.featherlight = function (f, h) {
    return b.attach(this, f, h);
  };
  a(document).ready(function () {
    b._onReady();
  });
})(jQuery);
(function () {
  var a, b;
  if (
    ((a = { version: "2.3.3", name: "jQuery-runner" }),
    (b = this.jQuery || this.Zepto || this.$),
    !b || !b.fn)
  )
    throw Error(
      "[" +
        a.name +
        "] jQuery or jQuery-like library is required for this plugin to work"
    );
  var e = {};
  var k = function (h) {
    return (10 > h ? "0" : "") + h;
  };
  var l = 1;
  var n = function () {
    return "runner" + l++;
  };
  var q = (function (h, c) {
    return (
      h["r" + c] ||
      h["webkitR" + c] ||
      h["mozR" + c] ||
      h["msR" + c] ||
      function (p) {
        return setTimeout(p, 30);
      }
    );
  })(this, "equestAnimationFrame");
  var v = function (h, c) {
    var p, w, y;
    c = c || {};
    var x = [36e5, 6e4, 1e3, 10];
    var C = ["", ":", ":", "."];
    var D = (p = "");
    var A = c.milliseconds;
    var I = x.length;
    0 > h && ((h = Math.abs(h)), (p = "-"));
    c = w = 0;
    for (y = x.length; y > w; c = ++w) {
      var V = x[c];
      var L = 0;
      h >= V && ((L = Math.floor(h / V)), (h -= L * V));
      (L || 1 < c || D) && (c !== I - 1 || A) && (D += (D ? C[c] : "") + k(L));
    }
    return p + D;
  };
  var f = (function () {
    function h(c, p, w) {
      var y;
      return this instanceof h
        ? ((this.items = c),
          (y = this.id = n()),
          (this.settings = b.extend({}, this.settings, p)),
          (e[y] = this),
          c.each(function (x, C) {
            b(C).data("runner", y);
          }),
          this.value(this.settings.startAt),
          void ((w || this.settings.autostart) && this.start()))
        : new h(c, p, w);
    }
    return (
      (h.prototype.running = !1),
      (h.prototype.updating = !1),
      (h.prototype.finished = !1),
      (h.prototype.interval = null),
      (h.prototype.total = 0),
      (h.prototype.lastTime = 0),
      (h.prototype.startTime = 0),
      (h.prototype.lastLap = 0),
      (h.prototype.lapTime = 0),
      (h.prototype.settings = {
        autostart: !1,
        countdown: !1,
        stopAt: null,
        startAt: 0,
        milliseconds: !0,
        format: null,
      }),
      (h.prototype.value = function (c) {
        this.items.each(
          (function (p) {
            return function (w, y) {
              w = b(y);
              y = w.is("input") ? "val" : "text";
              w[y](p.format(c));
            };
          })(this)
        );
      }),
      (h.prototype.format = function (c) {
        var p;
        return (
          (p = this.settings.format),
          (b.isFunction(p) ? p : v)(c, this.settings)
        );
      }),
      (h.prototype.update = function () {
        var c, p, w, y, x;
        this.updating ||
          ((this.updating = !0),
          (w = this.settings),
          (x = b.now()),
          (y = w.stopAt),
          (c = w.countdown),
          (p = x - this.lastTime),
          (this.lastTime = x),
          c ? (this.total -= p) : (this.total += p),
          null !== y &&
            ((c && this.total <= y) || (!c && this.total >= y)) &&
            ((this.total = y),
            (this.finished = !0),
            this.stop(),
            this.fire("runnerFinish")),
          this.value(this.total),
          (this.updating = !1));
      }),
      (h.prototype.fire = function (c) {
        this.items.trigger(c, this.info());
      }),
      (h.prototype.start = function () {
        var c;
        this.running ||
          ((this.running = !0),
          (!this.startTime || this.finished) && this.reset(),
          (this.lastTime = b.now()),
          (c = (function (p) {
            return function () {
              p.running && (p.update(), q(c));
            };
          })(this)),
          q(c),
          this.fire("runnerStart"));
      }),
      (h.prototype.stop = function () {
        this.running &&
          ((this.running = !1), this.update(), this.fire("runnerStop"));
      }),
      (h.prototype.toggle = function () {
        this.running ? this.stop() : this.start();
      }),
      (h.prototype.lap = function () {
        var c, p;
        return (
          (p = this.lastTime),
          (c = p - this.lapTime),
          this.settings.countdown && (c = -c),
          (this.running || c) && ((this.lastLap = c), (this.lapTime = p)),
          (p = this.format(this.lastLap)),
          this.fire("runnerLap"),
          p
        );
      }),
      (h.prototype.reset = function (c) {
        c && this.stop();
        c = b.now();
        "number" != typeof this.settings.startAt ||
          this.settings.countdown ||
          (c -= this.settings.startAt);
        this.startTime = this.lapTime = this.lastTime = c;
        this.total = this.settings.startAt;
        this.value(this.total);
        this.finished = !1;
        this.fire("runnerReset");
      }),
      (h.prototype.info = function () {
        var c;
        return (
          (c = this.lastLap || 0),
          {
            running: this.running,
            finished: this.finished,
            time: this.total,
            formattedTime: this.format(this.total),
            startTime: this.startTime,
            lapTime: c,
            formattedLapTime: this.format(c),
            settings: this.settings,
          }
        );
      }),
      h
    );
  })();
  b.fn.runner = function (h, c, p) {
    var w, y;
    switch (
      ((h ||= "init"),
      "object" == typeof h && ((p = c), (c = h), (h = "init")),
      (w = this.data("runner")),
      (y = w ? e[w] : !1),
      h)
    ) {
      case "init":
        new f(this, c, p);
        break;
      case "info":
        if (y) return y.info();
        break;
      case "reset":
        y && y.reset(c);
        break;
      case "lap":
        if (y) return y.lap();
        break;
      case "start":
      case "stop":
      case "toggle":
        if (y) return y[h]();
        break;
      case "version":
        return a.version;
      default:
        b.error("[" + a.name + "] Method " + h + " does not exist");
    }
    return this;
  };
  b.fn.runner.format = v;
}.call(this));
var syAjaxRunning = !1;
$(document).ajaxStart(function () {
  syAjaxRunning = !0;
});
$(document).ajaxStop(function () {
  syAjaxRunning = !1;
});
$(document).ajaxError(function (a, b, e, k) {
  403 == b.status &&
    (window.location =
      "/expirationPassed?api=" + e.url + "&from=" + window.location.href);
});
String.prototype.capitalize = function () {
  return this.charAt(0).toUpperCase() + this.slice(1);
};
String.prototype.replaceAt = function (a, b) {
  return this.substr(0, a) + b + this.substr(a + 1);
};
String.prototype.pluralize = function (a) {
  return 1 == Math.abs(a) ? this : this + "s";
};
function symbolab_log(a, b, e, k) {
  k ||= null;
  if (e && "string" === typeof e && e.startsWith("MobileWeb")) {
    if ("undefined" == typeof OS || "" === OS) OS = "Unknown";
    e = OS + "_" + e;
  }
  "undefined" != typeof sy_var &&
    "Registration" === a &&
    e &&
    (e = "Var" + sy_var + "\t" + e);
  return $.ajax({
    type: "POST",
    url: "/detailedLog",
    data: { type: a, info1: b, info2: e, query: k },
  });
}
function amp_log(a, b, e) {
  return $.ajax({
    type: "POST",
    url: "/ampLog",
    data: { event: a, data: b, force: e },
  });
}
var NoLocalStorage = function () {};
NoLocalStorage.prototype = {
  getItem: function () {
    return null;
  },
  setItem: function () {},
  removeItem: function () {},
};
var lsObj = new NoLocalStorage();
function getLocalStorage() {
  return localStorage;
}
function syMenu(a, b) {
  b = b.replace("/solver/", "");
  symbolab_log("Solutions", "Menu" + a, SOLUTIONS.page + "=>" + b);
}
function prepareQueryForMathQuill(a) {
  if (void 0 == a) return a;
  a = a.replace(/operatorname/g, "text");
  a = a.replace(/\\(\w+?)\s+(?={|_|\^|\(|\\)/g, "\\$1");
  a = a.replace(/\\,/g, " ");
  a = a.replace(/(, |,)/g, ",\\:");
  0 <= a.indexOf("\\{") &&
    ((a = a.replace(/\{\\space\}/g, "\\space")),
    (a = a.replace(/\\left\s*\\\{/g, "\\{")),
    (a = a.replace(/\\\{/g, "\\left\\{")),
    (a = a.replace(/\\right\s*\\\}/g, "\\}")),
    (a = a.replace(/\\\}/g, "\\right\\}")),
    (a = a.replace(/\\space}/g, "{\\space}")));
  a = a.replace(/\\vec\{(.+?)\}/g, "\\vec{$1 }");
  a = a.replace(/\\hat\{(.+?)\}/g, "\\hat{$1 }");
  return (a = a.replace(/ /g, "#"));
}
function getWidth(a, b) {
  var e = 0;
  if (
    a.hasClass("block") ||
    a.hasClass("numerator") ||
    a.hasClass("denominator")
  )
    a.children().each(function () {
      e += getWidth($(this), b);
    });
  else {
    if (a.hasClass("fraction")) {
      var k = getWidth($(a.children()[0]), b);
      a = getWidth($(a.children()[1]), b);
      return Math.max(k + 10, a + 10);
    }
    a.hasClass("roman")
      ? b &&
        a.children().each(function () {
          e += $(this).outerWidth();
        })
      : (e = a.outerWidth());
  }
  return e;
}
function getActualWidth(a, b) {
  var e = 0;
  $(a)
    .find(".mathquill-embedded-latex")
    .children()
    .each(function () {
      $(this).is(":visible:not(.selectable)") && (e += getWidth($(this), b));
    });
  return (e *= 1.1);
}
function getGraphInputWidth(a) {
  var b = 0;
  $(a)
    .children()
    .each(function () {
      $(this).is(":visible:not(.selectable)") && (b += getWidth($(this), !0));
    });
  return (b *= 1.1);
}
function createScrollForce(a, b, e) {
  if (b || e) {
    var k = $(
      '<div class="scrollContent" style="background: transparent"></div>'
    );
    b && k.width(b);
    e && k.height(e);
    $(a).children().wrap(k);
    $(a).addClass("syscrollable");
    $(a).find(".mathquill-embedded-latex").mathquill("redraw");
  }
}
function createTableArray(a) {
  a = a.replace("\\quad \\quad", "");
  a = a.replace("\\begin{array}", "");
  var b = !1;
  0 < a.indexOf("\\summaryline") &&
    ((a = a.replace("\\summaryline", "")), (b = !0));
  a = a.replace("\\end{array}", "");
  a = a.replace(/{\|(c\|)+}/gi, "");
  a = a.replace(/\\hline\s*/gi, " ");
  var e = $("<div style='overflow-x: auto;'></div>"),
    k = $("<table class='tableMatrix'></table>");
  a = a.split("\\\\");
  a.pop();
  for (var l, n = 0; n < a.length; n++) {
    var q = a[n];
    l = $("<tr></tr>");
    q = q.split("&");
    for (var v = 0; v < q.length; v++) {
      var f = q[v],
        h = $("<span class='mathquill-embedded-latex'></span>");
      h.text(f);
      f = $("<td class='syME'></td>");
      f.append(h);
      l.append(f);
    }
    b &&
      n === a.length - 1 &&
      (l.css("background-color", "#f5f5f5"), l.css("color", "black"));
    k.append(l);
  }
  e.append(k);
  return e;
}
function createTable(a) {
  a = a.replace("\\quad \\quad", "");
  a = a.replace("\\begin{table}", "");
  var b = !1;
  0 < a.indexOf("\\summaryline") &&
    ((a = a.replace("\\summaryline", "")), (b = !0));
  a = a.replace("\\end{table}", "");
  var e = $("<div style='overflow-x: auto;'></div>"),
    k = $("<table class='tableMatrix'></table>");
  a = a.split("\\\\");
  a.pop();
  for (var l, n = 0; n < a.length; n++) {
    var q = a[n];
    l = $("<tr></tr>");
    q = q.split("&");
    q.pop();
    for (var v = 0; v < q.length; v++) {
      var f = q[v],
        h = $("<span class='mathquill-embedded-latex'></span>");
      h.text(f);
      f = $("<td class='syME'></td>");
      f.append(h);
      l.append(f);
    }
    b &&
      n == a.length - 1 &&
      (l.css("background-color", "#f5f5f5"), l.css("color", "black"));
    k.append(l);
  }
  e.append(k);
  return e;
}
function createMathquillSpan(a, b, e) {
  if (void 0 == b) return $("<span></span>");
  var k = b.split("<br/>");
  if (1 == k.length) {
    if (0 <= b.indexOf("\\begin{table}")) var l = createTable(b);
    else
      0 <= b.indexOf("\\begin{array}")
        ? (l = createTableArray(b))
        : ((b = prepareQueryForMathQuill(b)),
          (l = $('<span class="' + a + ' mathquill-embedded-latex"></span>')),
          l.text(b));
    e && $(l).prop("title", e);
  } else {
    l = $('<div class="multi-line-span"></div>');
    for (var n in k)
      (b = createMathquillDiv(a, k[n])), b.addClass("multiline"), l.append(b);
  }
  return l;
}
function createMathquillDiv(a, b, e) {
  a = $('<div class="' + a + '"></div>');
  a.append(this.createMathquillSpan("", b, e));
  return a;
}
function createMathquillDiv2(a, b, e) {
  a = $('<div class="' + a + '"></div>');
  a.append(this.createMathquillSpan("", b, e));
  a.find(".mathquill-embedded-latex:not(.mathquill-rendered-math)").each(
    function () {
      $(this).mathquill();
    }
  );
  return a;
}
function mathquillify(a) {
  a.find(".mathquill-embedded-latex:not(.mathquill-rendered-math)").each(
    function () {
      $(this).mathquill();
    }
  );
}
function mathquillifyRedrawOnly(a) {
  a.find(".mathquill-embedded-latex.mathquill-rendered-math").each(function () {
    $(this).mathquill("redraw");
  });
}
function mathquillifyVisible(a) {
  a.find(".mathquill-embedded-latex:not(.mathquill-rendered-math)").each(
    function () {
      var b = $(this);
      b.is(":visible") && b.mathquill();
    }
  );
}
$(function () {
  const a = new Date(2023, 9, 31).getTime();
  var b = new Date(2023, 11, 15).getTime();
  const e = readCookie("sy.privacyAcceptDate"),
    k = $(".nl-cookiepolicy");
  let l = !1;
  const n = new Date().getTime();
  if (n >= b) l = !1;
  else if (e) {
    if (((b = parseInt(e)), isNaN(b) || b < a)) l = !0;
  } else
    0 > window.location.pathname.indexOf("privacy") &&
      0 > window.location.pathname.indexOf("cookie") &&
      (l = !0);
  l && k.show();
  $(".privacy-policy").click(function () {
    allowedCookieGroups("C0003") && createCookie("sy.privacyAcceptDate", n, 30);
    $(".nl-cookiepolicy").remove();
  });
  $("#save-as-bookmark.sign-in-button").click(function () {
    showSignIn("AvatarClicked", "NotebookStickie");
  });
  $("#userName").click(function () {
    showSignIn("AvatarClicked", "Avatar");
  });
  $(":not(#save-as-bookmark):not(#user-name).sign-in-button").click(
    function () {
      showSignIn("AvatarClicked");
    }
  );
  $("#solution_page #nl-subNav a").click(function (q) {
    q.preventDefault();
    var v = $(this).attr("href");
    $.when(symbolab_log("General", "TopMenu", v)).always(function () {
      window.location = v;
    });
  });
  $(".nl-navAction.notifications").click(function () {
    $(".nl-notificationsBox").toggle();
    $(".nl-notificationsBox").mathquill("redraw");
    $(".nl-notificationsBox").is(":visible") &&
      ($(".newNotifications").removeClass("newNotifications"),
      $.ajax({
        type: "POST",
        url: "/api/notification/seen",
        beforeSend: authorizeAjaxWithSyToken,
      }));
    return !1;
  });
  $("select.classification").change(function (q) {
    q = $(this).parent();
    var v = $(this).attr("id"),
      f = $(this).val();
    v = $("#" + (v + "-" + f));
    q.children(" select.subclass").addClass("hidden");
    q.children(" select.subclass").attr("disabled", "disabled");
    1 < v.children().size() &&
      (v.removeClass("hidden"), v.removeAttr("disabled"));
  });
  $("a.more").click(function (q) {
    q.preventDefault();
    var v = this;
    $(v)
      .parent()
      .next()
      .toggle(function () {
        var f = $(v).data("previous-text"),
          h = $(v).text();
        $(v).text(f);
        $(v).data("previous-text", h);
        0 > window.location.href.indexOf("team") &&
          $("#SearchExamples")
            .find(".mathquill-embedded-latex")
            .mathquill("redraw");
      });
  });
  "/" === window.location.pathname ||
  "/calculators" === window.location.pathname
    ? ensureCorrectLightsOutHomepage()
    : ensureCorrectLightsOut();
  $("body")
    .off("click", "#nl-mainNav li > a")
    .on("click", "#nl-mainNav li > a", function (q) {
      q.preventDefault();
      q = $(this).attr("href");
      getLocalStorage().setItem("linkOrigin", "TopMenu");
      window.location = q;
    });
  document.addEventListener("click", function () {
    $(".nl-notificationsBox").hide();
  });
});
function isMobileRender() {
  return "undefined" != typeof isMobileRendering && isMobileRendering;
}
function isPopularSearch() {
  return 0 <= window.location.href.indexOf("/popular");
}
function showUpgradeMessage() {
  "undefined" != typeof mobileWeb && mobileWeb
    ? "iOS" === OS
      ? confirm("Download the app to see steps. Redirect to App Store?") &&
        (window.location = "https://itunes.apple.com/app/id876942533")
      : "Android" === OS &&
        confirm("Download the app to see steps. Redirect to Google Play?") &&
        (window.location =
          "https://play.google.com/store/apps/details?id=com.devsense.symbolab")
    : (window.location.href = "/upgradeVersion");
}
function parseQueryParameters(a) {
  for (
    var b, e = /([^&=]+)=?([^&]*)/g, k = window.location.search.substring(1);
    (b = e.exec(k));

  )
    a[decodeURIComponent(b[1])] = decodeURIComponent(b[2]);
}
$.extend($.expr[":"], {
  "starts-with": function (a, b, e, k) {
    return 0 === $.trim($(a).text()).indexOf(e[3]);
  },
  "ends-with": function (a, b, e, k) {
    a = $.trim($(a).text());
    e = e[3];
    return a.lastIndexOf(e) === a.length - e.length;
  },
});
function changeLanguage(a, b) {
  var e = location.hostname;
  e = e.replace(b + ".", "");
  e = e.replace("www.", "");
  b = 80 == location.port ? "" : ":" + location.port;
  a = "en" == $(a).attr("data") ? "www." : $(a).attr("data") + ".";
  window.location = "http://" + a + e + b + "/solver";
}
function showSignIn(a, b, e) {
  registrationReason = a;
  googleIsSignUp = !1;
  getLocalStorage().setItem("registrationReason", a);
  void 0 === b &&
    symbolab_log("Registration", "ShowSignIn", registrationReason);
  localStorage.setItem("beforeSubs", 1);
  showSignUp(void 0 !== b ? b : "TopMenu", e);
}
function showSignUpSubscribe(a, b) {
  sy_pSub
    ? resumeSubscription(a, b)
    : isUserLoggedIn()
    ? showSubscription(a, b)
    : showSignUp(a, b);
}
function bookImageError(a) {
  a.onerror = "";
  $(a).hide();
  var b = $("<p><a href = '" + a.src + "'>Click here to view image</a></p>");
  $(a).parent().append(b);
  return !0;
}
function pickLanguage(a) {
  var b = $.Deferred();
  $.when(symbolab_log("General", "UserSwitchLang", a)).always(function () {
    b.resolve();
  });
  return b;
}
function loadScript(a) {
  if (0 < $('script[src="' + a + '"]').length) return $.Deferred().resolve();
  var b = $.Deferred(),
    e = document.createElement("script");
  e.async = "async";
  e.type = "text/javascript";
  e.src = a;
  e.onload = e.onreadystatechange = function (k, l) {
    if (!e.readyState || /loaded|complete/.test(e.readyState))
      l ? b.reject() : b.resolve();
  };
  e.onerror = function () {
    b.reject();
  };
  $("head")[0].appendChild(e);
  return b.promise();
}
function showGeneratePdf() {
  $(".nl-generatePdf").removeClass("nl-hidden");
  $.featherlight(".nl-generatePdf");
  return $.when(loadScript("/public/auto/jspdf.debug.min.js")).pipe(
    function () {
      return $.when(loadScript("/public/auto/html2canvas2.min.js"));
    }
  );
}
function showFeedback(a, b, e) {
  $(".nl-signInContainer>div").addClass("nl-hidden");
  $(".nl-feedback-modal").removeClass("nl-hidden");
  $.featherlight(".nl-signInContainer");
  a &&
    ($(".featherlight-content .nl-feedback-modal h2").text(
      i18n("js.How can we help you?")
    ),
    $(".featherlight-content .nl-feedback-modal #inputName").val(b),
    $(".featherlight-content .nl-feedback-modal #inputEmail").val(e));
}
function getRegistrationUrl(a, b, e) {
  let k = "";
  void 0 !== e && (k = e);
  e = window.location.href;
  k = 0 <= e.indexOf("?") ? "&" + k : "?" + k;
  return (
    "/registration#flow=" +
    a +
    "&url=" +
    encodeURIComponent(e + k) +
    "&reason=" +
    encodeURIComponent(b)
  );
}
function showSignUp(a, b) {
  var e = a.split("\t");
  0 <= e.indexOf("LockedStep")
    ? (window.location = getRegistrationUrl("lock", a, b))
    : 0 <= e.indexOf("Graphing") || 0 <= e.indexOf("Solver")
    ? (window.location = getRegistrationUrl("upgrade", a, b))
    : 0 <= e.indexOf("SolverSaveNote")
    ? (window.location = getRegistrationUrl("notebook", a))
    : 0 <= e.indexOf("GraphSave")
    ? (window.location = getRegistrationUrl("signup", a, b))
    : (window.location = getRegistrationUrl("signup", a));
}
function sendCourseHeroLink() {
  return $.ajax({
    type: "POST",
    url: "/requestChEmail",
    data: { sourceURL: window.location.href },
    beforeSend: authorizeAjaxWithSyToken,
  });
}
function showSubscription(a, b) {
  const e = getRegistrationUrl("upgrade", a, b);
  "iOS" === OS
    ? setTimeout(() => {
        window.location = e;
      }, 100)
    : (window.location = e);
}
function showGroupLicense(a) {
  $(".nl-signInContainer>div").addClass("nl-hidden");
  $(".nl-groupLicense").removeClass("nl-hidden");
  $.featherlight(".nl-signInContainer");
  setSelectedSubscriptionOption($("td.subscribeOption:visible").last());
  renderPaypalGroupButton(a, "todo: clean the code");
}
function renderPaypalGroupButton(a, b) {
  loadScript(
    "https://www.paypal.com/sdk/js?client-id=" + b + "&currency=USD"
  ).done(function () {
    paypal
      .Buttons({
        style: { shape: "pill", color: "gold" },
        createOrder: function (e, k) {
          e = getGroupOrder(a);
          return k.order.create(e);
        },
        onApprove: paypalOnApprove,
        onCancel: paypalOnCancel,
        onError: paypalOnError,
      })
      .render(
        ".featherlight-content .nl-groupLicense #group-payment-paypal-button"
      );
  });
}
function getFixedStepsFormatAPI(a) {
  for (var b = [], e = 0; e < a.length; e++) {
    var k = a[e];
    if ("interim" === k.type) b.push(k);
    else if (null != k.steps && 1 < k.steps.length) {
      for (var l = 0; l < k.steps.length; l++) b.push(k.steps[l]);
      k.entire_result && b.push({ entire_result: k.entire_result });
    } else b.push(k);
  }
  return b;
}
function getFixedStepsFormat(a) {
  for (var b = [], e = 0; e < a.length; e++) {
    var k = a[e];
    if (k.isInterimStep) b.push(k);
    else if (null != k.steps && 1 < k.steps.length) {
      for (var l = 0; l < k.steps.length; l++) b.push(k.steps[l]);
      k.entire_result && b.push({ entire_result: k.entire_result });
    } else b.push(k);
  }
  return b;
}
function createAndShowTooltipTimout(a, b, e, k) {
  $(a).tooltipster({
    content: b,
    theme: "tooltipster-light",
    side: k,
    restoration: "none",
    trigger: "custom",
  });
  $(".sy-tooltip-close-icon:visible").click();
  $(a).tooltipster("show");
  setTimeout(function () {
    $(a).tooltipster("destroy");
  }, e);
}
function removeUserSettings() {
  getLocalStorage().removeItem("settings.numDecimalDisplay");
  getLocalStorage().removeItem("settings.printOpen");
  getLocalStorage().removeItem("settings.printGraph");
}
function removeUserInfo() {
  getLocalStorage().removeItem("udid");
  getLocalStorage().removeItem("firstName");
  getLocalStorage().removeItem("sy.udid");
  getLocalStorage().removeItem("sy.firstName");
}
function logout() {
  removeAllUserInfo();
  window.location = "/logout";
}
function removeAllUserInfo() {
  eraseTerminalSessionStringCookie();
  removeUserSettings();
  removeUserInfo();
}
function logUserOutWithoutRedirect() {
  removeAllUserInfo(void 0);
  return $.ajax({ data: { isMobile: !0 }, url: "/logout", type: "GET" });
}
function refreshLeftNavbarHeight() {
  var a = $(".nl-content:visible").height(),
    b = $(".nl-pageContent").height();
  a = Math.max(b, a);
  0 < a &&
    ($("#navbarStyle").remove(),
    $("head").append(
      $(
        "<style id='navbarStyle'>.nl-leftNav { min-height: " +
          (a + 110) +
          "px; }</style>"
      )
    ),
    $("head").append(
      $(
        "<style id='navbarStyle'>.sidebar-content { min-height: " +
          (a + 100) +
          "px; }</style>"
      )
    ));
}
$(window).load(function () {
  refreshLeftNavbarHeight();
});
function prepareGeometryForReload() {
  return "undefined" != typeof SYGEO
    ? SYGEO.doShareCreateRequest().then(function (a) {
        SYGEO.userIsLoggingIn = !0;
        return "temporaryShare=" + a._id;
      })
    : Promise.reject();
}
$(function () {
  function a() {
    var n = $(".nl-autocomplete");
    n.empty();
    n.hide();
  }
  function b() {
    return window.location.pathname.indexOf("/solver")
      ? "Solver"
      : window.location.pathname.indexOf("/graphing-calculator")
      ? "Graphing"
      : window.location.pathname.indexOf("/notebook")
      ? "Notebook"
      : window.location.pathname.indexOf("/practice")
      ? "Practice"
      : window.location.pathname.indexOf("/calculator")
      ? "Calculators"
      : window.location.pathname;
  }
  function e(n) {
    n.addClass("nl-disabled");
    var q = $.Deferred(),
      v = $.Deferred();
    $.when(
      symbolab_log("Registration", "SignInAttempt-Email", registrationReason)
    ).always(function () {
      q.resolve();
    });
    $.ajax({
      type: "POST",
      url: "/login",
      data: {
        email: $(".featherlight-content #signin_email").val(),
        password: $(".featherlight-content #signin_password").val(),
        url: window.location.href,
        registrationReason,
        remember: $(".featherlight-content #rememberMe").prop("checked"),
      },
      success: function (f) {
        f.alert
          ? ($(".nl-signInWithText .nl-error").text(f.alert),
            $(".nl-signInWithText .nl-error").show(),
            n.removeClass("nl-disabled"),
            v.reject())
          : prepareGeometryForReload().then(
              function (h) {
                location.hash = h;
                v.resolve();
              },
              function () {
                v.resolve();
              }
            );
      },
      error: function () {
        n.removeClass("nl-disabled");
        v.reject();
      },
    });
    $.whenAll(v, q).done(function () {
      location.reload();
    });
  }
  1 == getLocalStorage().getItem("beforeSubs") &&
    getLocalStorage().removeItem("beforeSubs");
  $.featherlight.defaults.afterClose = function (n) {
    $(".nl-signInContainer>div").addClass("nl-hidden");
  };
  $(".nl-search").click(function (n) {
    var q = $(".nl-searchContainer input");
    $(n.originalEvent.target).is(q) ||
      (q.val(""),
      (n = $("#nl-mainNav")),
      n.toggleClass("nl-searchOpen"),
      n.hasClass("nl-searchOpen") &&
        (q.focus(),
        "/" === window.location.pathname
          ? symbolab_log("General", "Subject Search Open Homepage")
          : symbolab_log("General", "Subject Search Open")),
      a());
  });
  $("body").click(function (n) {
    $("#nl-mainNav").hasClass("nl-searchOpen") &&
      0 === $(n.originalEvent.target).parents(".nl-search").length &&
      a();
  });
  $(".nl-searchClose").click(function (n) {
    n.preventDefault();
    n.stopPropagation();
    $(".nl-search").css({ width: 40 });
    $(".nl-autocomplete").empty();
    $(".nl-autocomplete").hide();
    setTimeout(function () {
      $("#nl-mainNav").removeClass("nl-searchOpen");
      $(".nl-search").removeAttr("style");
    }, 200);
  });
  var k = !1;
  $("#nl-searchField").keyup(function () {
    if (!k) {
      k = !0;
      var n = $(".nl-searchContainer input").val();
      $.ajax({
        type: "GET",
        url: "/suggestSubjects",
        data: {
          query: n,
          language: "en",
          type:
            0 <= window.location.href.indexOf("/solver/")
              ? "Solutions"
              : "Practice",
        },
        success: function (q) {
          if (null == q || 0 == q.length) $(".nl-autocomplete").hide();
          else {
            $(".nl-autocomplete").empty();
            for (var v = null, f = 0; f < q.length; f++) {
              var h = q[f];
              h.type != v &&
                ($(".nl-autocomplete").append(
                  "<div class='type'>" + h.type + "</div>"
                ),
                (v = h.type));
              h.display = h.display.replace(/'/, "&apos;");
              var c =
                'getLocalStorage().setItem("linkOrigin", "SubjectSuggest"); window.location="' +
                h.search +
                '";';
              $(".nl-autocomplete").append(
                "<div class='result' onclick='" +
                  c +
                  "'>" +
                  h.display +
                  "</div>"
              );
            }
            $(".nl-autocomplete").fadeIn();
          }
          k = !1;
        },
      });
    }
  });
  $("#fbCancelBtn").click(function () {
    $.featherlight.current().close();
    $(".nl-signInContainer>div").addClass("nl-hidden");
  });
  $("#fbSendBtn").click(function () {
    var n = {};
    n.name = $(".featherlight-content .nl-feedback-modal #inputName").val();
    n.email = $(".featherlight-content .nl-feedback-modal #inputEmail").val();
    n.message = $(
      ".featherlight-content .nl-feedback-modal #inputMessage"
    ).val();
    n.url = window.location.href;
    n.referrer = document.referrer;
    "undefined" != typeof SYPRACTICE &&
      ((n.subject = SYPRACTICE.subject),
      (n.topic = SYPRACTICE.topic),
      (n.subTopic = SYPRACTICE.subTopic),
      (n.problem = SYPRACTICE.problemInfo.problem.problemTranslation));
    "undefined" != typeof syUnsubscribe &&
      symbolab_log(
        "Registration",
        "ClickedFeature",
        `NewUnsubscribe\t${syUnsubscribe.planType}\tHelpSent`
      );
    n.message
      ? ($.ajax({
          type: "POST",
          url: "/feedback",
          beforeSend: authorizeAjaxWithSyToken,
          data: n,
        }),
        $(".featherlight-content .nl-feedback-modal .alert-error").hide(),
        $(".featherlight-content .nl-feedback-modal .alert-success").show(),
        setTimeout(function () {
          $.featherlight.current().close();
          $(".nl-signInContainer>div").addClass("nl-hidden");
        }, 2e3),
        $(".featherlight-content .nl-feedback-modal #fbSendBtn").addClass(
          "nl-disabled"
        ))
      : $(".featherlight-content .nl-feedback-modal .alert-error").show();
  });
  $(".nl-languagesMenu a").click(function (n) {
    n.preventDefault();
    var q = $(this).attr("href");
    $.when(pickLanguage($(this).attr("data"))).always(function () {
      window.location = q;
    });
  });
  $("#join").click(function () {
    showSignUp("TopMenu\t" + b());
  });
  $("#upgrade").click(function () {
    showSubscription("UpgradeButton\t" + b());
  });
  $(".subscribeOption").click(function () {
    setSelectedSubscriptionOption($(this));
    symbolab_log("Registration", "BrowsePlan", $(this).attr("id"));
  });
  $("input[type=radio][name=subscriptionTypeRadio]").change(function () {
    setSelectedSubscriptionOption(
      $(this).parent().parent().find(".subscribeOption")
    );
  });
  $("#noAccount").click(function () {
    $(".nl-signInContainer>div").addClass("nl-hidden");
    $(".nl-signUpWithText").removeClass("nl-hidden");
    symbolab_log("Registration", "ShowSignUp", registrationReason);
  });
  $("#haveAccount").click(function () {
    $(".nl-signInContainer>div").addClass("nl-hidden");
    $(".nl-signInWithText").removeClass("nl-hidden");
    symbolab_log("Registration", "ShowSignIn", registrationReason);
  });
  $(".nl-forgotPasswordLink").click(function () {
    $(".nl-signInContainer>div").addClass("nl-hidden");
    $(".nl-forgotPassword").removeClass("nl-hidden");
  });
  $(".nl-joinEmail").click(function () {
    var n = $(this);
    n.hide();
    $(".nl-joinEmailForm").show();
    symbolab_log("Registration", "ClickJoinEmail");
    n.parent()
      .parent()
      .parent()
      .parent()
      .parent()
      .parent()
      .parent()
      .parent()
      .parent()
      .animate({ scrollTop: 300 });
  });
  $(".nl-signInButton").click(function () {
    var n = $(this);
    e(n);
  });
  $(".nl-signIn input").on("keyup", function (n) {
    13 == n.keyCode &&
      ((n = $(this).closest(".nl-signIn").find(".nl-signInButton")),
      n.hasClass("nl-disabled") || e(n));
  });
  $(".nl-resetButton").click(function () {
    var n = $(this);
    n.addClass("nl-disabled");
    symbolab_log("Registration", "ResetPasswordClicked");
    $.ajax({
      type: "POST",
      url: "/resetRequest",
      data: { email: $(".featherlight-content #reset_email").val() },
      success: function (q) {
        q.success
          ? ($(".nl-forgotPassword").hide(),
            $(".nl-forgotPasswordSuccess").show(),
            $(".nl-forgotPasswordSuccess .nl-bold").text(q.email))
          : ($(".nl-forgotPassword .nl-error").text(q.alert),
            $(".nl-forgotPassword .nl-error").show(),
            n.removeClass("nl-disabled"));
      },
      error: function () {
        n.removeClass("nl-disabled");
      },
    });
  });
  var l = {};
  parseQueryParameters(l);
  "true" !== l.upgrade ||
    subscribed ||
    showSubscription(getLocalStorage().getItem("registrationReason"));
});
var sy_subscType;
function paypalOnApprove(a, b) {
  a.type = sy_subscType;
  a.variation = sy_var;
  a.country = sy_cid;
  $(".featherlight-content .nl-signInContainer>div").addClass("nl-hidden");
  $(".featherlight-content .nl-processing").removeClass("nl-hidden");
  var e = $.Deferred();
  $.when(
    symbolab_log(
      "Registration",
      "SubscribeCompleted-" + sy_subscType,
      registrationReason
    )
  ).always(function () {
    e.resolve();
  });
  var k = $.Deferred();
  $.ajax({
    type: "POST",
    url: "/paypal/onApprove",
    beforeSend: authorizeAjaxWithSyToken,
    data: a,
    success: function (l) {
      "success subscription" === l.alert
        ? ($(".featherlight-content .nl-signInContainer>div").addClass(
            "nl-hidden"
          ),
          $(".featherlight-content .nl-thankYouSubsc #subsRenewText").text(
            i18n("Subscription renews " + sy_subscType)
          ),
          $(".featherlight-content .nl-thankYouSubsc").removeClass("nl-hidden"),
          ($.featherlight.defaults.afterClose = function () {
            k.resolve();
          }))
        : "success payment" === l.alert
        ? ($(".featherlight-content .nl-signInContainer>div").addClass(
            "nl-hidden"
          ),
          $(".featherlight-content .nl-thankYou").removeClass("nl-hidden"),
          ($.featherlight.defaults.afterClose = function () {
            k.resolve();
          }))
        : ($(".featherlight-content .nl-signInContainer>div").addClass(
            "nl-hidden"
          ),
          $(".featherlight-content .nl-failed").removeClass("nl-hidden"),
          k.reject());
    },
    error: function (l, n, q) {
      console.log();
    },
  });
  $.whenAll(e, k).done(function () {
    location.reload();
  });
  return !0;
}
function getAmount() {
  return "special" === sy_subscType
    ? 12.99
    : "weekly" === sy_subscType
    ? 1.99
    : "monthly" === sy_subscType
    ? 6.99
    : "annually" === sy_subscType
    ? 29.99
    : 0;
}
function paypalOnCancel(a) {
  symbolab_log(
    "Registration",
    "PayPalCancel-" + sy_subscType,
    registrationReason
  );
}
function paypalOnError(a) {
  symbolab_log(
    "Registration",
    "PayPalError-" + sy_subscType,
    registrationReason
  );
}
function getSubscription() {
  var a = "";
  $.ajax({
    type: "GET",
    url: "/paypal/getSubscription",
    async: !1,
    data: { type: sy_subscType, variation: sy_var, country: sy_cid },
    beforeSend: authorizeAjaxWithSyToken,
    success: function (b) {
      a = b;
    },
  });
  return a;
}
function getGroupOrder(a) {
  var b = "";
  $.ajax({
    type: "GET",
    url: "/paypal/getGroupOrder",
    async: !1,
    data: {
      groupId: a,
      type: sy_subscType,
      promo: $(".featherlight-content #promoText").val(),
    },
    beforeSend: authorizeAjaxWithSyToken,
    success: function (e) {
      b = e;
    },
  });
  return b;
}
function setSelectedSubscriptionOption(a) {
  $(".featherlight-content .subscribe-button").addClass("nl-disabled");
  var b = a.data("button");
  sy_subscType = a.attr("id");
  $(".featherlight-content #" + b).removeClass("nl-disabled");
  $(a.parent().find("input")).prop("checked", !0);
}
function createMatrixLatex(a, b) {
  for (var e = "\\begin{pmatrix}", k = 0; k < a; k++) {
    for (var l = 0; l < b - 1; l++) e += "&";
    k < a - 1 && (e += "\\\\");
  }
  return e + "\\end{pmatrix}";
}
function createCustomMatrix(a) {
  a.empty();
  a.append(
    "<div class='title'>" +
      i18n("matrix-select-size") +
      " <span class='customMatrixDimensions'></span></div>"
  );
  a.append(
    "<span class='closeCustomMatrix'><div>" +
      i18n("matrix-close") +
      "</div></span>"
  );
  for (
    var b =
        "<div class='matrixTable' style='padding-right: 0px !important; '><table>",
      e = 0;
    10 > e;
    e++
  ) {
    b += "<tr>";
    for (var k = 0; 10 > k; k++) b += "<td class='customMatrixTd'/>";
    b += "</tr>";
  }
  a.append(b + "</table></div>");
  a.show();
  $(".customMatrixTd").hover(function () {
    $(".customMatrixTd").removeClass("on");
    for (
      var l = $(this).parent().children().index($(this)) + 1,
        n = $(this).parent().parent().children().index($(this).parent()) + 1,
        q = 0;
      q < n;
      q++
    )
      for (
        var v = $(this).parent().parent().children().eq(q), f = 0;
        f < l;
        f++
      )
        v.children().eq(f).addClass("on");
    $(".customMatrixDimensions").text(n + "x" + l);
  });
  $(".customMatrixTd").click(function () {
    var l = $(this).parent().children().index($(this)) + 1,
      n = $(this).parent().parent().children().index($(this).parent()) + 1,
      q = createMatrixLatex(n, l);
    a.hide();
    "undefined" != typeof SYPAD
      ? (SYPAD.inputBox().mathquill("write", q, n * l),
        SYPAD.inputBox().focus())
      : ($(".mathquill-editable").mathquill("write", q, n * l),
        $(".mathquill-editable").focus());
    return !1;
  });
  a.find(".closeCustomMatrix").click(function () {
    a.hide();
    return !1;
  });
}
jQuery.fn.selectText = function () {
  var a = this[0];
  if (document.body.createTextRange) {
    var b = document.body.createTextRange();
    b.moveToElementText(a);
    b.select();
  } else if (window.getSelection) {
    var e = window.getSelection();
    b = document.createRange();
    b.selectNodeContents(a);
    e.removeAllRanges();
    e.addRange(b);
  }
};
function pageExpired(a, b) {}
function browser() {
  var a = navigator.appName,
    b = navigator.userAgent,
    e,
    k = b.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);
  k && null != (e = b.match(/version\/([\.\d]+)/i)) && (k[2] = e[1]);
  return (k = k ? [k[1], k[2]] : [a, navigator.appVersion, "-?"]);
}
var invertStyleContents =
    "<style type='text/css' id='invert-style'>@media screen {@-moz-document url-prefix('') { \tbody { \t\tbackground-color: black!important; \t} } html { \t-webkit-filter: invert(100%); \t-moz-filter: invert(100%); \t-o-filter: invert(100%); \t-ms-filter: invert(100%); \tfilter: invert(100%); } #HomeTopNav, #home_left_img, #home_right_img, .nl-search, .nl-searchContainer,#CodepadHead i.active,  #CodepadHead i:hover, #nl-feedback-text,.first.active, .search, .locked-step,.radBtn.active, .degBtn.active, .equalsBtn, .verify-button,.actionIcon:not(.selectize-control), .shareIcon, .solution-examples-img,.nl-actionButton.graph_menu_button, .colorIndication.colorBall,#resetSettingsBtn, .alertIndication, .practiceImg, .pMTitle,#customQuiz, .nl-quizBtn, .nl-title, .nl-redButton.nl-verify,.nl-practice-sprite.nl-practice-sprite-hintIcon, #nl-showHintsText, .nl-practice-sprite.nl-practice-sprite-hintArrow,.nl-relatedTopics, .nl-seeMoreClosed, .nl-seeMoreOpened,#clear-textfield, #add-given-button, #prove-find-selectors,.link_decoration, .search_image1, .locked-step, #fbSendBtn, #shapes svg,#add_segments_image, #triangle-shape-image, #icon_square_image, #circle-shape-select-icon, #parallels_image,.nl-leftMenu.active, .givenLabel, .nl-forgotPasswordLink, .nl-alreadyRegistered,#signInTopText, #centerIllustration, .signInHeader, #registerButton,.clickable.nl-practice-sprite, .shareIcon, .send.save.highlight-background,.structuredWhat, .structured_label, #empty_state_image,:not(.active) > .new_indication, .bloggerIcon, .post_more, .helpTop, .popular, #title,.item, #nl-correctAnswers, .nl-third.nl-summary-text.subTopicSummary, .nl-quizHistory, .corner-ribbon.print-hide,.admin.badge, .user-avatar, .select-number, .infoWhite .progressBar,.new-group-placeholder > .text, .new-group-placeholder > .line-h, .new-group-placeholder > .line-v,.edit > .icon, .delete-btn > .icon, .notebook > .icon, .dashboard > .icon, .member, .navigation-wrapper > .active,.accept-buttons, .differences, .add-member-button, .add-button, .sl > .purchase,.userInfoButton, svg.stock-avatar, .user-avatar .stock-avatar use, .nl-practice-sprite.nl-graphing-calc-icon,.remindMeLater, .planTitle, .planTerms, #plans_with_buttons input,#express-paypal-button-oneTime, div#express-paypal-button-subsc,.button-container > .cancel, .button-container > .save, .signUpList img, .subscriptionTypeRadioClass,.notebookLink, .groupOverMainSvg, .left-group, #groupTitleUse, .groups-icon, .groupOverviewTitle,#redoTopic, .nl-questionMark, .nl-answerCaption.nl-greenText, .nl-practice-sprite.nl-search-icon,.content-progress, .content-target .summary, .score-badge, .subject.open,.upload-avatar-img, .upload-avatar .upload-1, .update-avatar-button, p#profileUpdateSuccess,#group-payment-paypal-button, .groupNameSmall, .nameAndTopic svg use, #editAssignment svg, #removeAssignment svg,.msftBadge, .nl-facebook, .nl-microsoft, .nl-joinEmail, .nl-signInButton, .nl-createEmailAccount, #ShareButtons, #at-expanded-menu-host, #at20mc, #LikeButtons, #itunesLink, #androidLink, .googleAdsenseMiddle, #googleAdSenseHomepage, .googleAdsense, .adblock-replacement,.googleLeftSkyScrapper, .practiceAd, .practiceAd2, .avatar-success.alert-success,.active > img.avatar-image, .current-avatar > img.avatar-image, .userName img.avatar-image,.stock-list svg, .g_id_signin { \t-webkit-filter: invert(100%)!important; \t-moz-filter: invert(100%)!important; \t-o-filter: invert(100%)!important; \t-ms-filter: invert(100%)!important; \tfilter: invert(100%)!important; } .alertIndication {background-color: #181818!important;}.mathquill-rendered-math .empty {background: #CCCCCC!important;}.btn-custom.search {border: 1px solid #444444!important;}#nl-mainNav ul li.nl-navAction.nl-search {border-left: 1px solid #333333!important;}.new-pad-button {background-color: #E8E8E8!important;}#given-selector {background-color: #222222;}#given-selector:not(.selected) {color : #AAAAAA!important;}#prove-selector {background-color: #222222;}#prove-selector:not(.selected) {color : #AAAAAA!important;}#find-selector {background-color: #222222;}#find-selector:not(.selected) {color : #AAAAAA!important;}#find-selector:not(.selected) {color : #AAAAAA!important;}.groupTitle {color: #fe6d6e!important;}.groupName {color: #fe6d6e!important;}.nl-pageContent #group-lists .new-group-placeholder {border: solid 1px #fe6d6e !important;}#shapes > ul > li > a {background-color: #D8D8D8!important;}.member {background-color: #222222!important;}.navigation-wrapper > .active {color: #FFFFFF!important;}span.planTitle:not(#winterPromotion), span.planTerms:not(#pricePromotion) {color: #BBBBBB!important;}}</style>",
  invertStyleContentsHomepage =
    "<style type='text/css' id='invert-style'>@media screen {@-moz-document url-prefix('') { \tbody { \t\tbackground-color: black!important; \t} } html { \t-webkit-filter: invert(100%); \t-moz-filter: invert(100%); \t-o-filter: invert(100%); \t-ms-filter: invert(100%); \tfilter: invert(100%); } #home_left_img, #home_right_img, .nl-search, .nl-searchContainer, #nl-mainNav ul li:not(#HomeTopNav):hover span,#CodepadHead i.active,  #CodepadHead i:hover, #nl-feedback-text,.first.active, .search, .locked-step,.radBtn.active, .degBtn.active, .equalsBtn, .verify-button,.actionIcon:not(.selectize-control), .shareIcon, .solution-examples-img,.nl-actionButton.graph_menu_button, .colorIndication.colorBall,#resetSettingsBtn, .alertIndication, .practiceImg, .pMTitle,#customQuiz, .nl-quizBtn, .nl-title, .nl-redButton.nl-verify,.nl-practice-sprite.nl-practice-sprite-hintIcon, #nl-showHintsText, .nl-practice-sprite.nl-practice-sprite-hintArrow,.nl-relatedTopics, .nl-seeMoreClosed, .nl-seeMoreOpened,#clear-textfield, #add-given-button, #prove-find-selectors,.link_decoration, .search_image1, .locked-step, #fbSendBtn, #shapes svg,#add_segments_image, #triangle-shape-image, #icon_square_image, #circle-shape-select-icon, #parallels_image,.nl-leftMenu.active, .givenLabel, .nl-forgotPasswordLink, .nl-alreadyRegistered,#signInTopText, #centerIllustration, .signInHeader, #registerButton,.clickable.nl-practice-sprite, .shareIcon, .send.save.highlight-background,.structuredWhat, .structured_label, #empty_state_image,:not(.active) > .new_indication, .bloggerIcon, .post_more, .helpTop, .popular, #title,.item, #nl-correctAnswers, .nl-third.nl-summary-text.subTopicSummary, .nl-quizHistory, .corner-ribbon.print-hide,.admin.badge, .user-avatar, .select-number, .infoWhite .progressBar,.new-group-placeholder > .text, .new-group-placeholder > .line-h, .new-group-placeholder > .line-v,.edit > .icon, .delete-btn > .icon, .notebook > .icon, .dashboard > .icon, .member, .navigation-wrapper > .active,.accept-buttons, .differences, .add-member-button, .add-button, .sl > .purchase,.userInfoButton, svg.stock-avatar, .user-avatar .stock-avatar use, .nl-practice-sprite.nl-graphing-calc-icon,.remindMeLater, .planTitle, .planTerms, #plans_with_buttons input,#express-paypal-button-oneTime, div#express-paypal-button-subsc,.button-container > .cancel, .button-container > .save, .signUpList img, .subscriptionTypeRadioClass,.notebookLink, .groupOverMainSvg, .left-group, #groupTitleUse, .groups-icon, .groupOverviewTitle,#redoTopic, .nl-questionMark, .nl-answerCaption.nl-greenText, .nl-practice-sprite.nl-search-icon,.content-progress, .content-target .summary, .score-badge, .subject.open,.upload-avatar-img, .upload-avatar .upload-1, .update-avatar-button, p#profileUpdateSuccess,#group-payment-paypal-button, .groupNameSmall, .nameAndTopic svg use, #editAssignment svg, #removeAssignment svg,.msftBadge, .nl-facebook, .nl-microsoft, .nl-joinEmail, .nl-signInButton, .nl-createEmailAccount,#ShareButtons, #at-expanded-menu-host, #at20mc,#LikeButtons, #itunesLink, #androidLink, .googleAdsenseMiddle,#googleAdSenseHomepage, .googleAdsense,.googleLeftSkyScrapper, .practiceAd, .practiceAd2, .avatar-success.alert-success,.active > img.avatar-image, .current-avatar > img.avatar-image, .userName .whiteDropdown,#nl-topics, .m2u li a, .red_background, .bar-selected, #verify-btn, .nl-notesFav.note1, #show-steps-button,#view_full_notebook, .related_arrow, .collapse, .expand, #send-us-feedback > *, .viewLargerPlot svg, .show-more,.dotted-line-background, .show-hide-steps-box > *, #practice-link-container img, .homepage-solver-app-store,#next-step-button, #steps-button .open, #save-as-bookmark > svg, #save-as-bookmark-notebook, #save-as-bookmark-signin,#save-as-bookmark-notebook-saved, #save-as-bookmark-save-saved, #empty_bookmark, #toggle_mini_keypad, .toggle_mini_keypad,.googleAdsense, .stock-list svg, .parentPage.foldable:hover .red_color,.parentPage.foldable.red_background span, #verify-btn-wrapper:hover span, #bar-bookmark:hover span,i.active .mathquill-rendered-math .overline ,i:hover > .mathquill-rendered-math .overline,#nl-mainNav, #HomeTopNav svg use, #userName svg use,\n#HomeTopNav svg, #userName svg, #toggle-pad-on svg, .nl-searchContainer,\n#word_problems_img, #graphing_img, #geometry_img, #homepage-practice-headline, #homepage-practice-headline2,\n#homepage-practice-button, #reel_img, #solution_page_mobile_img, #homepage-practice-img, #solution_page_img,\n#homepage-explore-board div, #popular-calculators-links > div > svg,\n.home-only svg, #feedback-button, .feedback-button, #social-buttons a svg, .homepage-solver-app-store,\n.toggle-full-pad svg, .arrow_left1, #relatedList .more,.short-title-div a, #video-section, i.active .mathquill-rendered-math .overline, #nl-logo,#short-show-all, .short-calculators-title, .long-calculators-title,.input-bar, #sliders-button, .triple-bar, #pad-toggle-button, #keypad div.keypanel span.touch, .plotBalloon, .plotBalloon div,.red_background_parent svg#canvasSettings, .graphCheckbox svg, .input_template, .alertIndication1,#sign-in-button, #sign-bookmark, .save.bar-bookmark span, .tooltipstered1,.nl-notesFav, .tooltipster-box, .nl-notesFav1,.nl-content.nl-headline-content, .skin-clean #calculate-buttons-line svg use, .skin-clean #calculate-btn,.skin-orange #main-calculator, .skin-orange .givenInput, .skin-orange .units,.g_id_signin, #study-guide article img { -webkit-filter: invert(100%)!important;-moz-filter: invert(100%)!important;-o-filter: invert(100%)!important;-ms-filter: invert(100%)!important;filter: invert(100%)!important;}#homepage-second-block-inner, #homepage-explore {\nbackground-color: #E0E0E0!important;\n}\n#homepage-solver-banner {\nbox-shadow: 0 2px 14px rgba(0, 0, 0, 0.4)!important;\n}\nli.nl-search {\nbackground-color: #3ac6af!important;\n}\n#Codepad {\nbackground-color: #24c0a6!important;\n}\n.alertIndication {}.mathquill-rendered-math .empty {background: #CCCCCC!important;}.btn-custom.search {border: 1px solid #444444!important;}#nl-mainNav ul li.nl-navAction.nl-search {border-left: 1px solid #333333!important;}.new-pad-button {background-color: #E8E8E8!important;}#given-selector {background-color: #222222;}#given-selector:not(.selected) {color : #AAAAAA!important;}#prove-selector {background-color: #222222;}#prove-selector:not(.selected) {color : #AAAAAA!important;}#find-selector {background-color: #222222;}#find-selector:not(.selected) {color : #AAAAAA!important;}#find-selector:not(.selected) {color : #AAAAAA!important;}.groupTitle {color: #fe6d6e!important;}.groupName {color: #fe6d6e!important;}.nl-pageContent #group-lists .new-group-placeholder {border: solid 1px #fe6d6e !important;}#shapes > ul > li > a {background-color: #D8D8D8!important;}.member {background-color: #222222!important;}.navigation-wrapper > .active {color: #FFFFFF!important;}span.planTitle:not(#winterPromotion), span.planTerms:not(#pricePromotion) {color: #BBBBBB!important;}.nl-leftMenu:not(.red_color) .pointer, .nl-leftMenu:not(.red_color) span:not(.red) {color: white;}#stock-avatar-light-mode .stock-avatar.signed-out, #stock-avatar-light-mode .stock-avatar.signed-out use {filter: saturate(0)!important;}#bread-crumbs *, .mathquill-input, .mathquill-editable, .mathquill-rendered-math, .placeholder {color: black;}.short-body-div a, .long-calculators-title a {color: black;}#dym-target > a {border: 1px solid black!important;}.info {\nfilter: brightness(0%)!important;\n}.toggle-full-pad span, .new_solution_box_title, #topic-description_title, .new_solution_box_title2, a.viewLargerPlot,#most_used_actions h2, #main-input.mathquill-input.mathquill-editable, .mathquill-embedded-latex,#topic-description_body, #FAQ div, #FAQ li span ,.post_title, .post_content, #most_used_actions select,#dym-target span, #dym h2, .plotting, .solution_display_row .solution_scrollable #mathquillQueryInput * ,#solution-only-one-line .mathquill-embedded-latex * , .new_solution_box_title1, #nl-edit-bar a:not(.bar-selected),.solution_step_primary .mathquill-embedded-latex span, .steps-title, #solution-only h2, #practice-link-container, .solution_step_primary .mathquill-embedded-latex var, .solution_step_secondary .mathquill-embedded-latex span, #keypad div.keypanel span {color: black!important;}a.popular.popular_examples .mathquill-embedded-latex {color: #707070!important;}#nl-edit-bar a.bar-selected.pill {color: #DB3F59 !important;}#Examples_section, #input-and-go, #top-three-notes, #send-us-feedback, #topic-description, .new_solution_box_body,#solution-only-container,.nl-leftNav > div {box-shadow: 0px 1.74375px 13.95px rgba(0, 0, 0, 0.1);}.m2u_hr {border: 1px solid #d5d3d3!important;}.sliders-button {background-color: white;}#sliders-button, #sliders-button-close {display: none;}svg#sliders-button-inverse, svg#sliders-button-close-inverse {display: block;}#examples a div p, .titleInput::placeholder, .graphMainMenu div a {color: black!important;}.nl-notesFav, .menu, #canvasZoom :not(.red_background_parent) #canvasSettings use, #graph-plus-minus img, #graph-focus img,.graphMainMenu > div a svg, .graphSettingLabel, .axisName, .axisLabel input::placeholder, .rangeContainer, #input #keypad div.keypanel span svg {filter: brightness(0);}.graphMainMenu > div a:hover {background-color: #24c0a626!important;}.input-row > div > span, .row-left span {color: white;}#calculator_page1 {background-color: #E9EBEB;}#form-calculator .dark {background-color: #DDDDDD!important;}}</style>";
function getProductByUrl() {
  return 0 <= window.location.href.indexOf("/solver")
    ? "Solutions"
    : 0 <= window.location.href.indexOf("/practice")
    ? "Practice"
    : 0 <= window.location.href.indexOf("/notebook")
    ? "Notebook"
    : 0 <= window.location.href.indexOf("/graphing-calculator")
    ? "GraphingCalculator"
    : "Action";
}
function liveToggleInvert(a) {
  a
    ? (0 == $("#invert-style").size() &&
        $("head").append($(invertStyleContents)),
      $(".nl-lightsOutSwitch").attr("title", i18n("js.Lights on")))
    : ($("#invert-style").remove(),
      $(".nl-lightsOutSwitch").attr("title", i18n("js.Lights out")));
}
function liveToggleInvertHomepage(a) {
  a
    ? (0 === $("#invert-style").size() &&
        ($("head").append($(invertStyleContentsHomepage)),
        $(".toggle_mini_keypad .open").attr(
          "src",
          "/public/images/toggle_open_dm.png"
        )),
      $(".nl-lightsOutSwitch").attr("title", i18n("js.Lights on")))
    : ($("#invert-style").remove(),
      $(".nl-lightsOutSwitch").attr("title", i18n("js.Lights out")),
      $(".toggle_mini_keypad .open").attr(
        "src",
        "/public/images/toggle_open.png"
      ));
  graphingSlider(a);
}
function graphingSlider(a) {
  a && 0 < $("#sliders-button").length
    ? 0 === $("#sliders-button.hide").length
      ? ($("#sliders-button-inverse").attr("class", "sliders-button-inverse"),
        $("#sliders-button-close-inverse").attr(
          "class",
          "sliders-button-inverse hide-important"
        ))
      : ($("#sliders-button-inverse").attr(
          "class",
          "sliders-button-inverse hide-important"
        ),
        $("#sliders-button-close-inverse").attr(
          "class",
          "sliders-button-inverse"
        ))
    : !a &&
      0 < $("#sliders-button-inverse").length &&
      (0 === $("#sliders-button-inverse.hide-important").length
        ? ($("#sliders-button").attr("class", "sliders-button"),
          $("#sliders-button-close").attr("class", "sliders-button hide"))
        : ($("#sliders-button").attr("class", "sliders-button hide"),
          $("#sliders-button-close").attr("class", "sliders-button")));
}
function ensureCorrectLightsOut() {
  "true" === getInverseCookieValue()
    ? liveToggleInvert(!0)
    : liveToggleInvert(!1);
}
function lightsOut() {
  "true" === getInverseCookieValue()
    ? (createInvertCookie("false"),
      liveToggleInvert(!1),
      symbolab_log(getProductByUrl(), "LightsOn", null))
    : (createInvertCookie("true"),
      liveToggleInvert(!0),
      symbolab_log(getProductByUrl(), "LightsOut", null));
}
function ensureCorrectLightsOutHomepage() {
  "true" === getInverseCookieValue()
    ? liveToggleInvertHomepage(!0)
    : liveToggleInvertHomepage(!1);
}
function lightsOutHomepage() {
  "true" === getInverseCookieValue()
    ? (createInvertCookie("false"),
      liveToggleInvertHomepage(!1),
      symbolab_log(getProductByUrl(), "LightsOn", null))
    : (createInvertCookie("true"),
      liveToggleInvertHomepage(!0),
      symbolab_log(getProductByUrl(), "LightsOut", null));
}
function resetUserData() {
  var a = getTerminalSessionStringCookieValue();
  a = !a || 0 <= a.indexOf("Start") ? "End Session" : "Start Session";
  createTerminalSessionStringCookie(a);
  $("#resetTop").text(a);
  $.whenAll(
    $.ajax({
      type: "POST",
      url: "/api/user/clearPractice",
      beforeSend: authorizeAjaxWithSyToken,
    }),
    $.ajax({
      type: "POST",
      url: "/api/notebook/clearNotes",
      beforeSend: authorizeAjaxWithSyToken,
    })
  ).then(function () {
    window.location.href = "/";
  });
}
(function (a) {
  var b = [].slice;
  a.whenAll = function (e) {
    function k(x, C, D) {
      return function () {
        D !== l && h++;
        v.notifyWith((C[x] = this), (D[x] = b.call(arguments)));
        if (!--q) v[(h ? "reject" : "resolve") + "With"](C, D);
      };
    }
    for (
      var l = 1 == arguments.length && a.isArray(e) ? e : b.call(arguments),
        n = l.length,
        q = n,
        v = a.Deferred(),
        f = 0,
        h = 0,
        c = Array(n),
        p = Array(n),
        w = Array(n),
        y;
      f < n;
      f++
    )
      (y = l[f]) && a.isFunction(y.promise)
        ? y.promise().done(k(f, w, l)).fail(k(f, c, p))
        : (v.notifyWith(this, y), --q);
    q || v.resolveWith(w, l);
    return v.promise();
  };
})(jQuery);
function createCookie(a, b, e, k) {
  if (e) {
    var l = new Date();
    l.setTime(l.getTime() + 864e5 * e);
    e = "; expires=" + l.toGMTString();
  } else e = "";
  l = "";
  k ||
    (window.location.href.match(/symbolab\.com/)
      ? (l = ";domain=.symbolab.com")
      : window.location.href.match(/scibug\.com/) &&
        (l = ";domain=.scibug.com"));
  document.cookie =
    encodeURIComponent(a) + "=" + encodeURIComponent(b) + e + "; path=/" + l;
}
function readCookieLegacyFallback(a, b) {
  a = readCookie(a);
  return null == a || "" === a ? readCookie(b) : a;
}
function readCookie(a) {
  a = encodeURIComponent(a) + "=";
  for (var b = document.cookie.split(";"), e = 0; e < b.length; e++) {
    for (var k = b[e]; " " === k.charAt(0); ) k = k.substring(1, k.length);
    if (0 === k.indexOf(a))
      return decodeURIComponent(k.substring(a.length, k.length));
  }
  return null;
}
function eraseCookie(a) {
  createCookie(a, "", -1);
}
function eraseLegacyCookie(a) {
  createCookie(a, "", -1, !0);
}
function isUserLoggedIn() {
  return readCookieLegacyFallback("sy2.token", "sy.token") ? !0 : !1;
}
function createPubTokenCookie(a) {
  createCookie("sy2.pub.token", a, 1);
}
function eraseTerminalSessionStringCookie() {
  eraseCookie("sy2.terminalSessionString");
  eraseLegacyCookie("sy.terminalSessionString");
}
function createTerminalSessionStringCookie(a) {
  eraseTerminalSessionStringCookie();
  createCookie("sy2.terminalSessionString", a);
}
function createTerminalSessionPassCookie(a) {
  createCookie("sy2.terminal.pass", a);
}
function getInverseCookieValue() {
  return readCookieLegacyFallback("sy2.invert", "invert");
}
function getTerminalSessionStringCookieValue() {
  return readCookieLegacyFallback(
    "sy2.terminalSessionString",
    "sy.terminalSessionString"
  );
}
function createInvertCookie(a) {
  allowedCookieGroups("C0003") && createCookie("sy2.invert", a);
}
function authorizeAjaxWithSyToken(a) {
  a.setRequestHeader(
    "Authorization",
    "Bearer " + readCookieLegacyFallback("sy2.token", "sy.token")
  );
}
function authorizeAjaxWithSyPubToken(a) {
  a.setRequestHeader(
    "Authorization",
    "Bearer " + readCookieLegacyFallback("sy2.pub.token", "sy.pub.token")
  );
}
function ajaxImage(a, b, e) {
  return new Promise(function (k, l) {
    var n = new XMLHttpRequest();
    n.onreadystatechange = function () {
      if (4 === this.readyState)
        if (200 === this.status) {
          var q = (window.URL || window.webkitURL).createObjectURL(
              this.response
            ),
            v = this.response;
          b.on("load", function () {
            k(v);
            b.off("load");
          });
          b.attr("src", q);
        } else void 0 !== e && e.hide(), l(this.error);
    };
    n.open("GET", a);
    authorizeAjaxWithSyPubToken(n);
    n.responseType = "blob";
    n.setRequestHeader("x-requested-with", "XMLHttpRequest");
    n.send();
  });
}
function groupSelectSelected(a) {
  a = a[0];
  var b;
  var e = a.parentNode.parentNode.getElementsByTagName("select")[0];
  var k = a.parentNode.previousSibling;
  for (b = 0; b < e.length; b++)
    if (e.options[b].innerHTML == a.innerHTML) {
      e.selectedIndex = b;
      k.innerHTML = a.innerHTML;
      b = a.parentNode.getElementsByClassName("same-as-selected");
      for (e = 0; e < b.length; e++) b[e].removeAttribute("class");
      a.setAttribute("class", "same-as-selected");
      break;
    }
}
function clearGroupSelects(a) {
  a.find(".select-selected").remove();
  a.find(".select-items").remove();
}
function openSelect(a) {
  a = a.find("div.select-selected")[0];
  a.nextSibling.classList.toggle("select-hide");
  a.classList.toggle("select-arrow-active");
}
function setupGroupSelect(a, b, e, k) {
  function l(w) {
    var y,
      x = [];
    var C = document.getElementsByClassName("select-items");
    var D = document.getElementsByClassName("select-selected");
    for (y = 0; y < D.length; y++)
      w == D[y] ? x.push(y) : D[y].classList.remove("select-arrow-active");
    for (y = 0; y < C.length; y++)
      x.indexOf(y) && C[y].classList.add("select-hide");
  }
  var n;
  var q = document.getElementsByClassName("group-select");
  for (n = 0; n < q.length; n++)
    if (void 0 === e || $(q[n]).attr("id") === e) {
      var v = q[n].getElementsByTagName("select")[0];
      var f = document.createElement("DIV");
      f.setAttribute("class", "select-selected");
      var h = v.options[v.selectedIndex];
      void 0 !== h && (f.innerHTML = h.innerHTML);
      q[n].appendChild(f);
      var c = document.createElement("DIV");
      c.setAttribute("class", "select-items select-hide");
      h = 0;
      for (a && (h = 1); h < v.length; h++) {
        var p = document.createElement("DIV");
        p.innerHTML = v.options[h].innerHTML;
        p.setAttribute("data-group", v.options[h].value);
        v.options[h].disabled
          ? ($(p).addClass("disabled"),
            p.addEventListener("click", function (w) {
              w.stopPropagation();
            }))
          : p.addEventListener("click", function (w) {
              groupSelectSelected($(this));
              this.parentNode.previousSibling.click();
              b();
            });
        c.appendChild(p);
      }
      q[n].appendChild(c);
      f.addEventListener("click", function (w) {
        w.stopPropagation();
        l(this);
        this.nextSibling.classList.toggle("select-hide");
        this.classList.toggle("select-arrow-active");
        this.classList.contains("select-arrow-active") && k && k();
      });
    }
  document.addEventListener("click", l);
}
function repeat(a, b) {
  for (var e = "", k = 1; k <= b; k++) e += a;
  return e;
}
window.a2a_config = {
  onclick: 1,
  callbacks: [
    {
      ready: () => {
        $(".a2a_dd span:first-child").click();
      },
      share: (a) => {
        symbolab_log(
          "Registration",
          "ClickedFeature",
          a2a_config.logAction + "\tShare\t" + a.service
        );
        amplitude.track("Clicked", {
          type: "Share",
          service: a.service,
          url: a.url,
        });
        return { url: a2a_config.linkurl, title: a2a_config.linkname };
      },
    },
  ],
};
let shareClickEventReady = !1;
function shareClick({ url: a, title: b, logAction: e }) {
  a2a_config.linkurl = a;
  a2a_config.linkname = b;
  a2a_config.logAction = e;
  "undefined" == typeof a2a
    ? ((a = document.createElement("script")),
      (a.type = "text/javascript"),
      (a.src = "https://static.addtoany.com/menu/page.js"),
      document.getElementsByTagName("head")[0].appendChild(a))
    : (shareClickEventReady &&
        (symbolab_log(
          "Registration",
          "SeenFeature",
          a2a_config.logAction + "\tShare"
        ),
        a || (a = window.location.href),
        amplitude.track("Seen", { type: "Share", url: a })),
      (shareClickEventReady = !0));
}
function escapeHtml(a) {
  return a
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}
function resumeSubscription(a, b) {
  symbolab_log("Registration", "ShowResume", a);
  alertify
    .okBtn(i18n("js.Resume"))
    .cancelBtn(i18n("js.cancel"))
    .confirm(
      i18n("js.resume_question", i18n(sy_pSub)),
      function () {
        $(".loading-animation").show();
        $.ajax({
          type: "POST",
          url: "/api/payments/resumeSubscription",
          data: { reason: "user request" },
          beforeSend: authorizeAjaxWithSyToken,
          success: function (e) {
            symbolab_log("Registration", "Resumed", a);
            alertify.okBtn("OK").alert(
              e.success
                ? i18n("js.Subscription Resumed")
                : i18n("js.Operation Failed"),
              function () {
                void 0 !== b && (location += b);
                location.reload();
              },
              function () {
                void 0 !== b && (location += b);
                location.reload();
              }
            );
          },
        });
      },
      function () {
        $("#paypalActivate").removeClass("nl-disabled");
        $("#paypalUnsubscribeNew").removeClass("nl-disabled");
      }
    );
}
function setDefaultSubscription() {
  setSelectedSubscriptionOption($(".subscribeOption[id=annually]"));
}
function getParams(a) {
  var b = {},
    e = a.indexOf("#");
  if (0 <= e) {
    a = a.substring(e + 1);
    for (var k = /([^&=]+)=?([^&]*)/g; (e = k.exec(a)); )
      b[decodeURIComponent(e[1])] = decodeURIComponent(e[2]);
  }
  return b;
}
function clickedSendCHLinkButton(a) {
  const b = $(a);
  b.addClass("nl-disabled");
  sendCourseHeroLink()
    .done(function (e) {
      b.removeClass("nl-disabled");
      e.success &&
        ($("#nl-successfullySignedPopup").hide(), alertify.alert(e.success));
    })
    .fail(function (e) {
      b.removeClass("nl-disabled");
      alertify.alert(e);
    });
}
function loadCourseHeroLink(a, b) {
  if (isUserLoggedIn()) {
    const e = window.location.href.replace(/\?.*/, "");
    subscribed
      ? "1" === a
        ? (amplitude.track("CHBundle", { state: "UserLinked" }),
          isSolverFeatureRequestedCancelUpgradeMessage() ||
            (symbolab_log("Registration", "CHBundle-UserLinked"),
            $("#nl-successfullySignedPopup").show(),
            $("#popup-avatar").hide(),
            $("#successfullySignedUp").text(i18n("Subscription active")),
            $("#UpgradeToProButton")
              .removeClass("hide-important")
              .text(i18n("Manage subscription"))
              .off("click")
              .on("click", function () {
                window.location = "/user#subscription";
              })))
        : (amplitude.track("CHBundle", { state: "UserSubscribed" }),
          symbolab_log("Registration", "CHBundle-UserSubscribed"),
          isSolverFeatureRequestedCancelUpgradeMessage() ||
            ($("#nl-successfullySignedPopup").show(),
            $("#popup-avatar").hide(),
            $("#successfullySignedUp").text(
              i18n("You are currently subscribed")
            ),
            $("#UpgradeToProButton")
              .removeClass("hide-important")
              .text(i18n("Manage subscription"))
              .off("click")
              .on("click", function () {
                window.location = "/user#subscription";
              })))
      : "1" === b
      ? (amplitude.track("CHBundle", { state: "UserNotVerified" }),
        symbolab_log("Registration", "CHBundle-UserNotVerified"),
        $("#popup-avatar").hide(),
        $("#nl-successfullySignedPopup").show(),
        $("#successfullySignedUp").text(
          i18n("Your subscription is ready to activate")
        ),
        $("#UpgradeToProButton")
          .removeClass("hide-important")
          .text(i18n("Activate CourseHero Bundle"))
          .off("click")
          .on("click", function () {
            clickedSendCHLinkButton(this);
          }))
      : (amplitude.track("CHBundle", { state: "UserNotFound" }),
        symbolab_log("Registration", "CHBundle-UserNotFound"),
        $("#success_image").hide(),
        $("#nl-successfullySignedPopup").show(),
        $("#successfullySignedUp").text(
          i18n("Your bundle subscription is registered under a different email")
        ),
        $("#UpgradeToProButton")
          .removeClass("hide-important")
          .text(i18n("Sign in with Bundle Email"))
          .off("click")
          .on("click", function () {
            logUserOutWithoutRedirect().done(function (k) {
              window.location =
                "/registration#flow=signup&reason=CHLink&page=signup&url=" +
                encodeURIComponent(window.location.href);
            });
          }));
    window.history.replaceState({}, document.title, e);
  } else
    symbolab_log("Registration", "CHBundle-NotLoggedIn"),
      amplitude
        .track("CHBundle", { state: "NotLoggedIn" })
        .promise.then(function () {
          window.location =
            "/registration#flow=signup&reason=CHLink&page=signup&url=" +
            encodeURIComponent(window.location.href);
        });
  $("#cancelPopup").click(function () {
    $("#nl-successfullySignedPopup").hide();
  });
  $("#StartExploringButton").click(function () {
    $("#nl-successfullySignedPopup").hide();
  });
}
function loadUpgrade(a) {
  $("#moreText").text("");
  var b = getParams(a);
  a = getPlanText(b.planInfo);
  0 < a.length &&
    ($("#moreText").css("font-size", "17px").html(a),
    $("#popup-avatar").css("margin-top", "30px"),
    $("#popupButtons").css("margin-top", "50px"));
  b.page &&
    ("1" === b.link &&
      $("#UpgradeToProButton").text(i18n("Activate CourseHero Bundle")),
    "upgraded" === b.page
      ? (isSolverFeatureRequestedCancelUpgradeMessage() ||
          $("#nl-successfullySignedPopup").show(),
        symbolab_log(
          "Registration",
          "SubscribeCompleted-" + b.vendor + "_" + b.planInfo,
          b.reason
        ),
        amp_log(
          "SubscribeCompleted",
          "vendor=" + b.vendor + "\tplanInfo=" + b.planInfo,
          !0
        ),
        isSolverFeatureRequestedCancelUpgradeMessage() ||
          ($("#popup-avatar").hide(),
          "1" === b.link
            ? ($("#moreText").text(i18n("Subscription active")),
              $("#successfullySignedUp").text(i18n("Thank you for signing in")),
              $("#UpgradeToProButton").text(i18n("Activate CourseHero Bundle")))
            : $("#successfullySignedUp").text(
                i18n("Thank you for subscribing")
              )))
      : "signedIn" === b.page && "1" === b.link
      ? ("1" === b.upgradeAttempt
          ? $("#successfullySignedUp").text(
              i18n("Your subscription bundle awaits")
            )
          : $("#successfullySignedUp").text(i18n("Thank you for signing in")),
        $("#nl-successfullySignedPopup").show(),
        $("#success_image").hide())
      : "signedUp" === b.page
      ? ($("#successfullySignedUp").text(i18n("Thank you for signing up")),
        $("#nl-successfullySignedPopup").show(),
        $("#popup-avatar").hide())
      : "ongoingSubscription" !== b.page ||
        isSolverFeatureRequestedCancelUpgradeMessage() ||
        ($("#successfullySignedUp").text(
          "Thank you for your ongoing subscription"
        ),
        $("#nl-successfullySignedPopup").show(),
        $("#popup-avatar").hide()),
    $("body")
      .off("click", "#UpgradeToProButton:not(.nl-disabled)")
      .on("click", "#UpgradeToProButton:not(.nl-disabled)", function () {
        "1" === b.link ? clickedSendCHLinkButton(this) : showSignUp("Solver");
      }));
  $("#cancelPopup").click(function () {
    $("#nl-successfullySignedPopup").hide();
  });
  $("#StartExploringButton").click(function () {
    $("#nl-successfullySignedPopup").hide();
  });
  window.history.replaceState(
    {},
    document.title,
    window.location.pathname + window.location.search
  );
}
function getPlanText(a) {
  var b = "";
  "monthly" === a
    ? (b = i18n("Subscription renews monthly"))
    : "weekly" === a
    ? (b = i18n("Subscription renews weekly"))
    : "annually" === a
    ? (b = i18n("Subscription renews annually"))
    : "semi" === a && (b = i18n("Subscription renews semi-annually"));
  return b;
}
function isSolverFeatureRequestedCancelUpgradeMessage() {
  const a = new URLSearchParams(window.location.search);
  return 0 <= ["verify", "challenge"].indexOf(a.get("feature"));
}
function checkIPad() {
  const a = new URL(window.location);
  if ("1" !== decodeURIComponent(a.searchParams.get("mobileWebRedirect"))) {
    var b =
        navigator.userAgent &&
        -1 < navigator.userAgent.toLowerCase().indexOf("macintosh") &&
        navigator.maxTouchPoints &&
        2 < navigator.maxTouchPoints,
      e = readCookie("sy.probablyIPad");
    (e && "1" === e) ||
      !b ||
      (createCookie("sy.probablyIPad", "1"),
      a.searchParams.set("mobileWebRedirect", "1"),
      (window.location = a.href));
  }
}
$(document).ready(function () {
  checkIPad();
  var a = new URL(window.location);
  a.searchParams.has("coursehero")
    ? loadCourseHeroLink(
        a.searchParams.get("linked"),
        a.searchParams.get("linkavailable")
      )
    : ((a = window.location.hash),
      (a.includes("page=upgraded") ||
        a.includes("page=signedIn") ||
        a.includes("page=signedUp") ||
        a.includes("page=coursehero") ||
        a.includes("page=ongoingSubscription")) &&
        loadUpgrade(a));
  $("#signIn").click(function (b) {
    b.preventDefault();
    showSignUp("TopMenu");
  });
  $("#mobile_logout").click(function (b) {
    b.preventDefault();
    window.location = "/logout";
  });
  "undefined" !== typeof amplitude &&
    ((a = getLocalStorage().getItem("linkOrigin")),
    getLocalStorage().removeItem("linkOrigin"),
    (a = amplitude.track("Enter", {
      data: window.location.pathname,
      linkOrigin: a,
      referrer: document.referrer,
    })) &&
      a.promise &&
      a.promise.then(function (b) {
        allowedCookieGroups("C0002") &&
          (createCookie("sy.amp.session", amplitude.getSessionId()),
          createCookie("sy.amp.device", amplitude.getDeviceId()));
      }));
});
function allowedCookieGroups(a) {
  var b = readCookie("OptanonConsent");
  return b
    ? ((b = b.split("&").map(function (e) {
        return e.split("=");
      })),
      (b = Object.fromEntries(b)
        .groups.split(",")
        .map(function (e) {
          e = e.split(":");
          return [e[0], "1" === e[1]];
        })),
      !0 === Object.fromEntries(b)[a])
    : !0;
}
function OptanonWrapper() {
  var a = OneTrust.GetDomainData();
  a &&
    a.ConsentModel &&
    "opt-out" === a.ConsentModel.Name &&
    $(".cookie-settings-link").hide();
  OneTrust.OnConsentChanged(function (b) {
    (b = OneTrust.GetDomainData()) &&
      b.ConsentModel &&
      "opt-in" === b.ConsentModel.Name &&
      window.location.reload();
  });
}
function openCookiePreferencesIfRelevant() {
  var a = OneTrust.GetDomainData();
  a &&
    a.ConsentModel &&
    "opt-in" === a.ConsentModel.Name &&
    OneTrust.ToggleInfoDisplay();
}
function handleGoogleOneTapNotification(a) {
  const b = "/" === window.location.pathname ? "HomePage" : "Solver";
  a.isDisplayMoment() &&
    a.isDisplayed() &&
    symbolab_log("Registration", "SeenFeature", "OneTap\t" + b);
  a.isSkippedMoment() &&
    symbolab_log("Registration", "ClickedFeature", "OneTap\t" + b + "\tClose");
}
function handleGoogleOneTap(a) {
  const b = "/" === window.location.pathname ? "HomePage" : "Solver";
  symbolab_log("Registration", "ClickedFeature", "OneTap\t" + b + "\tLogin");
  registrationReason = "OneTap\t" + b;
  handleGoogleToken(a);
}
function handleGoogleToken(a) {
  var b = requestUrl,
    e = googleIsSignUp
      ? !1
      : $(".featherlight-content #rememberMe").prop("checked"),
    k = function (l) {
      window.location.href === b
        ? void 0 !== l &&
          ((b = 0 > b.indexOf("#") ? b + "#" : b + "&"),
          (window.location = b + l))
        : (void 0 !== l &&
            ((b = 0 > b.indexOf("#") ? b + "#" : b + "&"), (b += l)),
          (window.location = b));
      window.location.reload();
    };
  $.ajax({
    type: "POST",
    url: "/googleMobileAuth",
    beforeSend: authorizeAjaxWithSyToken,
    data: {
      idRequestToken: a.credential,
      registrationReason,
      remember: e,
      redirect: requestUrl,
    },
  }).done(function (l) {
    if (l.success || l.jwt) {
      let n = void 0;
      l.newlyLinkedToCourseHero && (n = "firstTimeLink=1");
      prepareGeometryForReload().then(
        function (q) {
          b += encodeURIComponent("#" + q);
          k(n);
        },
        function () {
          k(n);
        }
      );
    } else (l = $("<p />", { text: l.alert, class: "alert alert-error" })), $("#loginOptionsPanel .alert.alert-error").remove(), $("#loginOptionsPanel").append(l);
  });
}
async function securedAjax(a) {
  return ajax(a, !0);
}
async function ajax(a, b) {
  return new Promise((e, k) => {
    a.type = a.type ?? "GET";
    b && (a.beforeSend = authorizeAjaxWithSyToken);
    a.success = function (l) {
      e(l);
    };
    a.error = function (l) {
      k(l);
    };
    $.ajax(a);
  });
}
function searchInitiatedLog(a, b) {
  b ||= new URLSearchParams(window.location.search).get("or") ?? "";
  symbolab_log("General", "SearchInitiated", b, a);
}
const SymbolabMobile = function (
  a,
  b,
  e,
  k,
  l,
  n,
  q,
  v,
  f,
  h,
  c,
  p,
  w,
  y,
  x,
  C
) {
  this.debugMode = C;
  this.sy_var = a;
  this.SYMBOLAB = new Symbolab("fe", b, e);
  this.SYMBOLAB.params.or = k;
  this.SYSTEPS = new SymbolabSteps(e, l);
  this.SOLUTIONS = void 0;
  this.ready = !1;
  this.appLangs = q;
  this.subject = v;
  this.page = f;
  this.input = h;
  this.inputBack = c;
  this.isExternal = p;
  this.rawSolution = w;
  this.storeLink = y;
  this.OS = n;
  this.baseReason = b ? "MobileWeb\tQuery\t" : "MobileWeb\tCalculator\t";
  this.camera = new SyCamera(this.baseReason, "Mobile Web Index", f, C);
  this.body = $("body");
  this.init();
};
SymbolabMobile.prototype = {
  init: function () {
    const a = this;
    symbolab_log("Registration", "SeenFeature", a.baseReason + "StoreIcon");
    $(".lazy-loading").each(function () {
      const e = $(this).data("src");
      $(this).attr("src", e);
    });
    a.openLinks();
    $(".store-logo").on("click", function () {
      $.when(
        symbolab_log("Registration", "OpenStore", a.baseReason + "StoreIcon")
      ).always(function () {
        a.goToStore();
      });
    });
    a.SOLUTIONS = new Solutions(
      a.subject,
      a.page,
      a.query,
      a.input,
      a.inputBack,
      a.appLangs,
      a.curLang,
      a.subscribed
    );
    a.SOLUTIONS.init();
    if (!a.query || "" === a.query) {
      $("#steps-loading").hide();
      var b = $("#hide-container-for-page");
      b.removeClass("hide-important");
      b.find("span.mathquill-rendered-math").mathquill("redraw");
    }
    $("#show-steps-button2")
      .off("click")
      .on("click", function (e) {
        e.preventDefault();
        $("#mathquill_solution_container").addClass("hide-important");
        $("#dym-solutions-parent").removeClass("hide-important");
        $("#numberLine-plot-parent").removeClass("hide-important");
        e = $("#multipleSolutions, #Plot_dynaimc");
        mathquillifyVisible(e);
        a.SYSTEPS.makeScrollable(e);
      });
    $("#mathquill_query_container")
      .removeClass("hide-important")
      .mathquill("redraw");
    $("#mathquill_solution_container")
      .removeClass("hide-important")
      .mathquill("redraw");
    if (a.isExternal) {
      b = a.rawSolution;
      const e = $("#katexSolution");
      e.append("###" + b + "###");
      renderMathInElement(e[0], {
        delimiters: [{ left: "###", right: "###", display: !1 }],
      });
    }
    $("#scroll-squiggle").click(function (e) {
      $("html, body").animate(
        { scrollTop: $("#math_help_tailored_headline").offset().top },
        800
      );
    });
    $("#popular-calculators-links a").click(function (e) {
      e.preventDefault();
      const k = $(this).attr("href");
      $.when(symbolab_log("General", "Popular Calculator", k)).always(
        function () {
          window.location = k;
        }
      );
    });
    $("#Examples .new_solution_box_title").click(function (e) {
      $("html, body").animate({ scrollTop: $("#Examples").offset().top }, 800);
    });
    $("#related .new_solution_box_title").click(function (e) {
      $("html, body").animate({ scrollTop: $("#related").offset().top }, 800);
    });
  },
  goToStore: function () {
    window.location = this.storeLink;
  },
  shouldUpgrade: function () {
    return !1;
  },
  debugLog: function (a) {
    this.debugMode && console.log(a);
  },
  showMobileAppDownload: function (a, b) {
    const e = this;
    symbolab_log("Registration", "ClickedFeature", a);
    const k = $("#store-prompt");
    k.find("#close-btn")
      .off("click")
      .on("click", function (l) {
        l.preventDefault();
        k.addClass("hide-important");
      });
    k.find("span").html(b);
    k.find("#store-logo-link")
      .off("click")
      .on("click", function (l) {
        l.preventDefault();
        k.addClass("hide-important");
        $.when(symbolab_log("Registration", "OpenStore", a)).always(
          function () {
            e.goToStore();
          }
        );
      });
    k.removeClass("hide-important");
  },
  mobileMenu: function (a, b) {
    b && b.preventDefault();
    let e = a.attr("href");
    e &&
      $.when(symbolab_log("General", "MobileMenu", e)).always(function () {
        window.location = e;
      });
  },
  footerLink: function (a, b) {
    b && b.preventDefault();
    let e = a.attr("href");
    e &&
      $.when(symbolab_log("General", "MobileFooter", e)).always(function () {
        window.location = e;
      });
  },
  openLinks: function () {
    const a = this;
    $("#math_help_tailored_word-problems")
      .off("click")
      .on("click", function (b) {
        a.mobileMenu($(this), b);
      });
    $("#math_help_tailored_calculus")
      .off("click")
      .on("click", function (b) {
        a.mobileMenu($(this), b);
      });
    $("#math_help_tailored_trigonometry")
      .off("click")
      .on("click", function (b) {
        a.mobileMenu($(this), b);
      });
    $("#math_help_tailored_algebra")
      .off("click")
      .on("click", function (b) {
        a.mobileMenu($(this), b);
      });
    $("#math_help_tailored_chemistry")
      .off("click")
      .on("click", function (b) {
        a.mobileMenu($(this), b);
      });
    $("#math_help_tailored_graphing")
      .off("click")
      .on("click", function (b) {
        a.mobileMenu($(this), b);
      });
    $("#symbolab-logo_img")
      .off("click")
      .on("click", function (b) {
        a.mobileMenu($(this), b);
      });
    $("#Popular_Problems")
      .off("click")
      .on("click", function (b) {
        a.footerLink($(this), b);
      });
    $("#Graphing_Calculator")
      .off("click")
      .on("click", function (b) {
        a.footerLink($(this), b);
      });
    $("#Calculator_Title")
      .off("click")
      .on("click", function (b) {
        a.footerLink($(this), b);
      });
    $("#Cheat_Sheets")
      .off("click")
      .on("click", function (b) {
        a.footerLink($(this), b);
      });
    $("#Privacy")
      .off("click")
      .on("click", function (b) {
        a.footerLink($(this), b);
      });
    $("#Terms")
      .off("click")
      .on("click", function (b) {
        a.footerLink($(this), b);
      });
    $("#Copyright")
      .off("click")
      .on("click", function (b) {
        a.footerLink($(this), b);
      });
    $("#Cookies")
      .off("click")
      .on("click", function (b) {
        a.footerLink($(this), b);
      });
  },
};
var Symbolab = function (a, b, e) {
  this.params = {};
  this.params.userId = a;
  this.params.query = b;
  this.params.language = e;
  this.init();
};
Symbolab.prototype = {
  init: function () {
    parseQueryParameters(this.params);
    $(".topnav ul li a").click(function (a) {});
  },
  queryString: function (a) {
    void 0 == a && (a = {});
    a = $.extend({}, this.params, a);
    var b = [],
      e;
    for (e in a) {
      var k = a[e];
      "" != k && b.push(e + "=" + encodeURIComponent(k));
    }
    return b.join("&");
  },
  params: {},
  results: {},
  forwardSearch: function (a, b, e) {
    if ("" !== a) {
      var k = "/solver/";
      if ("undefined" != typeof SOLUTIONS && "" !== SOLUTIONS.page)
        k += SOLUTIONS.page + "/";
      else {
        let l = window.location.pathname.split("/"),
          n = "step-by-step";
        2 < l.length && "solver" === l[1] && "" !== l[2] && (n = l[2]);
        k += n + "/";
      }
      k += encodeURIComponent(a);
      b && (k += "?or=" + b);
      "3" !== sy_var || e
        ? (window.location = k)
        : symbolab_log("Registration", "ClickedFeature", "ClickSuggest");
    }
  },
};
Symbolab.prototype.updateSolutionsUrl = function () {
  $("#solutionsTopNav a").attr(
    "href",
    "/solver/step-by-step/" + encodeURIComponent(this.params.query)
  );
};
Symbolab.prototype.getTextLenScore = function (a) {
  return (parseInt(a.textlen) + parseInt(a.eqlen)) / 1e5;
};
Symbolab.prototype.logRedirect = function (a, b, e, k) {
  a = {
    userId: this.params.userId,
    language: this.params.language,
    type: a,
    info1: b,
    info2: e,
    redirect: k,
  };
  $("body").append(
    $("<form/>", {
      id: "redirectPostForm",
      method: "POST",
      action: "/logRedirect",
    })
  );
  b = $("#redirectPostForm");
  for (var l in a)
    b.append($("<input/>", { type: "hidden", name: l, value: a[l] }));
  b.submit();
};
Symbolab.prototype.showPopover = function (a, b, e) {
  var k = this;
  a.popover({
    title: b,
    content: e,
    placement: "top",
    delay: { show: 500, hide: 5e3 },
  }).popover("show");
  setInterval(function () {
    k.inputBox().popover("disable");
    k.inputBox().popover("hide");
  }, 4e3);
};
Symbolab.prototype.lastInsertedIsEquals = function () {
  var a = this.inputValue("latex");
  return a.indexOf("=") == a.length - 1 ? 1 : 0;
};
Symbolab.prototype.updateCalculation = function () {
  var a = this,
    b = a.inputValue("latex");
  a.calcmode || (a.calcmode = "rad");
  0 <= b.indexOf("=") && (b = b.split("=")[0]);
  SYPAD.inputBox().mathquill("latex", b + " = ");
  $.ajax({
    type: "GET",
    url: Symbolab.paths.calculate,
    data: { query: b, radDeg: a.calcmode },
    error: function (e) {
      a.showPopover(
        a.inputBox(),
        "Calculation Error",
        "We ran into a problem calculating that. Try searching instead."
      );
    },
    success: function (e) {
      void 0 != e.response && "NA" != e.response
        ? a.appendInput(e.response)
        : a.showPopover(
            a.inputBox(),
            "Calculation Error",
            "We ran into a problem calculating that. Try searching instead."
          );
    },
  });
};
Symbolab.prototype.executeSearch = function () {
  var a = this.params.query;
  if ("" != a) {
    a = a.replace(/\\(text|mbox)\s*{(.+?)}/g, "$2 ");
    a = a.replace(/\\:/g, " ");
    a = a.replace(/\\left\\s*\(/g, "(");
    var b = (a = a.replace(/\\right\\s*\)/g, ")"));
    this.params.query = a;
    "" == a
      ? (this.promptError(
          "Cannot understand this query, please try a different query."
        ),
        this.inputBox().mathquill("latex", prepareQueryForMathQuill(b)))
      : 0 == this.currentPage() || 100 < this.currentPage()
      ? this.promptError("Allowed page numbers are 1-100.")
      : (this.inputBox().mathquill("latex", prepareQueryForMathQuill(a)),
        $(".print-only .search-query").mathquill("latex", a),
        this.updateSolutionsUrl(),
        this.updateResults(),
        this.isScholar || this.updateStepsPlot());
  }
};
Symbolab.prototype.promptError = function (a) {
  this.clearResults();
  document.title = "Error - Symbolab Results";
  $("#ShareButtonsSection").prepend("<span class='errorMsg'>" + a + "</span>");
  $("#Refinements .scholar-refinements, #Refinements .web-refinements").hide();
  $("#Codepad .actions").hide();
};
Symbolab.convert2html = function (a) {
  a = a.replace(/</g, "&lt;");
  return (a = a.replace(/>/g, "&gt;"));
};
function url_domain(a) {
  var b = document.createElement("a");
  b.href = a;
  return b.hostname;
}
function htmlDecode(a) {
  if ("" == a) return a;
  var b = document.createElement("div");
  b.innerHTML = a;
  return b.childNodes[0].nodeValue;
}
var SymbolabSteps = function (a, b, e, k) {
  this.requestLang = a;
  this.stepsRes = null;
  this.stepsArray = [];
  this.stepsHighestBox = [];
  this.stepsArrayIndex = 0;
  this.referer = k;
  this.subscribed = "true" === b;
  this.NotebookSourceSolutions = e ? e : "Solutions";
  this.showHideMap = {};
  this.showHideMap.hideSteps = i18n("hide steps");
  this.showHideMap.showSteps = i18n("show steps");
  this.showHideMap.stepByStep = i18n("Step by Step");
  this.showHideMap.showAllSteps = i18n("js.Expand Steps");
  this.showStepsText = i18n("show steps");
  this.init();
};
SymbolabSteps.prototype = {
  init: function () {
    var a = this,
      b = $("body");
    b.on("click", ".newSelect", function (e) {
      $(this).toggleClass("closed");
      $(this).hasClass("closed") ||
        ($(this).hasClass("stepsSelect")
          ? symbolab_log("Registration", "ClickedFeature", "Solver\tDropdown")
          : symbolab_log(
              "Registration",
              "ClickedFeature",
              "Solver\tSolvingOptions"
            ));
      $(this).children(".slItems").toggle();
      e.preventDefault();
      return !1;
    });
    b.on("click", ".solution_title_container_highest", function (e) {
      e.preventDefault();
      a.isGeometryPage() ||
        ((e = $(this)),
        0 < e.find(".lockedSteps-div").size()
          ? showSignUpSubscribe(
              "Solver\tTopLockedStep\t" +
                a.stepsRes.topic +
                "\t" +
                a.stepsRes.subTopic
            )
          : a.openHideSolutionTitleContainerHighest(e));
    });
    b.on("click", "#multipleOptions .slItem", function (e) {
      e = $(this).attr("value");
      $(this).parent().parent().children(".value").attr("value") !== e &&
        (symbolab_log(
          "Registration",
          "ClickedFeature",
          "Solver\tSolvingOptions\tChange",
          a.stepsRes.query
        ),
        (SYMBOLAB.params.query = e),
        a.updateStepsPlot(!0));
    });
    b.on("click", ".stepsSelect .slItem", function (e) {
      var k = $(this).attr("value"),
        l = $(this).parent().parent();
      l.children(".value").attr("value") !== k &&
        (a.inStepByStep
          ? ((a.inStepByStep = !1),
            a.writeSteps(a.stepsRes),
            a.doDynamicPlot(!0),
            "showSteps" === k
              ? (a.openHideStepsNew($(".show-hide-steps-div").parent(), !0),
                a.showVerify(),
                symbolab_log(
                  "Registration",
                  "ClickedFeature",
                  "Solver\tDropdown\tShowSteps"
                ))
              : "showAllSteps" === k
              ? (a.doShowAllSteps(),
                symbolab_log(
                  "Registration",
                  "ClickedFeature",
                  "Solver\tDropdown\tShowAllSteps"
                ))
              : symbolab_log(
                  "Registration",
                  "ClickedFeature",
                  "Solver\tDropdown\tHideSteps"
                ))
          : ("showSteps" === k
              ? (a.openHideStepsNew(l.parent().parent(), !0),
                symbolab_log(
                  "Registration",
                  "ClickedFeature",
                  "Solver\tDropdown\tShowSteps"
                ))
              : "showAllSteps" === k
              ? ((k = "Solver\tDropdown\tShowAllSteps"),
                a.subscribed
                  ? (symbolab_log(
                      "Registration",
                      "ClickedFeature",
                      k,
                      a.stepsRes.query
                    ),
                    a.doShowAllSteps())
                  : showSignUpSubscribe(k))
              : "hideSteps" === k
              ? (symbolab_log(
                  "Registration",
                  "ClickedFeature",
                  "Solver\tDropdown\tHideSteps"
                ),
                a.openHideStepsNew(l.parent().parent(), !1))
              : ((k = "Solver\tDropdown\tStepByStep"),
                a.subscribed
                  ? (symbolab_log(
                      "Registration",
                      "ClickedFeature",
                      k,
                      a.stepsRes.query
                    ),
                    a.makeStepByStepSolution())
                  : showSignUpSubscribe(k)),
            e.preventDefault()));
    });
  },
  openHideSolutionTitleContainerHighest: function (a) {
    !a.attr("onclick") &&
      this.stepsRes &&
      this.openHideStepsNew(a, !1 === a.next().is(":visible"));
  },
  doShowAllSteps: function () {
    _.dontFireOpenInnerEvent = !0;
    0 === $(".solution_step_list:visible").size() &&
      _.openHideStepsNew($(".show-hide-steps-div").parent(), !0);
    for (var a = !0; a; )
      (a = !1),
        $(".showStepsButton").each(function () {
          SYSTEPS.showHideRule($(this).parent().parent());
          a = !0;
        });
    $(".stepsSelect .value").attr("value", "showAllSteps");
    $(".stepsSelect .value").text(_.showHideMap.showAllSteps);
    _.dontFireOpenInnerEvent = !1;
  },
  setStepsFromMobileResponse: function (a) {
    this.stepsRes = a;
    createSteps(a);
    this.doDynamicPlot(!1);
    changePlotToImage();
    removeShowStepsWhereApplicable(a);
    this.setSavedNote($(".nl-questionFavorite"), "nl-questionFavoriteSaved");
  },
  getStepsMobile: function (a, b) {
    var e = this;
    b = {
      type: "GET",
      url: "/pub_api/steps",
      beforeSend: authorizeAjaxWithSyPubToken,
      data: { userId: "fe", query, license, origin: b },
      error: function (k) {
        showConnectionError();
        hideOverlay();
        pageExpired(k, "api_steps");
      },
      success: function (k) {
        k
          ? e.setStepsFromMobileResponse(k)
          : (showConnectionError(),
            e.setSavedNote(
              $(".nl-questionFavorite"),
              "nl-questionFavoriteSaved"
            ));
        hideOverlay();
      },
    };
    a ? ((b.async = !0), (b.timeout = 3e4)) : (b.async = !1);
    $.ajax(b);
  },
  updateStepsPlot: function (a, b, e) {
    var k = this;
    $(".pdfIcon, .printIcon").addClass("nl-disabled");
    const l = function (n) {
      function q() {
        $("#steps-loading").hide();
        var v = $("#hide-container-for-page");
        0 < v.size() &&
          (v.removeClass("hide-important"),
          v.find("span.mathquill-rendered-math").mathquill("redraw"));
        isMobileRender() && $(".googleAdsenseMiddle #ad-hide").hide();
        k.writeSteps(k.stepsRes);
        k.writeChAnswer(k.stepsRes);
        if (k.isSolutionPage())
          1 === $(".show-hide-steps-div").length &&
            (k.inStepByStep
              ? k.makeStepByStepSolution()
              : null == getLocalStorage().getItem("settings.steps") ||
                "showSteps" === getLocalStorage().getItem("settings.steps")
              ? ($(".show-hide-steps-div select").val("showSteps"),
                k.openHideStepsNew($(".show-hide-steps-div").parent(), !0),
                k.showVerify())
              : "stepByStep" === getLocalStorage().getItem("settings.steps") &&
                k.makeStepByStepSolution()),
            0 < $(".structuredWhat:visible").size() &&
              $("#multipleSolutions")
                .get(0)
                .scrollIntoView({
                  behavior: "smooth",
                  block: "center",
                  inline: "end",
                }),
            a || k.inStepByStep || k.doDynamicPlot(!0),
            k.addNotesDiv(),
            k.doSimilarProblem(),
            refreshLeftNavbarHeight();
        else if (isMobileRender() || isPopularSearch())
          (v = $(
            ".solution_outside_box > .solution_title_container_highest > .show-hide-steps-div .show-hide-steps"
          )),
            1 === v.length &&
              ((v = v.parent().parent()),
              k.openHiddenSteps(v, !1),
              k.doDynamicPlot(!0));
        k.setSavedNote($(".nl-notesFav"), "nl-notesFavSaved");
        $(".pdfIcon, .printIcon").removeClass("nl-disabled");
      }
      k.stepsRes = n;
      "External Solutions" === k.stepsRes.subject
        ? loadKatexScripts().pipe(q)
        : q();
    };
    e
      ? l(e)
      : $.ajax({
          type: "GET",
          url: "/pub_api/steps",
          beforeSend: authorizeAjaxWithSyPubToken,
          data: {
            subscribed: k.subscribed,
            origin: SYMBOLAB.params.or,
            language: k.requestLang,
            query: SYMBOLAB.params.query,
            choices: SYMBOLAB.params.choices,
            referer: k.referer,
            plotRequest: "PlotOptional",
            page: b,
          },
          error: function (n) {
            pageExpired(n, "api_steps");
          },
          success: l,
        });
  },
  writeChAnswer: function (a) {},
  getLastSolutionLine: function (a) {
    a = a.replaceAll("<p> </p>", "");
    0 <= a.indexOf("<p>") && (a = a.substr(a.lastIndexOf("<p>")));
    0 <= a.indexOf("\\begin{aligned}") &&
      a.match("&\\s*=") &&
      (a = a.replace(/\\begin\{aligned\}(.*)\\end\{aligned\}/, function (b, e) {
        return e.split("\\\\").pop().replaceAll("&", "");
      }));
    return a;
  },
  processSolutionTitleText: function (a) {
    var b = RegExp("<img.*?>", "g");
    return a.replaceAll(" ", " \\space ").replaceAll(b, "");
  },
  createSolutionStepBook: function (a, b) {
    let e = $('<div class="solution_step_book"></div>');
    e.append(a.replaceAll(b, "###"));
    renderMathInElement(e[0], {
      delimiters: [{ left: "###", right: "###", display: !1 }],
    });
    return e;
  },
  parseExternalSolution: function (a) {
    let b = {};
    b.query = a.externalSolution.renamedQuery.replaceAll(
      RegExp(
        "\\\\(sech|csch|arcsech?|arccsch?|arcsinh|arccosh|arctanh|arccoth)",
        "g"
      ),
      "\\mathrm{$1}"
    );
    b.solution = "";
    b.steps = [];
    a = JSON.parse(a.externalSolution.solution);
    if (void 0 !== a.answers)
      for (var e in a.answers) {
        var k = a.answers[e];
        if (void 0 !== k.widgets)
          for (var l in k.widgets) {
            var n = k.widgets[l];
            void 0 !== n.text && (b.solution += n.text);
          }
        if (void 0 !== k.explanations)
          for (var q in k.explanations) {
            var v = k.explanations[q];
            let c = "";
            if (void 0 !== v.explanations)
              for (var f in v.explanations) {
                var h = v.explanations[f];
                if (void 0 !== h.widgets)
                  for (l in h.widgets) (n = h.widgets[l]), (c += n.text);
              }
            b.steps.push(c);
          }
      }
    return b;
  },
  getScrollHeight: function (a) {
    a = $(a);
    return 0 == a.size() ? 0 : a[0].scrollHeight;
  },
  showVerify: function () {
    _.stepsRes.showVerify && $("#verify-section").show();
  },
  makeStepByStepSolution: function () {
    this.inStepByStep = !0;
    this.openHideStepsNew($(".solution_title_container_highest"), !0);
    this.populateStepByStep(
      "#multipleSolutions",
      this.stepsRes.solutions[0],
      this.stepsRes.standardQuery
    );
    $("#multipleSolutions .next-step-button").click();
    $("#verify-section").hide();
    $("#similar").hide();
    $("#SimilarLink").hide();
    $("#numberLine").hide();
    $("#numberLineLoader").hide();
    $("#empty_number_line_img").hide();
    $("#numberLine img").remove();
    $("#Plot_dynaimc").hide();
  },
  populateStepByStep: function (a, b, e, k) {
    var l = this;
    $(a + " .solution_title_container_highest").remove();
    $(a + " #steps-container .solution_step_list_item").remove();
    $(a + " #steps-container hr").remove();
    $(a + " .solutionHints").remove();
    $(a + " .solution_outside_box").css("padding-top", "7px");
    $(a + " .show-hide-steps-div").remove();
    $(a + " .solution_outside_box").prepend(l.getSettingsContent("stepByStep"));
    $(a + " .show-hide-steps-div").after(l.getSolvingOptions());
    l.stepIndex = 0;
    l.steps = getFixedStepsFormat(b.steps);
    b = $(a + " #steps-container").parent();
    var n = $("<div class='solutionHints'></div>");
    n.append("<div class='nl-third nl-resetLH'>&nbsp;</div>");
    n.append("<div class='nl-third nl-totalHints nl-resetLH'></div>");
    n.append(
      "<div class='nl-third nl-textRight nl-resetLH'><a class='next-step-button nl-nextHintLink nl-resetLH'>" +
        i18n("Next Hint") +
        " <i class='nl-practice-sprite nl-practice-sprite-next'></i></a></div>"
    );
    l.stepsRes.showVerify &&
      n.append(
        "<div style='padding-top: 33px; min-height: 44px;'><span id='verify-input' style='width: 490px; margin-top: -3px !important;' class='mathquill-input mathquill-editable' rel='tooltip' title=''></span><div class='nl-answerCaption nl-greenText nl-hidden'><span>" +
          i18n("Correct Answer") +
          " :)</span><span class='nl-hideAnswerCaption'></span></div><div class='nl-answerCaption nl-redText nl-hidden'><span>" +
          i18n("Let's Try Again") +
          " :(</span><span class='nl-hideAnswerCaption'></span></div><div class='nl-answerCaption nl-goldText nl-hidden'><span>" +
          i18n("Try to simplify further") +
          "</span><span class='nl-hideAnswerCaption'></span></div><button class='verify-button'><strong>" +
          i18n("Verify") +
          "</strong></button></div>"
      );
    b.append(n);
    b.find(".mathquill-editable:not(.mathquill-rendered-math)").mathquill(
      "editable"
    );
    b.find(".mathquill-editable").mathquill(
      "placeholder",
      i18n("js.Know the answer? Give it a try")
    );
    $("#steps-container").show();
    b.find(".verify-button")
      .unbind("click")
      .click(function (q) {
        k &&
          symbolab_log(
            "Registration",
            "ClickedFeature",
            "Solver\tSimilar\tVerifyButton",
            e
          );
        SOLUTIONS.verify($(this), "StepByStep", e);
      });
    b.find("#verify-input")
      .unbind("keyup")
      .keyup(function (q) {
        13 === (q.charCode ? q.charCode : q.keyCode) &&
          (k &&
            symbolab_log(
              "Registration",
              "ClickedFeature",
              "Solver\tSimilar\tVerifyEnter",
              e
            ),
          SOLUTIONS.verify($(this).parent().find("button"), "StepByStep", e));
      });
    $(a + " .next-step-button")
      .unbind("click")
      .click(function () {
        l.stepIndex < l.steps.length &&
          ($(a + " #steps-container").append(
            l.createStepListItem(l.steps[l.stepIndex])
          ),
          $(
            a +
              " #steps-container .mathquill-embedded-latex:not(.mathquill-rendered-math)"
          ).mathquill());
        k
          ? symbolab_log(
              "Registration",
              "ClickedFeature",
              "Solver\tSimilar\tNext",
              e
            )
          : 0 < l.stepIndex && symbolab_log("Solutions", "StepByStep-Next");
        l.stepIndex++;
        l.stepIndex <= l.steps.length &&
          $(a + " .nl-totalHints").text(l.stepIndex + " / " + l.steps.length);
        l.stepIndex >= l.steps.length &&
          $(a + " .next-step-button").addClass("nl-disabled");
      });
  },
  getSolvingOptions: function () {
    _ = this;
    if (_.stepsRes.solvingOptions) {
      var a = $("<div id='multipleOptions' class='newSelect closed'></select>");
      a.append(
        "<span class='arrows'><i class='nl-practice-sprite'></i></span>"
      );
      a.append(
        "<div class='value' value='" +
          _.stepsRes.solvingOptions.returnedOption +
          "'></div>"
      );
      for (
        var b = $("<div class='slItems'></div>"), e = 0;
        e < _.stepsRes.solvingOptions.count;
        e++
      )
        (_.stepsRes.solvingOptions.displays[e] =
          _.stepsRes.solvingOptions.displays[e].replace(/\\mathrm{/, "")),
          (_.stepsRes.solvingOptions.displays[e] =
            _.stepsRes.solvingOptions.displays[e].replace(/}/, "")),
          _.stepsRes.solvingOptions.returnedOption ===
          _.stepsRes.solvingOptions.queries[e]
            ? a.find(".value").append(_.stepsRes.solvingOptions.displays[e])
            : b.append(
                "<div class='slItem' value='" +
                  _.stepsRes.solvingOptions.queries[e] +
                  "'>" +
                  _.stepsRes.solvingOptions.displays[e] +
                  "</div>"
              );
      a.append(b);
      _.inStepByStep ||
        symbolab_log("Registration", "SeenFeature", "Solver\tSolvingOptions");
      return a;
    }
  },
  getTopLockedIndication: function () {
    var a = $("<div class='lockedSteps-div'></div>");
    a.append("<span class='locked-step'></span>");
    a.append("<div class='value'>" + i18n("unlock steps") + "</div>");
    symbolab_log(
      "Registration",
      "SeenFeature",
      "Solver\tTopLockedStep\t" +
        this.stepsRes.topic +
        "\t" +
        this.stepsRes.subTopic,
      this.stepsRes.query
    );
    return a;
  },
  getSettingsContent: function (a, b) {
    _ = this;
    var e = $("<div class='show-hide-steps-div'></div>"),
      k = $("<div class='stepsSelect newSelect closed'></select>");
    k.append("<span class='arrows'><i class='nl-practice-sprite'></i></span>");
    k.append(
      "<div class='value' value='" + a + "'>" + _.showHideMap[a] + "</div>"
    );
    a = $("<div class='slItems'></div>");
    a.append(
      "<div class='slItem' value='hideSteps'>" +
        _.showHideMap.hideSteps +
        "</div>"
    );
    a.append(
      "<div class='slItem' value='showSteps'>" +
        _.showHideMap.showSteps +
        "</div>"
    );
    b ||
      (a.append(
        "<div class='slItem' value='stepByStep'>" +
          _.showHideMap.stepByStep +
          "</div>"
      ),
      a.append(
        "<div class='slItem' value='showAllSteps'>" +
          _.showHideMap.showAllSteps +
          "</div>"
      ));
    k.append(a);
    e.append(k);
    return e;
  },
  removeSolvingOptions: function () {
    $("#multipleOptions").remove();
  },
  hasTitle: function (a, b) {
    if (
      a.title &&
      a.title.text &&
      a.title.text.createdText &&
      0 <= a.title.text.createdText.indexOf(b)
    )
      return !0;
    if (a.steps)
      for (var e = 0; e < a.steps.length; e++)
        if (this.hasTitle(a.steps[e], b)) return !0;
    return !1;
  },
  getOrigin: function () {
    return 0 <= window.location.href.indexOf("/popular")
      ? "popular"
      : 0 <= window.location.href.indexOf("/notebook")
      ? "notebook"
      : 0 <= window.location.href.indexOf("/graphing-calculator")
      ? "graphing-calculator"
      : "other";
  },
  getQuery: function (a) {
    return a.standardQuery
      ? a.standardQuery
      : SYMBOLAB?.params?.query
      ? SYMBOLAB.params.query
      : "N/A";
  },
  writeSteps: function (a) {
    a
      ? (amplitude.track("Solve", {
          type: "Steps",
          success: void 0 === a.errorMessage,
          subject: a.subject,
          topic: a.topic,
          subTopic: a.subTopic,
          userQuery: this.getQuery(a),
          origin: this.getOrigin(),
        }),
        "undefined" === typeof SOLUTIONS ||
          SOLUTIONS.page ||
          (SOLUTIONS.page = "step-by-step"),
        a.errorMessage
          ? ($("#multipleSolutions").append(
              this.createMessageBox(a.errorMessage)
            ),
            $("#multipleSolutions .mathquill-embedded-latex").mathquill(),
            0 <= a.errorMessage.indexOf("Upgrade") &&
              $("#multipleSolutions .mathquill-embedded-latex").after(
                " <a class='upgrde-button' onclick='showSignUpSubscribe(\"SolutionsSolvingMethod\")'>Upgrade</a>"
              ))
          : void 0 !== a.solutions
          ? ($("#multipleSolutions").empty(),
            (this.isSolutionPage() || isMobileRender()) &&
              0 < (a.dymAlternatives?.length ?? 0) &&
              this.showDym2($("#dym"), a.dymAlternatives),
            this.parseSolutions(a.solutions),
            "" !== this.requestLang &&
              this.requestLang !== a.stepLang &&
              $(".onlyEnglish").show(),
            (this.isSolutionPage() || isMobileRender()) &&
              a.relatedQueries &&
              0 < a.relatedQueries.length &&
              (this.addRelatedProblems($("#relatedList"), a.relatedQueries, 10),
              $("#RelatedLink").show()))
          : a.computesTo && "NA" !== a.computesTo
          ? $("#multipleSolutions").append(this.createMessageBox(a.computesTo))
          : void 0 == a.externalSolution && this.showCannotSolve())
      : this.showCannotSolve();
    $("#ExamplesLink").show();
  },
  showDym2: function (a, b) {
    SOLUTIONS.page || (SOLUTIONS.page = "step-by-step");
    for (var e = 0; e < b.length; e++) {
      var k = b[e],
        l = "dym" + e;
      k.origin && 0 <= k.origin.indexOf("cluster") && (l = "dymcluster");
      l = "/solver/" + SOLUTIONS.page + "/?or=" + l + "&query=";
      k = this.combineTextEquation(k.command, k.equation);
      l = $("<a href='" + l + encodeURIComponent(k) + "'></a>");
      l.append(
        createMathquillSpan(
          "dymText",
          "\\mathrm{" + i18n("Solve instead") + "}:\\:"
        )
      );
      l.append(createMathquillSpan("dymQuery", "\\mathrm{" + k + "}"));
      a.append(l);
      e < b.length - 1 &&
        a.append("<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>");
    }
    a.show();
    a.find(".mathquill-embedded-latex").mathquill();
  },
  addRelatedProblems: function (a, b, e) {
    if ("undefined" !== typeof SOLUTIONS) {
      a.empty();
      SOLUTIONS.page || (SOLUTIONS.page = "step-by-step");
      for (var k = 0; k < b.length && k < e; k++) {
        var l = b[k],
          n = l.command ? l.command + " " + l.equation : l.equation,
          q = "related";
        l.origin && 0 <= l.origin.indexOf("cluster") && (q = "relatedcluster");
        l =
          "/solver/" +
          SOLUTIONS.page +
          "/" +
          encodeURIComponent(n) +
          "?or=" +
          q;
        n = n.replace(/ /g, "\\:").replace(/</g, "&lt;").replace(/>/g, "&gt;");
        n = prepareQueryForMathQuill(n);
        n = $(
          '<li><a class="clickable" onclick="window.location=\'' +
            l +
            '\';"><span class="mathquill-embedded-latex">' +
            n +
            '</span><span  class="search_image1"><svg><use href="#solutions-img"></use></svg></span></a></li>'
        );
        a.append(n);
      }
      $("#related").show();
      a.find(".mathquill-embedded-latex").mathquill();
    }
  },
  showCannotSolve: function () {
    if (
      ("undefined" != typeof widget && 1 === widget) ||
      "undefined" != typeof SOLUTIONS
    )
      $("#multipleSolutions").append(
        this.createMessageBox(i18n("cannot solve"))
      ),
        $("#multipleSolutions .mathquill-embedded-latex").mathquill();
  },
  getPlotSettings: function (a, b) {
    return this.plotSettings
      ? this.plotSettings
      : {
          showZoom: a,
          pixelRatio: window.devicePixelRatio,
          lineWidth: 2,
          allowTouch: b,
        };
  },
  doSimilarProblem: function () {
    var a = this;
    "en" === a.requestLang &&
      $.ajax({
        type: "GET",
        url: "/pub_api/similar",
        beforeSend: authorizeAjaxWithSyPubToken,
        data: {
          language: a.requestLang,
          query: SYMBOLAB.params.query,
          origin: "solutions",
        },
        error: function (b) {
          pageExpired(b, "api_steps");
        },
        success: function (b) {
          if (
            b &&
            !b.errorMessage &&
            void 0 !== b.solutions &&
            1 === b.solutions.length &&
            b.showVerify
          ) {
            $("#similar").empty();
            $("#similar").append(
              "<h2>" + i18n("Try to solve the equation") + "</h2>"
            );
            var e = $('<div class="solution_div"></div>');
            e.append(a.createSolutionBox(b.solutions[0], !0));
            $("#similar").append(e);
            a.inStepByStep = !0;
            $("#verify-section").remove();
            e = $("#similar .solution_title_container_highest");
            a.addContentIfNeeded(e);
            a.populateStepByStep(
              "#similar",
              b.solutions[0],
              b.standardQuery,
              !0
            );
            $("#similar .show-hide-steps-div").remove();
            $("#similar #multipleOptions").remove();
            $("#similar #steps-container li:first-child").remove();
            $("#SimilarLink").show();
            symbolab_log(
              "Registration",
              "SeenFeature",
              "Solver\tSimilar",
              b.standardQuery
            );
            a.inStepByStep = !1;
          }
        },
      });
  },
  doDynamicPlot: function (a, b, e) {
    var k = this;
    void 0 === e && (e = !0);
    k.stepsRes &&
      k.stepsRes.numberLineInfo &&
      SyNumberLine.fromNumberLineInfo(
        $("#numberLine .solution_box"),
        $("#numberLine, #NumberLineLink"),
        k.stepsRes.numberLineInfo
      ).valid &&
      ($("#numberLine").show(),
      $("#numberLineLoader").show(),
      $("#empty_number_line_img").show(),
      $("#NumberLineLink").show());
    if (k.stepsRes && k.stepsRes.plotInfo) {
      var l = $("#Plot_dynaimc"),
        n = $("#PlotLink"),
        q = k.stepsRes.plotInfo.plotRequest;
      if ("" === q) n.hide(), l.hide();
      else if (q && !b) {
        l.show();
        k.syPlot = new SyPlot("#sy_graph", {}, this.getPlotSettings(a, e));
        var v = l.find(".plotText");
        v.hide();
        b = $("#sy_graph");
        var f = $("#plot-loading");
        f.css("position", "absolute");
        f.css("margin-top", b.height() / 2 + 1 + "px");
        f.css("margin-left", b.width() / 2 - 16 + "px");
        f.show();
        n.show();
        "yes" === q && (q = SYMBOLAB.params.query);
        SYMBOLAB.params.or || (SYMBOLAB.params.or = "Solutions");
        $.ajax({
          type: "POST",
          url: "/pub_api/graph/plottingInfo",
          beforeSend: authorizeAjaxWithSyPubToken,
          data: {
            userGraph: JSON.stringify({ formulas: [{ fst: q }] }),
            origin: SYMBOLAB.params.or,
            language: k.requestLang,
            nolog: !0,
          },
          error: function (c) {
            f.hide();
            pageExpired(c, "pub_api_graph_plottingInfo");
          },
          success: function (c) {
            k.stepsRes.plotInfo = c;
            f.hide();
            c =
              k.stepsRes && k.stepsRes.plotInfo
                ? k.stepsRes.plotInfo.graphCalcInputErrors
                : ["error"];
            !Array.isArray(c) || 0 == c.length || (1 == c.length && !c[0])
              ? k.doDynamicPlot(a, !0)
              : (n.hide(), l.hide());
          },
        });
      } else
        try {
          b || l.show();
          k.syPlot = new SyPlot(
            "#sy_graph",
            this.stepsRes.plotInfo,
            this.getPlotSettings(a, e)
          );
          v = l.find(".plotText");
          v.show();
          v.empty();
          var h = this.getPlotTitle();
          v.append(createMathquillSpan(null, h));
          $("#ExamplesLink").show();
          n.show();
          mathquillifyVisible(l);
          k.addViewMore();
        } catch (c) {
          n.hide(), l.hide();
        }
    }
  },
  addViewMore: function () {
    if (this.stepsRes.showViewLarger) {
      var a = this.stepsRes.standardQuery;
      "System of Inequalities" === this.stepsRes.topic &&
        (a = this.stepsRes.standardQuery.replaceAll(",", ";"));
    }
    a &&
      ((a = a.replace(/ /g, "\\:")),
      (a = encodeURI(a)),
      (a = a.replace(/\+/g, "%2B")),
      (a = a.replace(/&/g, "%26")),
      $(".viewLargerPlot").attr(
        "href",
        "/graphing-calculator?or=" + SYMBOLAB.params.or + "&functions=" + a
      ),
      $(".viewLargerPlot").show());
  },
  getPlotTitle: function () {
    var a = "\\mathrm{" + i18n("plotting") + ":}\\:\\: ";
    if (
      this.stepsRes.plotInfo.functionChanges &&
      this.stepsRes.plotInfo.functionChanges[0]
    ) {
      var b = this.stepsRes.plotInfo.functionChanges[0];
      a += b.plotTitle;
      if (b.paramsLatex && b.paramsLatex.length) {
        a += "\\quad\\mathrm{" + i18n("plot assuming") + "}";
        for (var e = 0; e < b.paramsLatex.length; e++)
          (a += "\\quad "),
            (a += b.paramsLatex[e]),
            (a += "="),
            (a += b.paramsReplacementsLatex[e]);
      }
    }
    return a;
  },
  parseSolutions: function (a) {
    var b = $("#multipleSolutions"),
      e = $('<div class="new_solution_box_title"></div>');
    e.append("<h2>" + i18n("solution") + "</h2>");
    "en" === this.requestLang &&
      this.isSolutionPage() &&
      e.append(
        '<a href="/practice" class="practiceLinkTop">Keep Practicing ></a>'
      );
    var k = $("<div></div>");
    k.append(e);
    for (var l in a)
      if (((e = a[l]), null != e)) {
        var n = $('<div class="solution_div"></div>');
        n.append(this.createSolutionBox(e, !0));
        k.append(n);
      }
    b.append(k.html());
    mathquillifyVisible(b);
    this.makeScrollable(b);
  },
  createSolutionBoxDiv: function (a, b) {
    b = b
      ? $('<div class="solution_box solution_outside_box"></div>')
      : $('<div class="solution_box solution_inside_box"></div>');
    void 0 !== a.step_id && b.attr("id", a.step_id);
    void 0 !== a.interimType && b.attr("type", a.interimType);
    return b;
  },
  getTitleContainer: function (a, b) {
    var e = "SYSTEPS.showHideRule(this);";
    b &&
      (e =
        this.isSolutionPage() || this.isGeometryPage()
          ? ""
          : "SYSTEPS.openHiddenSteps(this, true);");
    var k = "";
    a.isOpen ||
      this.isToLock(a) ||
      ((k = "steps" + this.stepsArrayIndex),
      (this.stepsArray[this.stepsArrayIndex] = a),
      (this.stepsHighestBox[this.stepsArrayIndex] = b),
      this.stepsArrayIndex++);
    e = $("<div></div>", { id: k, onclick: e });
    b
      ? e.addClass("solution_title_container_highest")
      : e.addClass("solution_title_container");
    b
      ? a.isInfoStep ||
        (!this.subscribed && a.isLocked && this.isSolutionPage()
          ? (b = this.getTopLockedIndication())
          : this.isSolutionPage()
          ? ((b =
              !this.stepsRes.solutions || 1 < this.stepsRes.solutions.length),
            !b &&
              this.stepsRes.solutions[0].steps &&
              2 > this.stepsRes.solutions[0].steps.length &&
              (b = !0),
            (b = this.getSettingsContent("hideSteps", b)))
          : ((b = $("<div></div>", {
              class: "show-hide-steps-div",
              role: "button",
            })),
            (k = $("<i></i>", {
              class: "show-hide-button show-hide-steps print-hide",
            })),
            k.text(this.showStepsText),
            isMobileRender() && shouldUpgrade()
              ? b.addClass("locked_solution")
              : k.append(document.createTextNode(" \u00bb")),
            b.append(k)),
        e.append(b))
      : ((b = $("<a></a>")),
        a.isOpen
          ? (b.append($("<span class='hideStepsButton'/>")),
            b.append(
              $(
                "<span class='hideButtonText'>" + i18n("hide steps") + "</span>"
              )
            ))
          : (!this.isPracticePage() && this.isToLock(a)
              ? (e.addClass("key"),
                b.append($("<span class='locked-step'/>")),
                this.seenLockedStep ||
                  ((k =
                    "Solver\tLockedStep\t" +
                    this.stepsRes.topic +
                    "\t" +
                    this.stepsRes.subTopic),
                  this.isGeometryPage()
                    ? (k = "Geometry2\tLockedStep")
                    : "undefined" != typeof SYMBOLAB &&
                      SYMBOLAB.params.or &&
                      "gms" === SYMBOLAB.params.or &&
                      (k =
                        "GMS\tLockedStep\t" +
                        this.stepsRes.topic +
                        "\t" +
                        this.stepsRes.subTopic),
                  isMobileRender() && (k = "MobileWeb\t" + k),
                  symbolab_log(
                    "Registration",
                    "SeenFeature",
                    k,
                    this.stepsRes.query
                  ),
                  (this.seenLockedStep = !0)),
                this.relevantForInterimLogging(a) &&
                  ((k =
                    "Solver\tLockedInterim\t" +
                    this.stepsRes.topic +
                    "\t" +
                    a.interimType),
                  symbolab_log(
                    "Registration",
                    "SeenFeature",
                    k,
                    this.stepsRes.query
                  )))
              : b.append($("<span class='showStepsButton'/>")),
            b.append(
              $(
                "<span class='showButtonText'>" + this.showStepsText + "</span>"
              )
            )),
        e.append(b));
    if (void 0 === a.title) e.append(createMathquillDiv("title", "title"));
    else if (a.isExternalStep && !a.isInterimStep) {
      a = "###" + a.title.text.createdText + "###";
      b = $('<div class="solution_step_title"></div>');
      b.append(a);
      renderMathInElement(b[0], {
        delimiters: [{ left: "###", right: "###", display: !0 }],
      });
      if (0 <= b[0].innerText.indexOf("###")) {
        this.showCannotSolve();
        return;
      }
      e.append(b);
    } else e.append(this.getInfoLine("title", a.title));
    return e;
  },
  relevantForInterimLogging(a) {
    return this.isGeometryPage() || void 0 === a.interimType ? !1 : !0;
  },
  isToLock: function (a) {
    return "undefined" == typeof isCompare
      ? a.isLocked && !this.subscribed
      : !1;
  },
  createSolutionBox: function (a, b) {
    var e = this.createSolutionBoxDiv(a, b),
      k = this.getTitleContainer(a, b);
    e.append(k);
    (a.isOpen || a.isInfoStep) && e.append(this.createSolutionBoxContent(a, b));
    !b &&
      this.isSolutionPage() &&
      e.append(
        "<div class='toggle_interim'><img src='/public/images/toggle_open.png' width='24px' height='24px' alt='Click to reveal more steps'></div>"
      );
    return e;
  },
  createSolutionBoxContentUl: function (a, b, e) {
    var k = !0;
    e =
      "undefined" != typeof isCompare && isCompare
        ? $(
            '<ol style="margin-left:-15px !important;list-style:inherit;list-style-type: decimal;" type="1" id="steps-container" class="solution_step_list"></ol>'
          )
        : $('<ul id="steps-container" class="solution_step_list"></ul>');
    b &&
      e.append(
        $(
          "<li class='solution_step_list_itemc solution_steps_text'>" +
            (a.isInfoStep ? "" : i18n("steps")) +
            "</li>"
        )
      );
    void 0 !== a.definition &&
      (e.append(this.getDefintionLine(a.definition, b)), (k = !1));
    void 0 !== a.general_rule &&
      ((b = $("<div></div>")),
      b.append(this.getInfoLine("rule", a.general_rule)),
      e.append(b),
      (k = !1));
    if (void 0 !== a.explanation)
      for (var l in a.explanation)
        (b = $("<div></div>")),
          b.append(
            createMathquillDiv(
              "solution_step_explanation",
              a.explanation[l].createdText,
              a.explanation[l].id
            )
          ),
          e.append(b),
          (k = !1);
    !0 === k &&
      void 0 !== a.step_input &&
      (e.append(createMathquillDiv("solution_step_result", a.step_input)),
      e.append($("<hr class='stepsHr'/>")));
    l = !1;
    for (var n in a.steps)
      (l = this.createStepListItem(a.steps[n])),
        this.isAddHR(l, e) && e.append($("<hr class='stepsHr'/>")),
        e.append(l),
        (l = 0 < l.find(">.solution_step_result").size());
    !1 === l &&
      ((l = $('<li class="solution_step_list_item"></li>')),
      a.isExternalStep ||
        l.append(createMathquillDiv("solution_step_result", a.entire_result)),
      e.append(l));
    !this.inStepByStep &&
      a.practiceLink &&
      this.isSolutionPage() &&
      "en" === this.requestLang &&
      ((b = "Solver\tPracticeLink\tText\t" + a.practiceLink),
      (n =
        i18n("js.click here to practice") +
        " " +
        i18n(a.practiceTopic).toLowerCase() +
        " \u00bb"),
      (l = ""),
      (a = $("<a>", {
        class: "stepsPracticeLink",
        onclick:
          '$.when(symbolab_log("Registration", "ClickedFeature", "' +
          b +
          '")).always(function() {window.location="' +
          a.practiceLink +
          '"; });',
      })),
      a.append(l),
      a.append("<span>" + n + "</span>"),
      e.append(a));
    !this.inStepByStep &&
      0 < $("#structured_topic").length &&
      this.isSolutionPage() &&
      "en" == this.requestLang &&
      new StructuredGeometry(
        SYMBOLAB.params.query
      ).shouldGenerateLinkForQuery() &&
      (symbolab_log("Registration", "SeenFeature", "Solver\tGeometryLink"),
      (a = encodeURIComponent(SYMBOLAB.params.query)),
      (n = i18n("js.click here to view in geometry solver") + " \u00bb"),
      (l = ""),
      (a = $("<a>", {
        class: "stepsPracticeLink",
        onclick:
          '$.when(symbolab_log("Registration", "ClickedFeature", "Solver\tGeometryLink")).always(function() {window.location="/geometry#structuredQuery=' +
          a +
          '"; });',
      })),
      a.append(l),
      a.append("<span>" + n + "</span>"),
      e.append(a));
    return e;
  },
  createStepListItem: function (a) {
    var b = $('<li class="solution_step_list_item"></li>');
    a.aux && a.aux.found && b.addClass("found");
    a.aux && a.aux.let && b.addClass("let");
    if (a.isInterimStep) {
      var e = this.createSolutionBox(a);
      b.append(e);
      a.isShowSolutionAfterStep &&
        void 0 != a.entire_result &&
        b.append(createMathquillDiv("solution_step_result", a.entire_result));
    } else this.populateStepListItem(b, a);
    return b;
  },
  createSolutionBoxContent: function (a, b, e) {
    _ = this;
    a = this.createSolutionBoxContentUl(a, b, e);
    e = $("<div></div>");
    b || e.addClass("solution_list_div");
    e.append(a);
    return e;
  },
  addNotesDiv: function () {
    _ = this;
    var a = $("#main-input").innerHeight();
    $(".nl-notesFav").css("margin-top", a / 2 - 15);
    $(".nl-notesFav").show();
  },
  saveSolutionNote: function (a, b) {
    var e = $.Deferred();
    $.ajax({
      type: "POST",
      url: "/api/notebook/addNote",
      beforeSend: authorizeAjaxWithSyToken,
      data: { problem: a, topic: b, savedFrom: "Solutions" },
      success: function (k) {
        e.resolve(k.response);
      },
      error: function () {
        e.reject();
      },
    });
    return e;
  },
  deleteNote: function (a) {
    return $.ajax({
      type: "POST",
      url: "/api/notebook/deleteNotes",
      beforeSend: authorizeAjaxWithSyToken,
      data: { problems: a, isMobile: !1 },
    });
  },
  deleteNoteMobile: function (a, b) {
    $.ajax({
      type: "POST",
      url: "/api/notebook/deleteNotes",
      beforeSend: authorizeAjaxWithSyToken,
      data: { problems: a, isMobile: !0 },
    }).done(function () {
      b && b();
    });
  },
  addNoteMobile: function (a, b, e, k) {
    $.ajax({
      type: "POST",
      url: "/api/notebook/addNote",
      beforeSend: authorizeAjaxWithSyToken,
      data: {
        problem: a,
        isMobile: !0,
        isNotebook: e,
        license: b,
        topic: this.stepsRes.topic,
        savedFrom: this.NotebookSourceSolutions,
      },
    }).done(function (l) {
      k && k(l);
    });
  },
  openCloseNotes: function () {
    var a = $(".notesTitle").next(),
      b = $(".notesTitle").parent();
    a.is(":visible")
      ? (a.hide(), $(".notesTitle").text(i18n("Save")))
      : (a.show(), $(".notesTitle").text(i18n("Notes")));
    a = b.outerHeight() + 3;
    "undefined" != typeof SYPRAC && (a += 3);
    b.css("margin-top", "-" + a + "px");
  },
  populateStepListItem: function (a, b) {
    void 0 != b.step_id && a.attr("id", b.step_id);
    if (void 0 != b.title) {
      void 0 != b.general_rule &&
        ((b.title.text.createdText =
          "he" == this.requestLang || "ar" == this.requestLang
            ? b.general_rule.text.createdText +
              "\\quad:" +
              b.title.text.createdText
            : b.title.text.createdText +
              (":\\quad " + b.general_rule.text.createdText)),
        (b.general_rule = null));
      var e = this.getInfoLine("title", b.title);
      if (b.practiceLink && !this.isPracticeIconAdded && !isMobileRender()) {
        var k = $(
          '<a onclick=\'$.when(symbolab_log("Registration", "ClickedFeature", "Solver\tPracticeLink\tIcon\t' +
            b.practiceLink +
            '")).always(function() { window.location="' +
            b.practiceLink +
            "\"; });' class='clickable solution-practice-link'><i class='nl-practice-sprite nl-practice-sprite-hintIcon-small'></i></a>"
        );
        e.append(k);
        this.isPracticeIconAdded = !0;
        var l =
          i18n("js.click here to practice") +
          " " +
          i18n(b.practiceTopic).toLowerCase();
        k.tooltipster({ theme: "tooltipster-light", content: l });
      }
      a.append(e);
    }
    void 0 != b.definition &&
      ((e = $("<div></div>")),
      e.append(this.getDefintionLine(b.definition, !1)),
      a.append(e));
    void 0 != b.general_rule &&
      a.append(this.getInfoLine("rule", b.general_rule));
    if (void 0 != b.explanation)
      for (var n in b.explanation)
        a.append(
          createMathquillDiv(
            "solution_step_explanation",
            b.explanation[n].createdText,
            b.explanation[n].id
          )
        );
    void 0 !== b.image &&
      setTimeout(function () {
        SyNumberLine.fromInStepImageUrl(a, $("blank"), b.image);
      }, 0);
    if (void 0 != b.steps)
      for (n in b.steps)
        (e = b.steps[n]),
          e.isInterimStep
            ? ((e = this.createSolutionBox(e)), a.append(e))
            : (this.populateStepListItem(a, e),
              null == e.entire_result &&
                n < b.steps.length - 1 &&
                a.append("<br/>"));
    void 0 != b.entire_result &&
      (b.isExternalStep
        ? a.append(
            this.createSolutionStepBook(
              b.entire_result,
              RegExp("</?formula.*?>", "g")
            )
          )
        : a.append(
            createMathquillDiv("solution_step_result", b.entire_result)
          ));
  },
  isAddHR: function (a, b) {
    b = b.children().last();
    return 0 < a.find(">.solution_box").size() &&
      1 == b.find(">.solution_step_result").size()
      ? !0
      : 0 == b.size() || b.is("hr") || "Steps" == b.text()
      ? !1
      : this.stepsRes && this.stepsRes.externalSolution
      ? !0
      : 1 >= $(a).children().length
      ? !1
      : _.isGeometryPage()
      ? !0
      : 0 < b.find(">.solution_box").size() &&
        0 == b.find(">.solution_step_result").size()
      ? !1
      : !0;
  },
  getDefintionLine: function (a, b) {
    b = $('<div class="solution_box solution_step_definition_main"></div>');
    var e = $(
        '<div class="solution_step_definition" onclick="SYSTEPS.showHideRule(this)" ></div>'
      ),
      k = $("<a></a>");
    k.append($("<span class='print-hide hideStepsButton'/>"));
    k.append(
      $(
        "<span class='print-hide hideButtonText'>" +
          i18n("hide definition") +
          "</span>"
      )
    );
    e.append(k);
    e.append(
      createMathquillDiv(
        "solution_step_title_text",
        a.text.createdText,
        a.text.id
      )
    );
    b.append(e);
    a = createMathquillDiv(
      "solution_step_definition_text",
      a.extension.createdText,
      a.extension.id
    );
    b.append(a);
    return b;
  },
  getInfoLine: function (a, b) {
    var e = $('<div class="solution_step_' + a + '"></div>');
    if (
      b.text &&
      ((a = createMathquillSpan(
        "solution_step_" + a + "_text",
        b.text.createdText,
        b.text.id
      )),
      a.css("position", "relative"),
      e.append(a),
      0 == isMobileRender() && void 0 != b.extension)
    ) {
      a = $(
        "<img class='print-hide solution_info_icon' src='/public/img/icon_info.jpeg' />"
      );
      var k = e.find(".multiline");
      0 == k.size() ? e.append(a) : k.last().append(a);
      $(a)
        .showBalloon({
          contents: createMathquillDiv2(
            "solution_step_extension_text",
            b.extension.createdText,
            b.extension.id
          ).html(),
          position: "top right",
          offsetY: 15,
          minLifetime: 0,
          classname: "infoTip",
          css: { "max-width": "650px", opacity: "1" },
        })
        .toggle(
          function () {
            $(this).showBalloon();
            $(".infoTip").find(".mathquill-embedded-latex").mathquill("redraw");
          },
          function () {
            $(this).hideBalloon();
          }
        );
    }
    return e;
  },
  openHideStepsNew: function (a, b) {
    var e = $(a),
      k = e.next();
    $(".notesMainDiv").remove();
    $(".stepsPracticeLink").remove();
    b
      ? (this.addContentIfNeeded(e),
        this.updateNotesPractice(e),
        $(".show-hide-steps-div").after(this.getSolvingOptions()))
      : (k.hide(), this.removeSolvingOptions());
    a.find(".stepsSelect .value").attr("value", b ? "showSteps" : "hideSteps");
    a.find(".stepsSelect .value").text(
      this.showHideMap[b ? "showSteps" : "hideSteps"]
    );
  },
  openHiddenSteps: function (a, b) {
    a = $(a);
    var e = a.find(".show-hide-steps");
    if (0 != e.size())
      if (isMobileRender() && shouldUpgrade()) showUpgradeMessage();
      else {
        var k = a.next();
        $(".notesMainDiv").remove();
        $(".stepsPracticeLink").remove();
        0 <= e.text().indexOf(this.showStepsText)
          ? (this.addContentIfNeeded(a),
            e.text("\u00ab " + i18n("hide steps")),
            this.updateNotesPractice(a),
            b &&
              symbolab_log(
                "Registration",
                "ClickedFeature",
                "MobileWeb\tOpenSteps"
              ))
          : (k.hide(),
            e.text(this.showStepsText + " \u00bb"),
            b &&
              symbolab_log(
                "Registration",
                "ClickedFeature",
                "MobileWeb\tCloseSteps"
              ));
      }
  },
  setSavedNote: function (a, b) {
    isUserLoggedIn() &&
      this.stepsRes &&
      this.stepsRes.isInNotebook &&
      a.addClass(b);
  },
  updateNotesPractice: function (a) {
    this.isSolutionPage() && this.addNotesDiv();
  },
  isSolutionPage: function () {
    return isMobileRender() ? !1 : 0 <= window.location.href.indexOf("/solver");
  },
  isNotebookPage: function () {
    return 0 <= window.location.href.indexOf("/notebook");
  },
  isPracticePage: function () {
    return 0 <= window.location.href.indexOf("/practice");
  },
  isGraphingPage: function () {
    return 0 <= window.location.href.indexOf("/graphing-calculator");
  },
  isGeometryPage: function () {
    return 0 <= window.location.href.indexOf("/geometry");
  },
  addContentIfNeeded: function (a) {
    var b = a.attr("id");
    b
      ? ((b = b.substr(5)),
        (b = this.createSolutionBoxContent(
          this.stepsArray[b],
          this.stepsHighestBox[b],
          b
        )),
        b.insertAfter(a),
        mathquillifyVisible(b),
        this.makeScrollable(b),
        a.removeAttr("id"))
      : a.next().show();
  },
  openHiddenPlot: function () {
    0 <= $(".show-hide-plot").text().indexOf(i18n("show plot"))
      ? ($(".show-hide-plot").text("\u00ab " + i18n("hide plot")),
        $("#plot-image").show(),
        $("#sy_graph").show(),
        $("#Plot_dynaimc").removeClass("plot-closed"),
        isMobileRender() &&
          symbolab_log("Registration", "ClickedFeature", "MobileWeb\tOpenPlot"))
      : ($(".show-hide-plot").text(i18n("show plot") + " \u00bb"),
        $("#plot-image").hide(),
        $("#sy_graph").hide(),
        $("#Plot_dynaimc").addClass("plot-closed"),
        isMobileRender() &&
          symbolab_log(
            "Registration",
            "ClickedFeature",
            "MobileWeb\tClosePlot"
          ));
  },
  combineTextEquation: function (a, b) {
    var e = "";
    a && (e = e + a + " ");
    return e + b;
  },
  createMessageBox: function (a) {
    var b = $('<div class="solution_div"></div>'),
      e = $('<div class="solution_box solution_outside_box"></div>'),
      k = $("<div class='solution_title_container_highest'> </div>");
    k.append(createMathquillDiv("solution_step_title", a));
    e.append(k);
    b.append(e);
    return b;
  },
  isShowMoreImage: function (a) {
    return 0 < $(a).find(".showStepsButton").size();
  },
  changeToShowMore: function (a) {
    var b = $(a).find(".hideStepsButton");
    b.removeClass("hideStepsButton");
    b.addClass("showStepsButton");
    b = $(a).find(".hideButtonText");
    b.removeClass("hideButtonText");
    b.addClass("showButtonText");
    b.html(this.showStepsText);
    $(a).parent().removeClass("nl-seeMoreOpened");
  },
  changeToShowLess: function (a) {
    var b = $(a).find(".showStepsButton");
    b.removeClass("showStepsButton");
    b.addClass("hideStepsButton");
    b = $(a).find(".showButtonText");
    b.removeClass("showButtonText");
    b.addClass("hideButtonText");
    b.html(i18n("hide steps"));
    $(a).parent().addClass("nl-seeMoreOpened");
  },
  showMobileAppDownload: function (a, b) {
    symbolab_log("Registration", "ClickedFeature", a);
    var e = $("#store-prompt");
    e.find("#close-btn")
      .off("click")
      .on("click", function (k) {
        k.preventDefault();
        e.addClass("hide-important");
      });
    e.find("span").text(b);
    e.find("#store-logo-link")
      .off("click")
      .on("click", function (k) {
        k.preventDefault();
        e.addClass("hide-important");
        $.when(symbolab_log("Registration", "OpenStore", a)).always(
          function () {
            goToStore();
          }
        );
      });
    e.removeClass("hide-important");
  },
  showHideRule: function (a) {
    var b = $(a);
    if (!(0 < b.find(".show-hide-steps").size())) {
      var e = $(a).next();
      if (0 < $(a).find(".locked-step").size())
        (e =
          "Solver\tLockedStep\t" +
          this.stepsRes.topic +
          "\t" +
          this.stepsRes.subTopic),
          this.isGeometryPage()
            ? (e = "Geometry2\tLockedStep")
            : "undefined" != typeof SYMBOLAB &&
              SYMBOLAB.params.or &&
              "gms" === SYMBOLAB.params.or &&
              (e =
                "GMS\tLockedStep\t" +
                this.stepsRes.topic +
                "\t" +
                this.stepsRes.subTopic),
          this.isGeometryPage() ||
            void 0 === b.parent().attr("type") ||
            symbolab_log(
              "Registration",
              "ClickedFeature",
              "Solver\tLockedInterim\t" +
                this.stepsRes.topic +
                "\t" +
                b.parent().attr("type"),
              this.stepsRes.query
            ),
          isMobileRender()
            ? ((e = "MobileWeb\t" + e),
              (a = /(android)/i.test(navigator.userAgent)),
              (b = /(iPad|iPhone)/g.test(navigator.userAgent)),
              (!a && !b) || _.subscribed || isUserLoggedIn()
                ? (!a && !b) || _.subscribed
                  ? _.showMobileAppDownload(
                      e,
                      i18n("js.mobile_locked_step_click")
                    )
                  : _.showStripeWalletSubscription(e)
                : _.showGoogleSignIn(e))
            : showSignUpSubscribe(e);
      else if (this.isShowMoreImage(a)) {
        if (
          (this.isSolutionPage() || isMobileRender()) &&
          !_.dontFireOpenInnerEvent &&
          0 > window.location.href.indexOf("compare.html")
        )
          (e =
            "Solver\tUnlockedInterim\t" +
            this.stepsRes.topic +
            "\t" +
            b.parent().attr("type")),
            isMobileRender() && (e = "MobileWeb\t" + e),
            symbolab_log("Registration", "ClickedFeature", e);
        else if (this.isGeometryPage()) {
          var k = b.parent().parent().hasClass("found"),
            l = b
              .parent()
              .parent()
              .parent()
              .parent()
              .parent()
              .parent()
              .hasClass("solution_div");
          e = "Geometry2\t";
          e =
            (k ? e + "GoalStep" : l ? e + "TopStep" : e + "InnerStep") +
            ("\t" + b.parent().attr("type"));
          symbolab_log("Registration", "ClickedFeature", e);
        }
        this.addContentIfNeeded(b);
        this.changeToShowLess(a);
      } else e.hide(), this.changeToShowMore(a);
      0 == isMobileRender() &&
        ((e = $("img.solution_info_icon")), e.hideBalloon && e.hideBalloon());
    }
  },
  showGoogleSignIn: function (a) {
    showGoogleSignIn && showGoogleSignIn(a, !0);
  },
  showStripeWalletSubscription: function (a) {
    showStripeWalletSubscription && showStripeWalletSubscription(a);
  },
  resetSteps: function () {
    $("#show-hide-steps-div").hide();
    $("#steps-container").hide();
    $(".show-hide-steps").text(i18n("show steps") + " \u00bb");
    $("#steps-container").find(".steps ul").empty();
    $("#steps-container h2").text("");
  },
  makeScrollable: function (a) {
    var b = this;
    a.find(
      ".solution_step_title, .solution_step_result, .solution_step_explanation, .solution_step_definition_text"
    ).each(function () {
      $(this).is(":visible") &&
        !$(this).hasClass("syscrollable") &&
        (1 == $(this).find(".mathquill-embedded-latex").length
          ? b.createScroll(this)
          : $(this)
              .find(".multiline")
              .each(function () {
                b.createScroll(this);
              }));
    });
    a.find(".tableMatrix td:visible").each(function () {
      var e = getActualWidth($(this), !0);
      e > $(this).width() && $(this).css("min-width", e + "px");
    });
  },
  createScroll: function (a) {
    if (0 != $(a).width()) {
      var b = getActualWidth(a, !0);
      getActualWidth(a, !1) < $(a).width() + 1 || createScrollForce(a, b);
    }
  },
};
function loadKatexScripts() {
  const a = document.createElement("link");
  a.rel = "stylesheet";
  a.href = "https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.css";
  a.integrity =
    "sha384-zTROYFVGOfTw7JV7KUu8udsvW2fx4lWOsCEDqhBreBwlHI4ioVRtmIvEThzJHGET";
  a.crossOrigin = "anonymous";
  a.async = !1;
  document.body.appendChild(a);
  return $.when(
    loadScript("https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.js")
  ).pipe(function () {
    return $.when(
      loadScript(
        "https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/contrib/auto-render.min.js"
      )
    );
  });
}
async function createAndDownloadPDF() {
  symbolab_log("Registration", "ClickedFeature", "Solver\tPDF");
  await beforePrint(!1);
  window.print();
  afterPrint();
}
const printSolutionPage = async function () {
    symbolab_log("Registration", "ClickedFeature", "Solver\tPrint");
    await beforePrint(!1);
    window.print();
    afterPrint();
  },
  beforePrint = async function (a) {
    a && $("body").addClass("pdf");
    var b = new Promise((k, l) => {
      $("#symbolabLogoPrint")
        .css("flex-basis", "100%")
        .append(
          "<a class='printLogo' href='/'><img  src='/public/img/logo-s.png' alt='Symbolab Logo'></a>"
        );
      l = $("#symbolabLogoPrint img")[0];
      !l || l.complete ? k() : l.addEventListener("load", k);
    });
    const e = new Promise((k, l) => {
      l = $("#show-steps-button:not(.hide-important)");
      0 === l.length
        ? k()
        : ($("#solution-only").one("steps-rendered", (n) => {
            k();
          }),
          l.click());
    });
    await Promise.all([b, e]);
    "yes" === getLocalStorage().getItem("settings.printOpen") &&
      SYSTEPS.expandAllSteps();
    "no" == getLocalStorage().getItem("settings.printGraph") &&
      $("#Plot_dynaimc").hide();
    a && $("#solution-only-container *").css("-webkit-transform", "none");
    $("#show-hide-steps-divider").hide();
    $(".codepad-input").addClass("hide-important");
    $("body").css("background-color", "white");
    $(".nl-page").css("background-color", "transparent");
    a = a ? 1020 : 1300;
    400 > $("#multipleSolutions").height() &&
      $("#multipleSolutions").prepend(
        '<div class="printWatermark"><p style="top:400px;">Symbolab</p></div>'
      );
    for (b = 400; b < $("#multipleSolutions").height(); b += a)
      $("#multipleSolutions").prepend(
        '<div class="printWatermark"><p style="top:' +
          b +
          'px;">Symbolab</p></div>'
      );
    $("#Plot_dynaimc").prepend(
      '<div class="printWatermark"><p>Symbolab</p></div>'
    );
    this.subscribed
      ? showPointOfInterest(
          ".printIcon",
          '<a class="upgradeLink" href="/user#settings">Click here</a> to set your print & pdf preferences',
          { side: "left" }
        )
      : createUpgradeTooltipOnly(
          $(".printIcon"),
          ".printIcon",
          "SolutionsPrint",
          "to set your print & pdf preferences",
          "left",
          !0
        );
  },
  afterPrint = function () {
    $(".printWatermark").remove();
    $(".printLogo").remove();
    $(".codepad-input").removeClass("hide-important");
    $("body").removeClass("pdf");
    $("body").css("background-color", "");
    $(".nl-page").css("background-color", "");
    $("#show-hide-steps-divider").show();
    "no" == getLocalStorage().getItem("settings.printGraph") &&
      $("#Plot_dynaimc").show();
  };
var Solutions = function (a, b, e, k, l, n, q, v) {
  this.subject = a;
  this.page = b;
  this.query = e;
  this.input = k;
  this.input_back = l;
  this.appLangs = n;
  this.curLang = q;
  this.subscribed = "true" == v;
  this.subjectUl;
  this.installBehavior();
  this.subjectSuggestions = this.activeSuggestionIndex = 0;
};
Solutions.prototype = {
  init: function (a) {
    this.updatePage(a);
    void 0 !== SYPAD &&
      "/solver/word-problems-calculator" === window.location.pathname &&
      SYPAD.inputBox().mathquill(
        "placeholder",
        "\\mathrm{Enter\\:your\\:word\\:problem}"
      );
    jQuery(document).bind("keydown", function (b) {
      if ((b.metaKey || b.ctrlKey) && 80 === b.keyCode)
        return printSolutionPage(), !1;
    });
    $("#itunesLink").click(function () {
      symbolab_log("Solutions", "iOSLink");
    });
    $(".viewLargerPlot").click(function (b) {
      b.preventDefault();
      var e = $(this).attr("href");
      $.when(
        symbolab_log("Registration", "ClickedFeature", "Solver\tViewLargerPlot")
      ).always(function () {
        window.location = e;
      });
    });
    $("#androidLink").click(function () {
      symbolab_log("Solutions", "AndroidLink");
    });
    $(".embedPost").click(function () {
      symbolab_log("Solutions", "Blog", $(this).find(".post_title").text());
    });
    1 === $(".structuredWhat").size() && $(".structuredWhat").click();
  },
  updatePage: function (a) {
    0 <= this.page.indexOf("chemi")
      ? (SOLUTIONS.switchPad(i18n("full pad")),
        setTimeout(function () {
          $(".pad-toolbar-chemistry").click();
        }, 500))
      : 0 <= this.page.indexOf("matrix") ||
        (0 <= this.page.indexOf("linear-algebra") &&
          "undefined" !== typeof SOLUTIONS)
      ? (SOLUTIONS.switchPad(i18n("full pad")),
        setTimeout(function () {
          $(".pad-toolbar-matrix").click();
        }, 500))
      : 0 <= this.page.indexOf("boolean") ||
        0 <= this.page.indexOf("set-theory") ||
        0 <= this.page.indexOf("truth-table") ||
        0 <= this.page.indexOf("logical-sets")
      ? (SOLUTIONS.switchPad(i18n("full pad")),
        $(".pad-toolbar-accents").click())
      : (0 <= this.page.indexOf("triangle") ||
          0 <= this.page.indexOf("quadrilateral") ||
          0 <= this.page.indexOf("trapezoid") ||
          0 <= this.page.indexOf("parallelogram") ||
          0 <= this.page.indexOf("parallelogram") ||
          0 <= this.page.indexOf("rhombus") ||
          0 <= this.page.indexOf("rectangle") ||
          0 <= this.page.indexOf("square") ||
          0 <= this.page.indexOf("law-of") ||
          0 <= this.page.indexOf("line-intersection")) &&
        showPointOfInterest(
          "#structuredTop",
          "<a class=\"clickable\" onclick=\"$.when(symbolab_log('Geometry', 'StructuredTooltip')).always(function() { window.location='/geometry'; });\">" +
            i18n("js.Geometry Structured Tooltip") +
            "</a>",
          { side: "bottom" }
        );
    this.updateMenu();
    "" === this.query &&
      (this.input &&
        void 0 !== SYPAD &&
        SYPAD.inputBox().mathquill(
          "write",
          this.input.replace(/&amp;/g, "&"),
          this.input_back
        ),
      0 <= this.page.indexOf("system-of-equations") &&
        $(".as300").insertAfter("#Examples"));
    (this.query || !this.subscribed || 0 < $("#guideLink").size()) &&
      $("#ExamplesLink").show();
    this.query && ($("#steps-loading").show(), this.doSolve(a));
  },
  updateMenu: function () {
    var a = this;
    "" !== a.page &&
      ("calculus-calculator" === a.page ||
      "pre-algebra-calculator" === a.page ||
      "algebra-calculator" === a.page ||
      "linear-algebra-calculator" === a.page ||
      "functions-graphing-calculator" === a.page ||
      "geometry-calculator" === a.page
        ? $(".ma").eq(0).click()
        : $(".nl-leftNav li a").each(function (b) {
            if (
              0 <=
              $(this)
                .attr("href")
                .indexOf("/" + a.page)
            ) {
              $(this).addClass("active");
              b = $(this).parents("li");
              for (var e = b.length - 1; 0 <= e; e--)
                b.eq(e).find(".ma").eq(0).click();
            }
          }));
  },
  doSolve: function (a) {
    var b = this.query;
    SYMBOLAB.params.query = b;
    "" == b
      ? (SYMBOLAB.inputBox().mathquill("latex", this.query),
        SYMBOLAB.promptError(
          "Cannot understand this query, please try a different query."
        ))
      : ((b = prepareQueryForMathQuill(b)),
        void 0 != SYPAD && SYPAD.inputBox().mathquill("latex", b),
        SYSTEPS.updateStepsPlot(!1, this.page, a),
        $(".show-hide-plot").text("\u00ab " + i18n("hide plot")),
        $("#steps-container").show(),
        $("#steps-container")
          .find(".mathquill-embedded-latex")
          .mathquill("redraw"));
  },
  switchPad: function (a, b) {
    b ||= ".pad-toolbar-basic";
    if (0 <= a.indexOf(i18n("full pad"))) {
      symbolab_log("Pad", "switch", "full pad");
      var e = $(".codepad-container"),
        k = $.Deferred();
      0 < e.size()
        ? k.resolve()
        : $.get(
            "/full_pad",
            null,
            function (l) {
              l = l.replace("&{'Basic'}", i18n("Basic"));
              l = l.replace("&{'Radians'}", i18n("Radians"));
              l = l.replace("&{'Degrees'}", i18n("Degrees"));
              l = l.replace("&{'clear'}", i18n("clear"));
              $(l).insertAfter("#widgetPad");
              e = $(".codepad-container");
              k.resolve();
            },
            "html"
          );
      $.whenAll(k).done(function () {
        e.find(
          ".mathquill-embedded-latex:not(.mathquill-rendered-math)"
        ).mathquill();
        e.show();
        $(".codepad-container-small").hide();
        $(".solution-codepad-header span").html(
          "\u00ab " + i18n("compact pad")
        );
        void 0 != SYPAD && $(b).click();
        e.mathquill("redraw");
      });
    } else
      symbolab_log("Pad", "switch", "compact pad"),
        $(".codepad-container").hide(),
        $("#chemistryTable2").hide(),
        $(".codepad-container-small").show(),
        $("#widgetPad").show(),
        $("#Compact").show(),
        $("#widgetPad").mathquill("redraw"),
        $(".solution-codepad-header span").html(i18n("full pad") + " \u00bb");
  },
  parseQueryParameters: function () {
    for (
      var a, b = /([^&=]+)=?([^&]*)/g, e = window.location.search.substring(1);
      (a = b.exec(e));

    )
      this.params[decodeURIComponent(a[1])] = decodeURIComponent(a[2]);
  },
  doStructuredSearch: function () {
    query =
      $("#structured_subtopic").text() +
      ", find " +
      $(".selectedWhat").text() +
      ", given ";
    $(".givenDiv:visible .oneGiven").each(function () {
      var a = $(this).find(".givenLabel").text(),
        b = $(this).find(".mathquill-editable").mathquill("latex");
      b ||= "0";
      var e = $(this).find(".chosen").text();
      query += a + "=" + b + e + ",";
    });
    query = query.replace(/,$/, "");
    window.location = "/solver/" + this.page + "/" + encodeURIComponent(query);
  },
  doConversionSearch: function () {
    query =
      "convert " +
      $("#convInput").mathquill("latex") +
      " " +
      $("#convertFrom .same-as-selected").data("group") +
      " to " +
      $("#convertTo .same-as-selected").data("group");
    query = query.replace(/,$/, "");
    window.location = "/solver/" + this.page + "/" + encodeURIComponent(query);
  },
  populateGivenStructure: function () {
    if (this.query) {
      var a = this;
      $(".givenDiv .mathquill-editable").mathquill("latex", "");
      var b = /.+?, find (.+?), given (.+)/;
      a.structuredWhat = this.query.match(b)[1];
      $(".structuredWhat")
        .filter(function () {
          return $(this).text() === a.structuredWhat;
        })
        .click();
      b = this.query.match(b)[2].split(",");
      this.fixGivenArray(b);
      $(".givenDiv:visible .oneGiven .typeTD").removeClass("chosen");
      for (var e = 0; e < b.length; e++) {
        var k = b[e];
        if ("" != k) {
          k.match(/(.+?)=.*/);
          var l = k.match(/.+?=(.*)/)[1];
          $(".givenDiv:visible .oneGiven")
            .eq(e)
            .find(".typeTD")
            .each(function () {
              var n = $(this).text();
              if (new RegExp("[^a-z]" + n + "$").test(l))
                return (l = l.replace(n, "")), $(this).addClass("chosen"), !1;
            });
          $(".givenDiv:visible .mathquill-editable")
            .eq(e)
            .mathquill("latex", l);
        }
      }
    }
  },
  populateConversions: function () {
    if (this.query) {
      var a = /^convert (.+?)([a-z]+?) to ([a-z]+?)$/;
      this.query.match(a);
      $("#convInput").mathquill("latex", this.query.match(a)[1]);
      groupSelectSelected(
        $(
          "#convertFrom .select-items div[data-group=" +
            this.query.match(a)[2] +
            "]"
        )
      );
      groupSelectSelected(
        $(
          "#convertTo .select-items div[data-group=" +
            this.query.match(a)[3] +
            "]"
        )
      );
    } else
      groupSelectSelected($("#convertFrom .select-items div").eq(0)),
        groupSelectSelected($("#convertTo .select-items div").eq(1));
  },
  fixGivenArray: function (a) {
    for (var b = 0; b < a.length; b++) {
      var e = a[b];
      "" != e &&
        0 > e.indexOf("=") &&
        ((a[b - 1] = a[b - 1] + "," + e), a.splice(b, 1), b--);
    }
  },
  installBehavior: function () {
    var a = this;
    isUserLoggedIn() &&
      1 == a.subscribed &&
      $("#click-capture").addClass("click-capture-subscribed");
    $("body").on("click", "#click-capture", function () {
      if (!isUserLoggedIn() || 0 == _.subscribed)
        return showSignUpSubscribe("Solver\tVerify"), !1;
    });
    $("body").on("click", ".toggle_interim img", function (e) {
      $(e.currentTarget)
        .parent()
        .parent()
        .find(".solution_title_container")
        .click();
    });
    $(".nl-topSubMenu a").click(function () {
      syMenu("Top", $(this).attr("href"));
    });
    $(".nl-leftMenu").click(function () {
      syMenu("Left", $(this).attr("href"));
    });
    var b = a.subject;
    "" == b && (b = "algebra");
    b = a.page;
    "" == b && (b = "equation-calculator");
    $(".interPageLink").click(function (e) {
      symbolab_log("Solutions", "PageLinkClick", $(e.currentTarget).text());
    });
    $(".btn-custom.search").text(i18n("go button"));
    $("#fullPadLink").click(function (e) {
      a.switchPad(e.currentTarget.innerHTML);
      isUserLoggedIn()
        ? showPointOfInterest("#fullPadLink", i18n("js.set preferred pad here"))
        : createSignupTooltipOnly(
            $("#fullPadLink"),
            "#fullPadLink",
            "SolverPadSwitch",
            i18n("js.to set your preferred pad"),
            "top"
          );
    });
    $("button.structured_search").click(function (e) {
      a.doStructuredSearch();
    });
    $("button.convert_search").click(function (e) {
      a.doConversionSearch();
    });
    $("#verify-input")
      .unbind("keyup")
      .keyup(function (e) {
        13 === (e.charCode ? e.charCode : e.keyCode) &&
          a.verify($(this).parent().find("button"), "SolutionPage", a.query);
      });
    $(".verify-button").click(function (e) {
      a.verify($(this), "SolutionPage", a.query);
    });
    $(".structuredWhat").click(function () {
      $(".structuredWhat").removeClass("selectedWhat");
      $(this).addClass("selectedWhat");
      var e = $(this).text();
      $(".givenDiv").hide();
      var k = $(this).attr("data");
      $(k).show();
      $(k).find(".mathquill-editable").eq(0).focus();
      $(k)
        .find(".mathquill-editable")
        .each(function () {
          var l = $(this).attr("placeholder");
          l && $(this).mathquill("placeholder", l);
        });
      (k = $(k).find(".hidden-image").text()) &&
        $("#structuredTop .structured_image").attr("src", k);
      $("#multipleSolutions").toggle(e === a.structuredWhat);
    });
    $(".typeTD").click(function () {
      $(this).siblings().removeClass("chosen");
      $(this).addClass("chosen");
    });
    $(".sprite_pad_input.structured").tooltipster({
      theme: "tooltipster-light",
      trigger: "click",
      arrow: !1,
      side: "top",
      functionPosition: function (e, k, l) {
        l.coord.left -= 150;
        return l;
      },
      interactive: !0,
      functionBefore: function (e, k) {
        var l = $(
          '<table id="buttonsTable" class="noselect"><tbody><tr><td class="padButton new-pad-button font16" data-append="^" data-moveleft="1"><span class="mathquill-embedded-latex">x^{\\msquare}</span></td><td class="padButton new-pad-button font16" data-append="_" data-moveleft="1"><span class="mathquill-embedded-latex">x_{\\msquare}</span></td><td class="padButton new-pad-button font16" data-append="\\frac{}{}" data-moveleft="2"><span class="mathquill-embedded-latex">\\frac{\\msquare}{\\msquare}</span></td><td class="padButton new-pad-button font16" data-append="\\sqrt" data-moveleft="1"><span class="mathquill-embedded-latex">\\sqrt{\\square}</span></td><td class="padButton new-pad-button font16" data-append="\\pi" data-moveleft="0"><span class="mathquill-embedded-latex">\\pi</span></td></tr></tbody></table>'
        );
        l.find(".mathquill-embedded-latex").mathquill();
        void 0 != SYPAD &&
          (SYPAD.activeInputBox = $(k.origin)
            .parents(".givenInput")
            .find(".mathquill-editable"));
        e.content(l);
        $(k.origin).removeClass("sprite_pad_input");
        $(k.origin).addClass("sprite_pad_input_green");
      },
      functionAfter: function (e, k) {
        $(k.origin).addClass("sprite_pad_input");
        $(k.origin).removeClass("sprite_pad_input_green");
      },
    });
    $(".sprite_pad_input.converters").tooltipster({
      theme: "tooltipster-light",
      trigger: "click",
      arrow: !1,
      side: "top",
      interactive: !0,
      functionBefore: function (e, k) {
        var l = $(
          '<table id="buttonsTable" class="noselect"><tbody><tr><td class="padButton new-pad-button font16" data-append="^" data-moveleft="1"><span class="mathquill-embedded-latex">x^{\\msquare}</span></td><td class="padButton new-pad-button font16" data-append="\\frac{}{}" data-moveleft="2"><span class="mathquill-embedded-latex">\\frac{\\msquare}{\\msquare}</span></td><td class="padButton new-pad-button font16" data-append="\\sqrt" data-moveleft="1"><span class="mathquill-embedded-latex">\\sqrt{\\square}</span></td></tr></tbody></table>'
        );
        l.find(".mathquill-embedded-latex").mathquill();
        l.find(".padButton").click(function () {
          SYPAD.padButtonClick(this);
        });
        void 0 != SYPAD &&
          (SYPAD.activeInputBox = $(k.origin)
            .parents(".givenInput")
            .find(".mathquill-editable"));
        e.content(l);
        $(k.origin).removeClass("sprite_pad_input");
        $(k.origin).addClass("sprite_pad_input_green");
      },
      functionAfter: function (e, k) {
        $(k.origin).addClass("sprite_pad_input");
        $(k.origin).removeClass("sprite_pad_input_green");
      },
    });
    $(".arrow_right").click(function (e) {
      e = e.currentTarget;
      var k = e.childNodes[0].childNodes[0],
        l = !1;
      let n = $(e).parent().next("ul");
      0 < $(k).attr("href").indexOf("arrow_right-svg") && (l = !0);
      $(e).closest("ul").eq(0).find("ul").hide();
      $(e)
        .closest("ul")
        .eq(0)
        .find(".arrow_right svg use")
        .attr("href", "#arrow_right-svg");
      l &&
        ($(k).attr("href", "#arrow_down-svg"),
        n.eq(0).removeClass("hide"),
        n.eq(0).slideToggle(300));
    });
    $("body").on("click", ".nl-notesFav", function () {
      var e = $(this);
      if (isUserLoggedIn())
        if (e.hasClass("nl-notesFavSaved"))
          $.when(_.deleteNote(SOLUTIONS.query)).done(function () {
            e.toggleClass("nl-notesFavSaved");
            symbolab_log("Solutions", "FavoriteDelete", SOLUTIONS.query);
          });
        else {
          var k = _.saveSolutionNote(SOLUTIONS.query, _.stepsRes.topic);
          $.when(k).done(function (l) {
            l && subscribed
              ? showPointOfInterest(".nl-notesFav", l, {
                  onDismiss: function () {},
                })
              : l
              ? createUpgradeTooltip(".nl-notesFav", "SolverSaveNote", l)
              : e.toggleClass("nl-notesFavSaved");
          });
        }
      else
        createSignupTooltip(
          ".nl-notesFav ",
          "SolverSaveNote",
          i18n("to save notes and more")
        );
      symbolab_log("Solutions", "SaveClicked", null, !1, SOLUTIONS.query);
    });
    $("body")
      .off("click", "#PlotLink, #ExamplesLink")
      .on("click", "#PlotLink, #ExamplesLink", function (e) {
        e.preventDefault();
        e = $(this).attr("href");
        $(e)
          .get(0)
          .scrollIntoView({
            behavior: "smooth",
            block: "start",
            inline: "start",
          });
      });
  },
  verify: function (a, b, e) {
    var k = this;
    k.verifying ||
      ((k.verifying = !0),
      a.parent().find(".nl-answerCaption").hide(),
      a.parent().find(".nl-answerCaption.not-ready").show(),
      $.ajax({
        type: "GET",
        url: "/api/verifySolution",
        beforeSend: authorizeAjaxWithSyPubToken,
        data: {
          problem: e,
          solution: a.parent().find("#verify-input").mathquill("latex"),
          or: b,
        },
        success: function (l) {
          a.parent().find(".nl-answerCaption").hide();
          l.correct
            ? a.parent().find(".nl-answerCaption.nl-greenText").show()
            : l.partiallyCorrect
            ? (a
                .parent()
                .find(".nl-answerCaption.nl-goldText span")
                .eq(0)
                .text(l.userMessage),
              a.parent().find(".nl-answerCaption.nl-goldText").show())
            : a.parent().find(".nl-answerCaption.nl-redText").show();
        },
        error: function (l) {
          a.parent().find(".nl-answerCaption").hide();
          a.parent().find(".nl-answerCaption.nl-redText").show();
        },
        complete: function () {
          k.verifying = !1;
        },
      }));
  },
};
class SyKeypad {
  constructor(a) {
    function b() {
      setTimeout(() => {
        $("#english-keypad div").css("height", "auto");
        $("#mobile-keypad #keypad div.keypanel#english-keypad span").css(
          "width",
          "auto"
        );
        $("#mobile-keypad #keypad div.keypanel#english-keypad span.shift").css(
          "width",
          "auto"
        );
        $("#mobile-keypad #keypad div.keypanel#english-keypad span.blank").css(
          "width",
          "auto"
        );
        $("#mobile-keypad #keypad div.keypanel#english-keypad span.space").css(
          "width",
          "auto"
        );
        var k = $("#keypad-slide").height();
        $("#english-keypad div").height(k / 4 - 2);
        $("#mobile-keypad #keypad div.keypanel#english-keypad span").css(
          "height",
          "auto"
        );
        k = $("#keypad-slide").width();
        var l = k / 10 - 3;
        $("#mobile-keypad #keypad div.keypanel#english-keypad span").css(
          "width",
          l
        );
        $("#mobile-keypad #keypad div.keypanel#english-keypad span.shift").css(
          "width",
          2.1 * l
        );
        $("#mobile-keypad #keypad div.keypanel#english-keypad span.blank").css(
          "width",
          2.1 * l
        );
        $("#mobile-keypad #keypad div.keypanel#english-keypad span.space").css(
          "width",
          6.4 * l
        );
        l = $("#english-keypad div").width();
        $("#english-keypad div").css("margin-right", k - l);
      }, 0);
    }
    this.root = a;
    $(".mathquill-editable:not(.mathquill-rendered-math)", a).mathquill(
      "editable"
    );
    this.inputBox = $("#main-input", a);
    this.inputBox.mathquill("placeholder", "\\mathrm{Enter\\:a\\:problem}");
    this.keypad = $("#keypad", a);
    this.keypad
      .off("touchstart", "div.keypanel span")
      .on("touchstart", "div.keypanel span", (k) => {
        this._resetHighlights();
        $(k.currentTarget).addClass("touch");
      });
    this.keypad
      .off("click", "div.keypanel span")
      .on("click", "div.keypanel span", (k) => {
        this._resetHighlights();
        const l = $(k.currentTarget).closest(".keypanel").hasClass("uppercase");
        $(k.currentTarget).hasClass("shift") &&
          (l
            ? ($(k.currentTarget).closest(".keypanel").removeClass("uppercase"),
              $(k.currentTarget).find("svg#not-pressed").show(),
              $(k.currentTarget).find("svg#pressed").hide())
            : ($(k.currentTarget).closest(".keypanel").addClass("uppercase"),
              $(k.currentTarget).find("svg#not-pressed").hide(),
              $(k.currentTarget).find("svg#pressed").show()));
        this._padButtonClick(k.currentTarget, l);
      });
    const e = $("body");
    e.on("touchend touchcancel", () => this._resetHighlights());
    e.off("focus.mathquill", ".mathquill-editable").on(
      "focus.mathquill",
      ".mathquill-editable",
      () => {
        this.keypad.hasClass("hide-important") &&
          (this.keypad.removeClass("hide-important"),
          b(),
          $("#scan-to-solve-and-decoration", a).hide());
      }
    );
    $("#keypad-slide", a).on("scroll", function (k) {
      20 > Math.abs(k.target.scrollLeft % k.target.offsetWidth) &&
        ((k = Math.floor(k.target.scrollLeft / k.target.offsetWidth)),
        $("#keypad_scroll_indicators span", a)
          .removeClass("selected")
          .eq(k)
          .addClass("selected"));
    });
    $("#keypad_scroll_indicators > span")
      .off("click")
      .on("click", function () {
        if (!$(this).hasClass("selected")) {
          var k = $("#keypad-slide").width() * $(this).index();
          $("#keypad-slide")
            .addClass("animate")
            .animate({ scrollLeft: k }, "slow", function () {
              $("#keypad-slide").removeClass("animate");
            });
          $("#keypad_scroll_indicators > span", a).removeClass("selected");
          $(this).addClass("selected");
        }
      });
    $("textarea", a).attr("inputmode", "none");
    b();
    window.addEventListener("resize", function () {
      b();
    });
  }
  _cleanSearchPhrase(a) {
    void 0 !== a &&
      ((a = a.replace(/\\:/g, " ")),
      (a = a.replace(/(\^\{(.*?)\}|\^(.))/g, "^{$2$3}")),
      (a = a.replace(/(_\{(.*?)\}|_(.))/g, "_{$2$3}")));
    return a;
  }
  _command(a) {
    switch (a.data("command")) {
      case "backspace":
        this._backspace();
        break;
      case "moveleft":
        this._moveLeft();
        break;
      case "moveright":
        this._moveRight();
        break;
      case "newline":
        this._newLine();
        break;
      case "go":
        this._go();
    }
  }
  _backspace() {
    this.inputBox.mathquill("backspace");
  }
  _moveLeft() {
    this.inputBox.mathquill("moveleft");
  }
  _moveRight() {
    this.inputBox.mathquill("moveright");
  }
  _go() {
    var a = this.inputBox.mathquill("latex");
    a = this._cleanSearchPhrase(a);
    a = encodeURIComponent(a);
    window.location.href = "/getsolution?input=" + a  ;
  }
  _newLine() {
    var a = this.inputBox.mathquill("latex");
    let b = 0;
    const e = !!a.match(/^\s*[fy][\s\w\\()]*=/i);
    if (0 <= a.indexOf("\\begin{cases}")) {
      const k = a.match(/(.*?)(\\begin{cases}.+?)(\\end{cases}.*)/i);
      k &&
        ((a = k[1] + k[2] + (e ? " \\\\ & " : " \\\\ ") + k[3]),
        (b = e ? 2 : 1));
    } else
      e
        ? (symbolab_log("Pad", "NewlineType", "Function"),
          (a += " \\begin{cases} & \\\\ & \\end{cases}"),
          (b = 4))
        : (symbolab_log("Pad", "NewlineType", "SoE"),
          (a += " \\begin{cases} \\\\ \\end{cases}"),
          (b = 2));
    this.inputBox.mathquill("latex", "");
    this.inputBox.mathquill("write", a, b);
  }
  _appendInput(a, b) {
    b = b ? a.data("append").toUpperCase() : a.data("append");
    a = a.data("moveleft");
    void 0 !== b &&
      (void 0 === a && (a = 0), this.inputBox.mathquill("write", b + "", a));
  }
  _padButtonClick(a, b) {
    b = this._appendButtonAndGetLogInfo(a, b);
    a = b[0];
    b = b[1];
    "/" !== window.location.pathname
      ? symbolab_log("Pad", b, a)
      : symbolab_log("MainPagePad", b, a);
    this.inputBox.focus();
    return !1;
  }
  _appendButtonAndGetLogInfo(a, b) {
    a = $(a);
    const e = a.parents(".keypanel:first").attr("id");
    a.data("clear") && this.inputBox.mathquill("latex", "");
    let k;
    void 0 !== a.data("append")
      ? ((k = b ? a.data("append").toUpperCase() : a.data("append")),
        this._appendInput(a, b))
      : void 0 !== a.data("command") &&
        ((k = a.data("command")), this._command(a));
    return [k, e];
  }
  _resetHighlights() {
    $("div.keypanel span", this.keypad).removeClass("touch");
  }
}
function promiseCompletionSource() {
  let a, b;
  return {
    promise: new Promise((e, k) => {
      a = e;
      b = k;
    }),
    resolve: a,
    reject: b,
  };
}
const SyPayments = function (a, b, e) {
  this.stripe = Stripe(a, { locale: e });
  this.sy_cid = b;
  this.lang = e;
  this.walletPromiseCompletionSource = promiseCompletionSource();
  this.installBehavior();
};
SyPayments.prototype = {
  installBehavior: function () {},
  showWalletButton: function (a, b, e, k, l) {
    const n = this;
    let q, v;
    try {
      (q = n.stripe.elements()),
        (v = n.stripe.paymentRequest({
          country: this.sy_cid,
          currency: "usd",
          total: { label: "Total", amount: Math.round(100 * b) },
          requestPayerName: !0,
          requestPayerEmail: !0,
        }));
    } catch (h) {
      this.walletPromiseCompletionSource.reject(
        "Failed to initialize Stripe " + h
      );
      return;
    }
    const f = q.create("paymentRequestButton", {
      paymentRequest: v,
      style: { paymentRequestButton: { height: "54px" } },
    });
    f.on("click", function () {
      symbolab_log("Registration", "SubscribeClicked-stripe_" + a, k);
    });
    v.on("paymentmethod", (h) => {
      $.ajax({
        type: "POST",
        url: "/api/payments/createSubscription",
        data: {
          variation: sy_var,
          country: n.sy_cid,
          type: a,
          platform: "stripe",
          url: null,
          position: null,
        },
        beforeSend: authorizeAjaxWithSyToken,
        error: function (c, p) {
          $(".spinner").hide();
        },
        success: function (c) {
          (async function (p) {
            var w = $("#error-message");
            p = JSON.parse(p);
            if (p.result && "ALERT" === p.result)
              w.text(p.data),
                $(".error_image1 svg").show(),
                $(".spinner").hide();
            else {
              w = p.clientSecret;
              var { paymentIntent: y, error: x } =
                await n.stripe.confirmCardPayment(
                  w,
                  { payment_method: h.paymentMethod.id },
                  { handleActions: !1 }
                );
              x
                ? h.complete("fail")
                : (h.complete("success"),
                  "requires_action" === y.status &&
                    (await n.stripe.confirmCardPayment(w)),
                  $.when(
                    symbolab_log("Registration", "SubscribeCompleted-" + a, k)
                  ).always(function () {
                    let C = window.location.href;
                    C = 0 <= C.indexOf("?") ? C + "&" : C + "?";
                    window.location.href = C + "checksubscribed";
                    window.location.reload();
                  }));
            }
          })(c);
        },
      });
    });
    (async () => {
      const h = await v.canMakePayment();
      h && (h.googlePay || h.applePay)
        ? (f.mount("#" + e),
          this.walletPromiseCompletionSource.resolve(!0),
          l())
        : ((document.getElementById(e).style.display = "none"),
          this.walletPromiseCompletionSource.reject("No wallet available"));
    })();
  },
  runWalletCheck: function () {
    let a;
    try {
      a = this.stripe.paymentRequest({
        country: this.sy_cid,
        currency: "usd",
        total: { label: "Total", amount: 1 },
        requestPayerName: !0,
        requestPayerEmail: !0,
      });
    } catch (b) {
      this.walletPromiseCompletionSource.reject(
        "Failed to initialize Stripe " + b
      );
      return;
    }
    (async () => {
      const b = await a.canMakePayment();
      b && (b.googlePay || b.applePay)
        ? this.walletPromiseCompletionSource.resolve(!0)
        : this.walletPromiseCompletionSource.reject("No wallet available");
    })();
  },
  initializeStripe: function (a, b, e, k, l) {
    const n = this;
    $(".spinner").show();
    $("#billing-screen-shot").show();
    $("#payment-form").hide();
    $.ajax({
      type: "POST",
      url: "/api/payments/createSubscription",
      data: {
        variation: sy_var,
        country: n.sy_cid,
        type: a,
        platform: "stripe",
        url: b,
        position: e,
        coupon: l,
      },
      beforeSend: authorizeAjaxWithSyToken,
      error: function (q, v) {
        $(".spinner").hide();
      },
      success: function (q) {
        const v = $("#error-message");
        q = JSON.parse(q);
        if (q.result && "ALERT" === q.result)
          v.text(q.data), $(".error_image1 svg").show(), $(".spinner").hide();
        else {
          var f = n.stripe.elements({
            appearance: { theme: "stripe" },
            clientSecret: q.clientSecret,
          });
          q = f.create("payment", { terms: { card: "never" } });
          q.on("ready", function () {
            $(".spinner").hide();
            $("#billing-screen-shot").hide();
            $("#payment-form").show();
          });
          q.mount("#payment-element");
          $("#payment-form").on("submit", async (h) => {
            h.preventDefault();
            h = $("#payment-form");
            h.addClass("nl-disabled");
            const { error: c } = await n.stripe.confirmPayment({
              elements: f,
              confirmParams: {
                payment_method_data: {
                  billing_details: {
                    name: $("#card-holder-name").val(),
                    email: $("#card-holder-email").val(),
                  },
                },
                return_url: b,
              },
            });
            c &&
              (v.text(c.message),
              $(".error_image1 svg").show(),
              h.removeClass("nl-disabled"));
          });
        }
      },
    });
  },
  renderPaypalButton: function (a, b) {
    const e = this,
      k = a.plantype,
      l = a.reason;
    $("#express-paypal-button-subsc")
      .off("click")
      .on("click", function () {
        symbolab_log("Registration", "SubscribeClicked-paypal_" + k, l);
        const n = $(this);
        n.addClass("nl-disabled");
        $.ajax({
          type: "POST",
          url: "/api/payments/createSubscription",
          data: {
            variation: sy_var,
            country: e.sy_cid,
            type: k,
            platform: "paypal",
            url: a.url,
            position: b,
            reason: a.reason,
            coupon: a.cpn,
          },
          beforeSend: authorizeAjaxWithSyToken,
          error: function (q, v) {
            n.removeClass("nl-disabled");
          },
          success: function (q) {
            if (null != q) {
              const v = JSON.parse(q);
              "REDIRECT" === v.result
                ? (window.location.href = JSON.parse(q).data)
                : "ALERT" === v.result && alert(v.data);
            }
            n.removeClass("nl-disabled");
          },
        });
      });
  },
};
function log_user(a, b) {
  return symbolab_log("General", a, b);
}
var init_user_page = function (a, b, e, k, l, n) {
  var q = "true" == e;
  localStorage.setItem(
    "settings.numDecimalDisplay",
    l["settings.numDecimalDisplay"]
  );
  localStorage.setItem("settings.printOpen", l["settings.printOpen"]);
  localStorage.setItem("settings.printGraph", l["settings.printGraph"]);
  a && (this.stripe = Stripe(a, { locale: n }));
  var v;
  $(".settingsSelect")
    .focus(function () {
      v = this.value;
    })
    .change(function (f) {
      f = $(this).attr("field");
      var h = $(this).val();
      "settings.printOpen" !== f || q
        ? (getLocalStorage().setItem(f, h),
          $.ajax({
            type: "POST",
            url: "/api/user/updateUserField",
            beforeSend: authorizeAjaxWithSyToken,
            data: { field: f, value: h },
          }))
        : (createUpgradeTooltip(
            $("select[field='" + f + "']"),
            "UserPage\tSettings-" + f,
            i18n("to change settings"),
            "right"
          ),
          $(this).attr("value", v));
    });
  $("body")
    .off("click", "#UpgradeToProButtonFromUserPage:not(.nl-disabled)")
    .on(
      "click",
      "#UpgradeToProButtonFromUserPage:not(.nl-disabled)",
      function () {
        const f = $(this);
        f.addClass("nl-disabled");
        sendCourseHeroLink()
          .done(function (h) {
            h.success
              ? alertify.alert(h.success)
              : f.removeClass("nl-disabled");
          })
          .fail(function (h) {
            alertify.alert(h);
            f.removeClass("nl-disabled");
          });
      }
    );
  $("#paypalUnsubscribeNew").click(function () {
    const f = $(this);
    f.addClass("nl-disabled");
    $("#paypalPause").addClass("nl-disabled");
    $("#paypalActivate").addClass("nl-disabled");
    const h = $("#paypalActivate").is(":visible");
    if ($("#paypalUnsubscribeNew").hasClass("mobile") || h || "en" !== n) {
      symbolab_log(
        "Registration",
        "SeenFeature",
        "UserPage\tUnsubscribe" + (h ? "\tAlreadyPaused" : "")
      );
      const c = h
        ? i18n("js.Your subscription is paused, cancel")
        : i18n("js.cancel_question");
      alertify
        .okBtn(i18n("Yes"))
        .cancelBtn(i18n("No"))
        .confirm(
          c,
          function () {
            unsubscribe(
              q,
              "UserPage\tUnsubscribe" + (h ? "\tAlreadyPaused" : "")
            );
          },
          function () {
            $("#paypalPause").removeClass("nl-disabled");
            $("#paypalActivate").removeClass("nl-disabled");
            f.removeClass("nl-disabled");
          }
        );
    } else window.location = "/unsubscribe";
  });
  $("#paypalPause").click(function () {
    var f = $(this);
    $("#paypalUnsubscribeNew").addClass("nl-disabled");
    f.addClass("nl-disabled");
    symbolab_log("Registration", "SeenFeature", "UserPage\tPause\tPauseButton");
    alertify
      .okBtn(i18n("js.Confirm"))
      .cancelBtn(i18n("js.cancel"))
      .confirm(
        i18n("js.pause_question", $("input#throughInput").val()),
        function () {
          doPause("UserPage\tPause\tPauseButton");
        },
        function () {
          f.removeClass("nl-disabled");
          $("#paypalUnsubscribeNew").removeClass("nl-disabled");
        }
      );
  });
  $("#stripePortal").click(function () {
    var f = $(this).attr("data");
    $(".loading-animation").show();
    $.ajax({
      type: "POST",
      url: "/stripePortal",
      data: { sub_id: f },
      beforeSend: authorizeAjaxWithSyToken,
      success: function (h) {
        window.location.href = JSON.parse(h).data;
      },
    });
  });
  $("#update_billingemail").click(function () {
    $(".loading-animation").show();
    var f = $("#billingemail").val();
    $.ajax({
      type: "POST",
      url: "/updateOrRequestVerifyPost",
      data: { email: f, sourceURL: window.location.href },
      beforeSend: authorizeAjaxWithSyToken,
      success: function (h) {
        h.success && alertify.okBtn("OK").alert(h.success);
        $(".loading-animation").hide();
      },
      error: function () {
        $(".loading-animation").hide();
        alertify.okBtn("OK").alert("Error updating billing email");
      },
    });
  });
  $("#editBillingInfo").click(function () {
    $.ajax({
      type: "POST",
      url: "/api/payments/prepareCardUpdate",
      beforeSend: authorizeAjaxWithSyToken,
      success: function (f) {
        f = JSON.parse(f).clientSecret;
        var h = stripe.elements({
          appearance: { theme: "stripe" },
          clientSecret: f,
        });
        f = h.create("payment", { terms: { card: "never" } });
        f.on("ready", function (c) {
          $("#edit_billing_div").hide();
          $("#billing_update_target").show();
        });
        f.mount("#payment-element");
        $("#payment-form").on("submit", async (c) => {
          c.preventDefault();
          ({ error: c } = await stripe.confirmSetup({
            elements: h,
            confirmParams: {
              payment_method_data: {
                billing_details: {
                  name: $("#card-holder-name").val(),
                  email: $("#card-holder-email").val(),
                },
              },
              return_url:
                window.location.protocol +
                "//" +
                window.location.host +
                "/cardUpdated",
            },
          }));
          c &&
            (document.querySelector("#error-message").textContent = c.message);
        });
      },
      error: function () {},
    });
  });
  $("#cancelUpdateBillingInfo").click(function () {
    $("#billing_update_target").hide();
    $("#edit_billing_div").show();
  });
  $("#paypalActivate").click(function () {
    $(this).addClass("nl-disabled");
    $("#paypalUnsubscribeNew").addClass("nl-disabled");
    resumeSubscription("UserPage");
  });
  $(".lock_img").click(function () {
    var f = $(this),
      h = f.attr("field");
    createUpgradeTooltip(
      f,
      "UserPage\tSettings-" + h,
      i18n("to change settings"),
      "right"
    );
  });
  $("#paypalSubscribeNew").click(function () {
    q
      ? alertify
          .okBtn("OK")
          .cancelBtn(i18n("Cancel"))
          .confirm(
            i18n(
              "js.Your subscription is active, extend",
              $("input#throughInput").val()
            ),
            function () {
              $("#special").attr("id", "extend");
              showSubscription("UserPage\tSubscribeButton");
              setSelectedSubscriptionOption(
                $(".subscribeOption:visible").eq(0)
              );
              $(".subscribeOption:visible").eq(1).addClass("nl-disabled");
              $(".subscribeOption:visible").eq(2).addClass("nl-disabled");
              $(".subscribeOption:visible").eq(3).addClass("nl-disabled");
            },
            function () {}
          )
      : showSubscription("UserPage\tSubscribeButton");
  });
  $(".updateUser").click(function () {
    $("#profileUpdateSuccess").hide();
    $("#profileUpdateFail").hide();
    var f = new Promise(function (c, p) {
        $.ajax({
          type: "POST",
          url: "/api/user/updateUserField",
          beforeSend: authorizeAjaxWithSyToken,
          data: { field: "firstName", value: $("#firstName").val() },
          success: function (w) {
            w && w.success ? c() : p();
          },
          error: function () {
            p();
          },
        });
      }),
      h = new Promise(function (c, p) {
        $.ajax({
          type: "POST",
          url: "/api/user/updateUserField",
          beforeSend: authorizeAjaxWithSyToken,
          data: { field: "lastName", value: $("#lastName").val() },
          success: function (w) {
            w && w.success ? c() : p();
          },
          error: function () {
            p();
          },
        });
      });
    Promise.all([f, h]).then(
      function () {
        $("#profileUpdateSuccess").show();
      },
      function () {
        $("#profileUpdateFail").show();
      }
    );
  });
  $("#disableAccountButton").click(function () {
    q && "true" === k
      ? alertify
          .cancelBtn("Cancel")
          .okBtn("Unsubscribe")
          .confirm(
            i18n(
              "js.Your subscription is active, unsubscribe before deleting your account"
            ),
            function () {
              $("#paypalUnsubscribeNew").click();
            }
          )
      : alertify
          .okBtn("OK")
          .cancelBtn(i18n("Cancel"))
          .confirm(
            i18n("js.Your practice history and notes will be deleted!") +
              "\n" +
              ("true" === e
                ? i18n("js.You still have an active subscription!") + "\n"
                : "") +
              "Are you sure you want to delete your account?",
            function () {
              $.ajax({
                type: "POST",
                url: "/api/user/disableAccount",
                beforeSend: authorizeAjaxWithSyToken,
                success: function (f) {
                  f && f.success && logout();
                },
              });
            },
            function () {}
          );
  });
  $("#clearPracticeButton").click(function () {
    alertify
      .okBtn("OK")
      .cancelBtn(i18n("Cancel"))
      .confirm(
        i18n("js.Are you sure you want to clear your practice data?"),
        function () {
          $.ajax({
            type: "POST",
            url: "/api/user/clearPractice",
            beforeSend: authorizeAjaxWithSyToken,
            success: function (f) {
              f &&
                f.success &&
                $("#clearPracticeAlert").css("visibility", "visible");
            },
          });
        },
        function () {}
      );
  });
  $("#clearWebNotesButton").click(function () {
    alertify
      .okBtn("OK")
      .cancelBtn(i18n("Cancel"))
      .confirm(
        i18n("js.Are you sure you want to clear your notebook?"),
        function () {
          $.ajax({
            type: "POST",
            url: "/api/notebook/clearNotes",
            beforeSend: authorizeAjaxWithSyToken,
            data: { isMobile: !1 },
            success: function (f) {
              f &&
                f.success &&
                $("#clearWebNotesAlert").css("visibility", "visible");
            },
          });
        },
        function () {}
      );
  });
  $("#resetPasswordButton").click(function () {
    $("#resetPasswordFail").hide();
    $("#resetPasswordSuccess").hide();
    $.ajax({
      type: "POST",
      url: "/api/user/changePassword",
      beforeSend: authorizeAjaxWithSyToken,
      data: {
        currentPassword: $("#curPass").val(),
        password: $("#newPass").val(),
        password2: $("#newPass2").val(),
      },
      success: function (f) {
        f && f.alert
          ? ($("#resetPasswordFail").text(f.alert),
            $("#resetPasswordFail").show())
          : ($("#resetPasswordSuccess").show(),
            $("#curPass").val(""),
            $("#newPass").val(""),
            $("#newPass2").val(""));
      },
    });
  });
  $("#redeemPromotion").click(function () {
    var f = $(this);
    f.addClass("nl-disabled");
    $.ajax({
      type: "POST",
      url: "/redeemPromotion",
      beforeSend: authorizeAjaxWithSyToken,
      data: { code: $("#promotion").val() },
      success: function (h) {
        h
          ? location.reload()
          : (alertify.okBtn("OK").alert("Invalid Code"),
            f.removeClass("nl-disabled"));
      },
      error: function () {
        f.removeClass("nl-disabled");
      },
    });
  });
  $(".addEmail").click(function () {
    $("#emailFail").hide();
    $("#emailSuccess").hide();
    alertify
      .okBtn(i18n("OK"))
      .cancelBtn(i18n("Cancel"))
      .inputType("password")
      .prompt(i18n("js.Please enter password"), function (f, h) {
        $.ajax({
          type: "POST",
          url: "/api/user/updateEmail",
          beforeSend: authorizeAjaxWithSyToken,
          data: { newEmail: $("#email").val(), password: f },
          success: function (c) {
            c && c.alert
              ? ($("#emailFail").text(c.alert), $("#emailFail").show())
              : $("#emailSuccess").show();
          },
        });
      });
  });
  $(".edit-avatar").click(function () {
    log_user("AvatarOpenEdit");
    $.featherlight(".change-avatar", {
      variant: "edit-avatar-popup",
      beforeClose: function () {
        !0 === $(".featherlight.edit-avatar-popup").data("wasCanceled") &&
          log_user("AvatarCancelEdit");
      },
    });
    $(".upload-error").hide();
    $(".featherlight.edit-avatar-popup").data("wasCanceled", !0);
  });
  $(".stock-list > div").click(function () {
    $(".upload-error").hide();
    $(".stock-list > div").removeClass("active");
    var f = $(this);
    f.addClass("active");
    f = 5 - f.index() - 1;
    $(".current-avatar-container .stock-avatar use").attr(
      "href",
      "#stock-avatar-" + f
    );
    $(".featherlight .current-avatar .stock-avatar-container").removeClass(
      "no-image"
    );
    $(".featherlight .current-avatar img").addClass("no-image");
    log_user("AvatarSelectStock", f);
  });
  $("#upload-avatar-input").change(function (f) {
    $(".upload-error").hide();
    loadImageFile(f.target.files[0]);
  });
  $(".update-avatar-button").click(function () {
    $(".avatar-success").hide();
    var f = $(".featherlight .current-avatar img"),
      h = f.attr("src"),
      c = 5 - $(".stock-list > div.active").index() - 1;
    f.hasClass("no-image")
      ? $.ajax({
          type: "POST",
          url: "/api/user/updateUserAvatar",
          beforeSend: authorizeAjaxWithSyToken,
          data: { selectedStock: c },
          success: function () {
            $(".avatar-success").show();
            $(".featherlight.edit-avatar-popup").data("wasCanceled", !1);
            $.featherlight.close();
            setClientSideAvatarStock(c);
          },
          error: function () {
            $(".upload-error").show().text(i18n("js.Avatar stock fail"));
          },
        })
      : $.ajax({
          type: "POST",
          url: "/api/user/updateUserAvatar",
          beforeSend: authorizeAjaxWithSyToken,
          data: { base64: h },
          success: function () {
            $(".avatar-success").show();
            $(".featherlight.edit-avatar-popup").data("wasCanceled", !1);
            $.featherlight.close();
            setClientSideAvatarImage(h);
          },
          error: function () {
            $(".upload-error").show().text(i18n("js.Avatar upload fail"));
          },
        });
  });
};
function setClientSideAvatarImage(a) {
  $(".user-avatar-panel img, .current-avatar img, #userName img").removeClass(
    "no-image"
  );
  $(".stock-avatar-container").addClass("no-image");
  $(".user-avatar-panel img, .current-avatar img, #userName img").attr(
    "src",
    a
  );
  $(".stock-list > div").removeClass("active");
}
function setClientSideAvatarStock(a) {
  $(".user-avatar-panel img, .current-avatar img, #userName img").addClass(
    "no-image"
  );
  $(".stock-avatar-container").removeClass("no-image");
  $(".stock-avatar use").attr("href", "#stock-avatar-" + a);
  $(".stock-list > div").removeClass("active");
  $(".stock-list > div:nth-child(" + (5 - a) + ")").addClass("active");
}
function loadImageFile(a) {
  if (a.type.match(/image.*/))
    if (1024e3 < a.size)
      $(".upload-error").show().text(i18n("js.Bad upload")),
        $("#upload-avatar-input").val(""),
        log_user("AvatarImageTooBigAttempt");
    else {
      var b = new FileReader();
      b.onload = function (e) {
        var k = new Image();
        k.onload = function (l) {
          l = document.createElement("canvas");
          var n = k.width,
            q = k.height;
          if (n > q) {
            var v = 0;
            var f = (n - q) / 2;
            n -= 2 * f;
          } else (v = (q - n) / 2), (f = 0), (q -= 2 * v);
          l.width = 288;
          l.height = 288;
          l.getContext("2d").drawImage(k, f, v, n, q, 0, 0, 288, 288);
          l = l.toDataURL("image/jpeg", 0.8);
          f = $(".featherlight .current-avatar img");
          f.removeClass("no-image");
          f.attr("src", l);
          $(".featherlight .stock-list > div").removeClass("active");
          $(".featherlight .current-avatar .stock-avatar-container").addClass(
            "no-image"
          );
          log_user("AvatarImageUploaded");
        };
        k.src = e.target.result;
      };
      b.readAsDataURL(a);
      $("#upload-avatar-input").val("");
    }
  else
    $(".upload-error").show().text(i18n("js.Bad upload")),
      $("#upload-avatar-input").val(""),
      log_user("AvatarWrongFileTypeAttempt");
}
function doPause(a) {
  $(".loading-animation").show();
  $.ajax({
    type: "POST",
    url: "/api/payments/pauseSubscription",
    data: { reason: "user request" },
    beforeSend: authorizeAjaxWithSyToken,
    success: function (b) {
      symbolab_log("Registration", "ClickedFeature", a);
      alertify
        .okBtn("OK")
        .alert(
          b.success
            ? i18n("js.pause_question", $("input#throughInput").val())
            : i18n("js.Operation Failed"),
          function () {
            location.reload();
          }
        );
    },
  });
}
function unsubscribe(a, b) {
  $(".loading-animation").show();
  $.ajax({
    type: "POST",
    url: "/api/payments/cancelSubscription",
    beforeSend: authorizeAjaxWithSyToken,
    success: function (e) {
      symbolab_log("Registration", "ClickedFeature", b);
      amplitude.track("Unsubscribe", { reason: b });
      alertify
        .okBtn("OK")
        .alert(
          a
            ? i18n(
                "js.Your subscription is active",
                $("input#throughInput").val()
              )
            : i18n("js.Subscription canceled"),
          function () {
            location.reload();
          }
        );
    },
  });
}
(function () {
  function a() {
    var l = {
      parent: document.body,
      version: "1.0.11",
      defaultOkLabel: "OK",
      okLabel: "OK",
      defaultCancelLabel: "Cancel",
      cancelLabel: "Cancel",
      defaultMaxLogItems: 2,
      maxLogItems: 2,
      promptValue: "",
      promptPlaceholder: "",
      closeLogOnClick: !1,
      closeLogOnClickDefault: !1,
      delay: 5e3,
      defaultDelay: 5e3,
      logContainerClass: "alertify-logs",
      logContainerDefaultClass: "alertify-logs",
      dialogs: {
        buttons: {
          holder: "<nav>{{buttons}}</nav>",
          ok: "<button class='ok' tabindex='1'>{{ok}}</button>",
          cancel: "<button class='cancel' tabindex='2'>{{cancel}}</button>",
        },
        input: "<input type='text'>",
        message: "<p class='msg'>{{message}}</p>",
        log: "<div class='{{class}}'>{{message}}</div>",
      },
      defaultDialogs: {
        buttons: {
          holder: "<nav>{{buttons}}</nav>",
          ok: "<button class='ok' tabindex='1'>{{ok}}</button>",
          cancel: "<button class='cancel' tabindex='2'>{{cancel}}</button>",
        },
        input: "<input type='text'>",
        message: "<p class='msg'>{{message}}</p>",
        log: "<div class='{{class}}'>{{message}}</div>",
      },
      build: function (n) {
        var q = this.dialogs.buttons.ok,
          v =
            "<div class='dialog'><div>" +
            this.dialogs.message.replace("{{message}}", n.message);
        if ("confirm" === n.type || "prompt" === n.type)
          q = this.dialogs.buttons.cancel + this.dialogs.buttons.ok;
        "prompt" === n.type && (v += this.dialogs.input);
        return (v = (v + this.dialogs.buttons.holder + "</div></div>")
          .replace("{{buttons}}", q)
          .replace("{{ok}}", this.okLabel)
          .replace("{{cancel}}", this.cancelLabel));
      },
      setCloseLogOnClick: function (n) {
        this.closeLogOnClick = !!n;
      },
      close: function (n, q) {
        this.closeLogOnClick &&
          n.addEventListener("click", function () {
            b(n);
          });
        q = q && !isNaN(+q) ? +q : this.delay;
        0 > q
          ? b(n)
          : 0 < q &&
            setTimeout(function () {
              b(n);
            }, q);
      },
      dialog: function (n, q, v, f) {
        return this.setup({ type: q, message: n, onOkay: v, onCancel: f });
      },
      log: function (n, q, v) {
        var f = document.querySelectorAll(".alertify-logs > div");
        if (f) {
          var h = f.length - this.maxLogItems;
          if (0 <= h) {
            var c = 0;
            for (h += 1; c < h; c++) this.close(f[c], -1);
          }
        }
        this.notify(n, q, v);
      },
      setLogPosition: function (n) {
        this.logContainerClass = "alertify-logs " + n;
      },
      setupLogContainer: function () {
        var n = document.querySelector(".alertify-logs"),
          q = this.logContainerClass;
        n ||
          ((n = document.createElement("div")),
          (n.className = q),
          this.parent.appendChild(n));
        n.className !== q && (n.className = q);
        return n;
      },
      notify: function (n, q, v) {
        var f = this.setupLogContainer(),
          h = document.createElement("div");
        h.className = q || "default";
        h.innerHTML = l.logTemplateMethod ? l.logTemplateMethod(n) : n;
        "function" === typeof v && h.addEventListener("click", v);
        f.appendChild(h);
        setTimeout(function () {
          h.className += " show";
        }, 10);
        this.close(h, this.delay);
      },
      setup: function (n) {
        function q(y) {
          "function" !== typeof y && (y = function () {});
          f &&
            f.addEventListener("click", function (x) {
              if (n.onOkay && "function" === typeof n.onOkay)
                if (c) n.onOkay(c.value, x);
                else n.onOkay(x);
              c
                ? y({ buttonClicked: "ok", inputValue: c.value, event: x })
                : y({ buttonClicked: "ok", event: x });
              b(v);
            });
          h &&
            h.addEventListener("click", function (x) {
              if (n.onCancel && "function" === typeof n.onCancel) n.onCancel(x);
              y({ buttonClicked: "cancel", event: x });
              b(v);
            });
          c &&
            c.addEventListener("keyup", function (x) {
              13 === x.which && f.click();
            });
        }
        var v = document.createElement("div");
        v.className = "alertify hide";
        v.innerHTML = this.build(n);
        var f = v.querySelector(".ok"),
          h = v.querySelector(".cancel"),
          c = v.querySelector("input"),
          p = v.querySelector("label");
        c &&
          ("string" === typeof this.promptPlaceholder &&
            (p
              ? (p.textContent = this.promptPlaceholder)
              : (c.placeholder = this.promptPlaceholder)),
          "string" === typeof this.promptValue && (c.value = this.promptValue),
          "string" === typeof this._inputType && (c.type = this._inputType));
        var w;
        "function" === typeof Promise ? (w = new Promise(q)) : q();
        this.parent.appendChild(v);
        setTimeout(function () {
          v.classList.remove("hide");
          c && n.type && "prompt" === n.type
            ? (c.select(), c.focus())
            : f && f.focus();
        }, 100);
        return w;
      },
      okBtn: function (n) {
        this.okLabel = n;
        return this;
      },
      inputType: function (n) {
        this._inputType = n;
        return this;
      },
      setDelay: function (n) {
        n = n || 0;
        this.delay = isNaN(n) ? this.defaultDelay : parseInt(n, 10);
        return this;
      },
      cancelBtn: function (n) {
        this.cancelLabel = n;
        return this;
      },
      setMaxLogItems: function (n) {
        this.maxLogItems = parseInt(n || this.defaultMaxLogItems);
      },
      theme: function (n) {
        switch (n.toLowerCase()) {
          case "bootstrap":
            this.dialogs.buttons.ok =
              "<button class='ok btn btn-primary' tabindex='1'>{{ok}}</button>";
            this.dialogs.buttons.cancel =
              "<button class='cancel btn btn-default' tabindex='2'>{{cancel}}</button>";
            this.dialogs.input = "<input type='text' class='form-control'>";
            break;
          case "purecss":
            this.dialogs.buttons.ok =
              "<button class='ok pure-button' tabindex='1'>{{ok}}</button>";
            this.dialogs.buttons.cancel =
              "<button class='cancel pure-button' tabindex='2'>{{cancel}}</button>";
            break;
          case "mdl":
          case "material-design-light":
            this.dialogs.buttons.ok =
              "<button class='ok mdl-button mdl-js-button mdl-js-ripple-effect'  tabindex='1'>{{ok}}</button>";
            this.dialogs.buttons.cancel =
              "<button class='cancel mdl-button mdl-js-button mdl-js-ripple-effect' tabindex='2'>{{cancel}}</button>";
            this.dialogs.input =
              "<div class='mdl-textfield mdl-js-textfield'><input class='mdl-textfield__input'><label class='md-textfield__label'></label></div>";
            break;
          case "angular-material":
            this.dialogs.buttons.ok =
              "<button class='ok md-primary md-button' tabindex='1'>{{ok}}</button>";
            this.dialogs.buttons.cancel =
              "<button class='cancel md-button' tabindex='2'>{{cancel}}</button>";
            this.dialogs.input =
              "<div layout='column'><md-input-container md-no-float><input type='text'></md-input-container></div>";
            break;
          default:
            (this.dialogs.buttons.ok = this.defaultDialogs.buttons.ok),
              (this.dialogs.buttons.cancel =
                this.defaultDialogs.buttons.cancel),
              (this.dialogs.input = this.defaultDialogs.input);
        }
      },
      reset: function () {
        this.parent = document.body;
        this.theme("default");
        this.okBtn(this.defaultOkLabel);
        this.cancelBtn(this.defaultCancelLabel);
        this.setMaxLogItems();
        this.promptPlaceholder = this.promptValue = "";
        this.delay = this.defaultDelay;
        this.setCloseLogOnClick(this.closeLogOnClickDefault);
        this.setLogPosition("bottom left");
        this.logTemplateMethod = null;
      },
      injectCSS: function () {
        if (!document.querySelector("#alertifyCSS")) {
          var n = document.getElementsByTagName("head")[0],
            q = document.createElement("style");
          q.type = "text/css";
          q.id = "alertifyCSS";
          q.innerHTML = "/* style.css */";
          n.insertBefore(q, n.firstChild);
        }
      },
      removeCSS: function () {
        var n = document.querySelector("#alertifyCSS");
        n && n.parentNode && n.parentNode.removeChild(n);
      },
    };
    l.injectCSS();
    return {
      _$$alertify: l,
      parent: function (n) {
        l.parent = n;
      },
      reset: function () {
        l.reset();
        return this;
      },
      alert: function (n, q, v) {
        return l.dialog(n, "alert", q, v) || this;
      },
      confirm: function (n, q, v) {
        return l.dialog(n, "confirm", q, v) || this;
      },
      prompt: function (n, q, v) {
        return l.dialog(n, "prompt", q, v) || this;
      },
      log: function (n, q) {
        l.log(n, "default", q);
        return this;
      },
      theme: function (n) {
        l.theme(n);
        return this;
      },
      success: function (n, q) {
        l.log(n, "success", q);
        return this;
      },
      error: function (n, q) {
        l.log(n, "error", q);
        return this;
      },
      cancelBtn: function (n) {
        l.cancelBtn(n);
        return this;
      },
      okBtn: function (n) {
        l.okBtn(n);
        return this;
      },
      inputType: function (n) {
        l.inputType(n);
        return this;
      },
      delay: function (n) {
        l.setDelay(n);
        return this;
      },
      placeholder: function (n) {
        l.promptPlaceholder = n;
        return this;
      },
      defaultValue: function (n) {
        l.promptValue = n;
        return this;
      },
      maxLogItems: function (n) {
        l.setMaxLogItems(n);
        return this;
      },
      closeLogOnClick: function (n) {
        l.setCloseLogOnClick(!!n);
        return this;
      },
      logPosition: function (n) {
        l.setLogPosition(n || "");
        return this;
      },
      setLogTemplate: function (n) {
        l.logTemplateMethod = n;
        return this;
      },
      clearLogs: function () {
        l.setupLogContainer().innerHTML = "";
        return this;
      },
      version: l.version,
    };
  }
  var b = function (l) {
    if (l) {
      var n = function () {
        l && l.parentNode && l.parentNode.removeChild(l);
      };
      l.classList.remove("show");
      l.classList.add("hide");
      l.addEventListener("transitionend", n);
      setTimeout(n, 500);
    }
  };
  if ("undefined" !== typeof module && module && module.exports) {
    module.exports = function () {
      return new a();
    };
    var e = new a(),
      k;
    for (k in e) module.exports[k] = e[k];
  } else
    "function" === typeof define && define.amd
      ? define(function () {
          return new a();
        })
      : $(document).ready(function () {
          window.alertify = new a();
        });
})();
class SyCamera {
  constructor(a, b, e, k, l, n) {
    this._baseReason = a;
    this._curLang = b;
    this._page = e;
    this._debugMode = k;
    this._body = $("body");
    this._container = $("#video");
    this._cropContainer = $("#crop_handle_container");
    this._animationCanvas = $("#bar_animation");
    this._imageArea = $("#user-image");
    this._oneCorner = $("#crop_top_left");
    this._cameraSuccessCallback = n;
    this._cameraButtonSelector = void 0 === l ? "#input-camera" : l;
    0 <= window.location.hash.indexOf("camera") &&
      ((a = window.location.href.replace(/#.*/, "")),
      window.history.replaceState({}, document.title, a));
    this._setupCameraClick();
    window.onhashchange = () => {
      "#camera" !== window.location.hash && this._closeCamera();
    };
  }
  _setupCameraClick() {
    const a = new FileReader();
    var b = $("#file-input-target");
    b.empty();
    const e = $(
      '<input type="file"\n\t\t\t\t\t\t\t\t  capture="environment"\n\t\t\t\t\t\t\t\t  accept="image/*">'
    );
    b.append(e);
    e.on("change", () => {
      const k = e[0].files[0];
      k &&
        (a.addEventListener("load", () => {
          const l = new Image();
          l.src = a.result;
          l.onload = () => {
            $("#user-image").attr("src", a.result);
            this._openCamera(l.width, l.height);
          };
        }),
        a.readAsDataURL(k));
    });
    b = $(this._cameraButtonSelector);
    b.removeClass("hide-important");
    b.off("click").on("click", (k) => {
      k.preventDefault();
      e.click();
    });
    $("#scan-to-solve")
      .off("click")
      .on("click", (k) => {
        k.preventDefault();
        e.click();
      });
    $("#decoration svg")
      .off("click")
      .on("click", (k) => {
        k.preventDefault();
        e.click();
      });
  }
  _openCamera(a, b) {
    window.location.hash = "#camera";
    this._sessionId = this._uuidSessionId();
    this._body.addClass("no-scroll");
    $("#video").removeClass("hide");
    this._cropPositionMove(0, 0);
    $("#user-image").css("aspect-ratio", "" + a + "/" + b);
    $("#crop_top_left")
      .off("touchstart")
      .on("touchstart", (l) => {
        this._handleTouchStart(l);
      });
    $("#crop_top_right")
      .off("touchstart")
      .on("touchstart", (l) => {
        this._handleTouchStart(l);
      });
    $("#crop_bottom_right")
      .off("touchstart")
      .on("touchstart", (l) => {
        this._handleTouchStart(l);
      });
    $("#crop_bottom_left")
      .off("touchstart")
      .on("touchstart", (l) => {
        this._handleTouchStart(l);
      });
    $("#crop_top_left")
      .off("touchmove")
      .on("touchmove", (l) => {
        this._handleTouchMove(l, 0);
      });
    $("#crop_top_right")
      .off("touchmove")
      .on("touchmove", (l) => {
        this._handleTouchMove(l, 1);
      });
    $("#crop_bottom_right")
      .off("touchmove")
      .on("touchmove", (l) => {
        this._handleTouchMove(l, 2);
      });
    $("#crop_bottom_left")
      .off("touchmove")
      .on("touchmove", (l) => {
        this._handleTouchMove(l, 3);
      });
    let e = 0,
      k = 0;
    $("#crop_handle_container")
      .off("touchstart")
      .on("touchstart", (l) => {
        0 < $(l.originalEvent.target).closest(".crop-corner").length ||
          !(l = l.originalEvent.touches[0]) ||
          ((e = l.clientX), (k = l.clientY));
      });
    $("#crop_handle_container")
      .off("touchmove")
      .on("touchmove", (l) => {
        !(0 < $(l.originalEvent.target).closest(".crop-corner").length) &&
          (l.preventDefault(),
          l.stopPropagation(),
          (l = l.originalEvent.touches[0])) &&
          (this._entireCropWindowMove(l.clientX, l.clientY, e, k),
          (e = l.clientX),
          (k = l.clientY));
      });
    this._body.off("touchstart").on("touchstart", (l) => {});
    $("#shutter")
      .off("click")
      .on("click", async () => {
        await this._doCapture(a, b);
      });
    window.addEventListener("resize", () => {
      this._cropPositionMove(0, 0);
    });
    this._ready = !0;
  }
  _closeCamera() {
    this._debugLog("Closing camera");
    $("#video").addClass("hide");
    $("#user-image").removeAttr("src");
    this._setupCameraClick();
    $("#latex-result").addClass("hide-important");
    $("#store-prompt").addClass("hide-important");
    this._animationCanvas.addClass("hide-important");
    this._body.removeClass("no-scroll");
  }
  _uuidSessionId() {
    return "SNAP-xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(
      /[xy]/g,
      function (a) {
        const b = (16 * Math.random()) | 0;
        return ("x" === a ? b : (b & 3) | 8).toString(16);
      }
    );
  }
  _entireCropWindowMove(a, b, e, k) {
    const l = this._imageArea.height(),
      n = this._container.width();
    var q = this._imageArea.offset();
    const v = this._imageArea.offsetParent().offset(),
      f = this._cropContainer.width(),
      h = this._cropContainer.height();
    var c = this._cropContainer.offset();
    const p = c.left;
    c = c.top - v.top;
    q = Math.round(q.top - v.top);
    a = p + (a - e);
    b = c + (b - k);
    f + a > n ? (a = p) : 0 > a && (a = p);
    h + b > l + q ? (b = c) : b < q && (b = c);
    a = Math.round(a);
    b = Math.round(b);
    this._cropContainer.css({ left: a + "px", top: b + "px" });
  }
  _cropPositionMove(a, b, e, k, l) {
    const n = this._imageArea.height(),
      q = this._container.width();
    var v = this._imageArea.offset();
    const f = this._imageArea.offsetParent().offset(),
      h = 2 * this._oneCorner.width(),
      c = 1.2 * this._oneCorner.height(),
      p = this._cropContainer.width(),
      w = this._cropContainer.height();
    var y = this._cropContainer.offset();
    const x = y.left;
    y = y.top - f.top;
    v = Math.round(v.top - f.top);
    let C, D, A, I;
    if (0 === a && 0 === b)
      (C = 300), (D = 200), (A = (q - C) / 2), (I = (n - D) / 2 + v);
    else
      switch (((a -= e), (b -= k), l)) {
        case 0:
          A = x + a;
          C = p - a;
          I = y + b;
          D = w - b;
          break;
        case 1:
          A = x;
          C = p + a;
          I = y + b;
          D = w - b;
          break;
        case 2:
          A = x;
          C = p + a;
          I = y;
          D = w + b;
          break;
        case 3:
          (A = x + a), (C = p - a), (I = y), (D = w + b);
      }
    C + A > q
      ? ((C = q - A), C < h && ((C = h), (A = q - C)))
      : 0 > A && ((A = x), (C = p));
    D + I > n + v
      ? ((D = n + v - I), D < c && (I = n + v - D))
      : I < v && ((I = y), (D = w));
    C < h && ((C = p), (A = x));
    D < c && ((D = w), (I = y));
    C = Math.round(C);
    D = Math.round(D);
    A = Math.round(A);
    I = Math.round(I);
    this._cropContainer.css({
      left: A + "px",
      top: I + "px",
      width: C + "px",
      height: D + "px",
    });
    this._animationCanvas[0].width = C;
    this._animationCanvas[0].height = D;
  }
  _handleTouchStart(a) {
    if ((a = a.originalEvent.touches[0]))
      (this._currentX = a.clientX), (this._currentY = a.clientY);
  }
  _handleTouchMove(a, b) {
    a.preventDefault();
    a.stopPropagation();
    if ((a = a.originalEvent.touches[0]))
      this._cropPositionMove(
        a.clientX,
        a.clientY,
        this._currentX,
        this._currentY,
        b
      ),
        (this._currentX = a.clientX),
        (this._currentY = a.clientY);
  }
  async _doCapture(a, b) {
    if (this._ready) {
      this._ready = !1;
      this._animationCanvas.removeClass("hide-important");
      var e = $("#image-canvas")[0],
        k = $("#user-image"),
        l = $("#crop_handle_container");
      a = k.width() / a;
      b = k.height() / b;
      e.width = l.width() / a;
      e.height = l.height() / b;
      l = l.offset();
      var n = k.offset(),
        q = l.left - n.left;
      n = l.top - n.top;
      l = e.getContext("2d");
      l.drawImage(
        k[0],
        q / a,
        n / b,
        e.width,
        e.height,
        0,
        0,
        e.width,
        e.height
      );
      k = l.getImageData(0, 0, l.canvas.width, l.canvas.height);
      a = k.data;
      for (b = 0; b < a.length; b += 4)
        (q = parseInt((a[b] + a[b + 1] + a[b + 2]) / 3)),
          (a[b] = q),
          (a[b + 1] = q),
          (a[b + 2] = q);
      l.putImageData(k, 0, 0);
      k = e.toDataURL("image/jpeg", 0.85);
      this._debugMode && ($("#debug-image")[0].src = k);
      e = new FormData();
      k = this._dataURIToBlob(k);
      a = this._getSequence();
      l = ("0000" + a).slice(-4) + ".jpg";
      e.append("data", k, l);
      this._putSequence((a + 1) % 5e3);
      k = this._debugMode ? "debug" : "";
      this._animationCanvas.addClass("hide-important");
      $("#ocr_spinner").removeClass("hide-important");
      try {
        const v = await securedAjax({
          type: "POST",
          url:
            "/api/getLatex?mode=" +
            k +
            "&sessionid=" +
            this._sessionId +
            "&language=" +
            this._curLang,
          data: e,
          processData: !1,
          contentType: !1,
        });
        this._handleSuccess(v);
      } catch (v) {
        console.log(v),
          this._showError(i18n("js.connectivity_error")),
          $("#ocr_spinner").addClass("hide-important");
      }
    }
  }
  _debugLog(a) {
    this._debugMode && console.log(a);
  }
  _dataURIToBlob(a) {
    var b = a.split(",");
    a = 0 <= b[0].indexOf("base64") ? atob(b[1]) : decodeURI(b[1]);
    b = b[0].split(":")[1].split(";")[0];
    const e = new Uint8Array(a.length);
    for (let k = 0; k < a.length; k++) e[k] = a.charCodeAt(k);
    return new Blob([e], { type: b });
  }
  _putSequence(a) {
    localStorage.sequence = JSON.stringify(a);
  }
  _getSequence() {
    const a = localStorage.sequence;
    return void 0 === a ? 0 : JSON.parse(a);
  }
  _setupShutterSoundAndPlay() {
    this._audioAlreadySetUp
      ? this._playShutterSound()
      : ((this._audioAlreadySetUp = !0),
        (this._context = new AudioContext()),
        window
          .fetch("/public/audio/shutter.wav")
          .then((a) => a.arrayBuffer())
          .then((a) => this._context.decodeAudioData(a))
          .then((a) => {
            this._shutterBuffer = a;
            this._playShutterSound();
          })
          .catch((a) => {
            this._debugLog("Failed to get shutter sound: " + a);
          }));
  }
  _playShutterSound() {
    if (this._shutterBuffer) {
      var a = this._context.createBufferSource();
      a.buffer = this._shutterBuffer;
      var b = this._context.createGain();
      b.gain.value = 0.5;
      b.connect(this._context.destination);
      a.connect(b);
      a.start();
    }
  }
  _handleSuccess(a) {
    a.success
      ? this._cameraSuccessCallback
        ? a.latex &&
          ((window.location.hash = ""), this._cameraSuccessCallback(a.latex))
        : ((this._ready = !0),
          (a = encodeURIComponent(a.latex)),
          (window.location.href =
            "/solver/" + this._page + "/" + a + "?or=ocr"))
      : this._showError(a.user_message);
    $("#ocr_spinner").addClass("hide-important");
  }
  _showError(a) {
    $("#toast-contents")
      .text(a)
      .removeClass("hide-important")
      .show()
      .delay(2e3)
      .fadeOut();
    this._ready = !0;
  }
}
